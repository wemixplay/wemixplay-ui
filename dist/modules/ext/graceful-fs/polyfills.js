"use strict";var n=require("constants"),c=process.cwd,t=null,o=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return t||(t=c.call(process)),t};try{process.cwd()}catch(n){}if("function"==typeof process.chdir){var e=process.chdir;process.chdir=function(n){t=null,e.call(process,n)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,e)}var r=function(c){n.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&function(c){c.lchmod=function(t,o,e){c.open(t,n.O_WRONLY|n.O_SYMLINK,o,(function(n,t){n?e&&e(n):c.fchmod(t,o,(function(n){c.close(t,(function(c){e&&e(n||c)}))}))}))},c.lchmodSync=function(t,o){var e,r=c.openSync(t,n.O_WRONLY|n.O_SYMLINK,o),i=!0;try{e=c.fchmodSync(r,o),i=!1}finally{if(i)try{c.closeSync(r)}catch(n){}else c.closeSync(r)}return e}}(c);c.lutimes||function(c){n.hasOwnProperty("O_SYMLINK")&&c.futimes?(c.lutimes=function(t,o,e,r){c.open(t,n.O_SYMLINK,(function(n,t){n?r&&r(n):c.futimes(t,o,e,(function(n){c.close(t,(function(c){r&&r(n||c)}))}))}))},c.lutimesSync=function(t,o,e){var r,i=c.openSync(t,n.O_SYMLINK),u=!0;try{r=c.futimesSync(i,o,e),u=!1}finally{if(u)try{c.closeSync(i)}catch(n){}else c.closeSync(i)}return r}):c.futimes&&(c.lutimes=function(n,c,t,o){o&&process.nextTick(o)},c.lutimesSync=function(){})}(c);c.chown=r(c.chown),c.fchown=r(c.fchown),c.lchown=r(c.lchown),c.chmod=t(c.chmod),c.fchmod=t(c.fchmod),c.lchmod=t(c.lchmod),c.chownSync=i(c.chownSync),c.fchownSync=i(c.fchownSync),c.lchownSync=i(c.lchownSync),c.chmodSync=e(c.chmodSync),c.fchmodSync=e(c.fchmodSync),c.lchmodSync=e(c.lchmodSync),c.stat=u(c.stat),c.fstat=u(c.fstat),c.lstat=u(c.lstat),c.statSync=f(c.statSync),c.fstatSync=f(c.fstatSync),c.lstatSync=f(c.lstatSync),c.chmod&&!c.lchmod&&(c.lchmod=function(n,c,t){t&&process.nextTick(t)},c.lchmodSync=function(){});c.chown&&!c.lchown&&(c.lchown=function(n,c,t,o){o&&process.nextTick(o)},c.lchownSync=function(){});"win32"===o&&(c.rename="function"!=typeof c.rename?c.rename:function(n){function t(t,o,e){var r=Date.now(),i=0;n(t,o,(function u(f){if(f&&("EACCES"===f.code||"EPERM"===f.code||"EBUSY"===f.code)&&Date.now()-r<6e4)return setTimeout((function(){c.stat(o,(function(c,r){c&&"ENOENT"===c.code?n(t,o,u):e(f)}))}),i),void(i<100&&(i+=10));e&&e(f)}))}return Object.setPrototypeOf&&Object.setPrototypeOf(t,n),t}(c.rename));function t(n){return n?function(t,o,e){return n.call(c,t,o,(function(n){s(n)&&(n=null),e&&e.apply(this,arguments)}))}:n}function e(n){return n?function(t,o){try{return n.call(c,t,o)}catch(n){if(!s(n))throw n}}:n}function r(n){return n?function(t,o,e,r){return n.call(c,t,o,e,(function(n){s(n)&&(n=null),r&&r.apply(this,arguments)}))}:n}function i(n){return n?function(t,o,e){try{return n.call(c,t,o,e)}catch(n){if(!s(n))throw n}}:n}function u(n){return n?function(t,o,e){function r(n,c){c&&(c.uid<0&&(c.uid+=4294967296),c.gid<0&&(c.gid+=4294967296)),e&&e.apply(this,arguments)}return"function"==typeof o&&(e=o,o=null),o?n.call(c,t,o,r):n.call(c,t,r)}:n}function f(n){return n?function(t,o){var e=o?n.call(c,t,o):n.call(c,t);return e&&(e.uid<0&&(e.uid+=4294967296),e.gid<0&&(e.gid+=4294967296)),e}:n}function s(n){return!n||("ENOSYS"===n.code||!(process.getuid&&0===process.getuid()||"EINVAL"!==n.code&&"EPERM"!==n.code))}c.read="function"!=typeof c.read?c.read:function(n){function t(t,o,e,r,i,u){var f;if(u&&"function"==typeof u){var s=0;f=function(l,a,y){if(l&&"EAGAIN"===l.code&&s<10)return s++,n.call(c,t,o,e,r,i,f);u.apply(this,arguments)}}return n.call(c,t,o,e,r,i,f)}return Object.setPrototypeOf&&Object.setPrototypeOf(t,n),t}(c.read),c.readSync="function"!=typeof c.readSync?c.readSync:(l=c.readSync,function(n,t,o,e,r){for(var i=0;;)try{return l.call(c,n,t,o,e,r)}catch(n){if("EAGAIN"===n.code&&i<10){i++;continue}throw n}});var l};exports.polyfills=r;

"use strict";var t=require("../../../../_virtual/index2.js");require("../../../universalify/index.js");var i=require("../../../../_virtual/index.js");require("../fs/index.js");var s=require("../mkdirs/index.js"),e=require("./symlink-paths.js"),r=require("./symlink-type.js"),n=require("../path-exists/index.js"),a=require("../util/stat.js"),y=require("path");const c=t.__exports.fromPromise,l=y,m=i.__exports,{mkdirs:o,mkdirsSync:u}=s.mkdirs,{symlinkPaths:k,symlinkPathsSync:d}=e.symlinkPaths_1,{symlinkType:x,symlinkTypeSync:S}=r.symlinkType_1,{pathExists:p}=n.pathExists_1,{areIdentical:h}=a.stat;var q={createSymlink:c((async function(t,i,s){let e;try{e=await m.lstat(i)}catch{}if(e&&e.isSymbolicLink()){const[s,e]=await Promise.all([m.stat(t),m.stat(i)]);if(h(s,e))return}const r=await k(t,i);t=r.toDst;const n=await x(r.toCwd,s),a=l.dirname(i);return await p(a)||await o(a),m.symlink(t,i,n)})),createSymlinkSync:function(t,i,s){let e;try{e=m.lstatSync(i)}catch{}if(e&&e.isSymbolicLink()){const s=m.statSync(t),e=m.statSync(i);if(h(s,e))return}const r=d(t,i);t=r.toDst,s=S(r.toCwd,s);const n=l.dirname(i);return m.existsSync(n)||u(n),m.symlinkSync(t,i,s)}};exports.symlink=q;

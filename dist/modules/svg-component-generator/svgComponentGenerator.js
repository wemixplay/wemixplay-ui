"use strict";var t=require("../_virtual/_tslib.js"),e=require("path"),i=require('./../ext/fs-extra/lib/index.js'),r=require('./../ext/lodash/debounce.js'),c=require('./../ext/lodash/startCase.js');const{readdir:n,writeFile:o,mkdir:s}=i.lib.promises;var a=class{constructor(i){var c=this;let{svgFileDir:o,outputDir:s,typescript:a=!1,title:l=!1,description:p=!1}=i;this.readSvgFileList=function(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t.__awaiter(c,void 0,void 0,(function*(){const c=yield n(i,{withFileTypes:!0}),o=yield Promise.all(c.map((c=>t.__awaiter(this,void 0,void 0,(function*(){const t="".concat(r?"".concat(r,"/"):"").concat(c.name),n=e.resolve(i,c.name);return c.isDirectory()&&"types"!==c.name?this.readSvgFileList(n,t):t})))));return Array.prototype.concat(...o)}))},this.generate=r((()=>t.__awaiter(this,void 0,void 0,(function*(){const t=yield this.readSvgFileList(this.svgFileDir),e=this.filterSvgFileNameList(t);yield this.writeSvgTypeFile(e),yield this.writeStaticSvgExportFile(e)}))),1500),this.svgFileDir=o,this.outputDir=null!=s?s:o,this.typescript=a,this.title=l,this.description=p}parseSvgListForType(t){const e=t.map((t=>"".concat(t.replace(".svg","")))),i=e.map((t=>"'".concat(t,"'"))).join(" | ")||"''",r=e.map((t=>"'".concat("Svg".concat(c(t.replace(/\//gi,"-").replace(".svg","")).replace(/ /gi,""),"'")))).join(" | ")||"''",n=e.filter((t=>t.includes("/"))).reduce(((t,e)=>{const i=e.split("/"),r=i.pop()||"",n=c(i.join("-")).replace(/ /gi,"");return Object.assign(Object.assign({},t),{[n]:t[n]?"".concat(t[n]," | '").concat(r,"'"):"'".concat(r,"'")})}),{});return{staticSvgIconName:i,particalSvgIconName:Object.entries(n).map((t=>{let[e,i]=t;return"export type ".concat(e,"IconType = ").concat(i,";\n")})).join(""),svgComponentName:r}}parseSvgListForFile(i){return t.__awaiter(this,void 0,void 0,(function*(){const t=i.reduce(((t,e)=>{const i="Svg".concat(c(e.replace(/\//gi,"-").replace(".svg","")).replace(/ /gi,""));return t=Object.assign(Object.assign({},t),{[i]:e})}),{}),r=Object.entries(t),n=e.relative(this.outputDir,this.svgFileDir).replace(/\\/gi,"/"),o=r.reduce(((t,e)=>{let[i,r]=e;return t+="import ".concat(i," from '").concat(n,"/").concat(r,"';\n")}),"").replace(/\n/gi,""),s=r.reduce(((e,i,r)=>{let[c,n]=i;return 0===r&&(e="export {\n"),e+="".concat(0!==r?",":"","  ").concat(c,"\n"),r===Object.entries(t).length-1&&(e+=" };"),e}),"").replace(/\n/gi,"");return{importString:o,exportString:s}}))}filterSvgFileNameList(t){return t.filter((t=>t.endsWith(".svg")))}writeSvgTypeFile(e){return t.__awaiter(this,void 0,void 0,(function*(){if(!this.typescript)return;const{staticSvgIconName:t,particalSvgIconName:r,svgComponentName:c}=this.parseSvgListForType(e),n="".concat(this.outputDir,"/types");return yield s(n,{recursive:!0}),i.lib.existsSync(n)?o("".concat(n,"/index.d.ts"),"/* eslint-disable */\nexport type StaticSvgIconName = ".concat(t,";\n").concat(r)+"export type SvgComponentName = ".concat(c),{flag:"w"}).then((()=>{})).catch(console.error):void 0}))}writeStaticSvgExportFile(e){return t.__awaiter(this,void 0,void 0,(function*(){const{importString:t,exportString:r}=yield this.parseSvgListForFile(e),c="".concat(this.outputDir,"/index.").concat(this.typescript?"jsx":"tsx"),n="".concat(this.outputDir,"/index.").concat(this.typescript?"tsx":"jsx");return yield s(this.outputDir,{recursive:!0}),i.lib.existsSync(c)&&i.lib.remove(c),o(n,'/* eslint-disable */ \nimport React from "react";\n\n'.concat(t,"\n").concat(r),{flag:"w"}).then((()=>{})).catch(console.error)}))}};module.exports=a;

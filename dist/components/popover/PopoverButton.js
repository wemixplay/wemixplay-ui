'use client';
"use strict";var e=require("../../_virtual/_tslib.js"),t=require("react"),o=require("./PopoverButton.module.scss.js"),n=require("../ripple/Ripple.js"),a=require("../../hooks/useClickOutside.js"),i=require("../../utils/forReactUtils.js"),r=require("../portal/Portal.js");const l=i.makeCxFunc(o),s=[],c=t.forwardRef(((o,i)=>{let{id:c,className:u="",anchorId:d,detectDoubleClick:m,popoverElement:v,popoverStyle:p={top:0,left:0,zIndex:1},popoverAnimation:f={name:"",duration:0},ripple:b,excludeOutSideIds:w=s,whenWindowScrollClose:E,children:k,onClick:C}=o;const y=t.useRef(),j=t.useRef(!1),[g,q]=t.useState(!1),[_,N]=t.useState(""),S=t.useMemo((()=>g&&("enter"===_||"leave"===_)?{animationName:f.name,animationDuration:"".concat(f.duration,"ms"),animationTimingFunction:f.timingFunc||"ease",animationDirection:"leave"===_?"reverse":"normal",animationFillMode:"leave"===_?"forwards":"normal"}:{}),[f,g,_]),F=t.useCallback((e=>new Promise((t=>setTimeout(t,e)))),[]),O=t.useCallback((()=>e.__awaiter(void 0,void 0,void 0,(function*(){d&&(N(""),yield F(10),N("leave"),yield F(f.duration),q(!1))}))),[d,f.duration,F]),R=t.useCallback((()=>e.__awaiter(void 0,void 0,void 0,(function*(){d&&(q(!0),N("enter"),yield F(f.duration),N(""))}))),[d,f.duration,F]),h=t.useCallback((()=>{g?O():R()}),[g,O,R]),x=t.useCallback((t=>e.__awaiter(void 0,void 0,void 0,(function*(){j.current&&m||(j.current=!0,setTimeout((()=>{j.current=!1}),500),h(),C&&C(t))}))),[m,h,C]),I=t.useMemo((()=>{const e="string"==typeof(null==v?void 0:v.type)?void 0:{close:O};return t.createElement("div",{className:l("popover-element-wrap")},g&&t.createElement("div",{className:l("popover-element",_),style:Object.assign(Object.assign({},p),S)},t.cloneElement(null!=v?v:t.createElement(t.Fragment,null),e)))}),[S,O,g,v,p,_]);return a(y,(e=>{const t=[...w,d].filter((e=>!!e)).concat(s).map((e=>document.querySelector("#".concat(e)))).filter((e=>e)),o=e.target;document.body.contains(o)&&(t.some((e=>null==e?void 0:e.contains(o)))||g&&O())}),{event:"mouseup"}),t.useEffect((()=>{const e=()=>{q(!1),N("")};return g&&E&&window.addEventListener("scroll",e),()=>{window.removeEventListener("scroll",e)}}),[E,g]),t.useImperativeHandle(i,(()=>({close:O,open:R}))),t.createElement("div",{ref:y,id:c,className:l("popover-area")},t.createElement(n.default,Object.assign({},b),t.createElement("button",{className:l("btn-popover",u,g&&"open"),onClick:x},k)),d?t.createElement(r,{id:d},I):null)}));c.displayName="PopoverButton";var u=c;module.exports=u;

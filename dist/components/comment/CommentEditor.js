"use client";
"use strict";var e=require("../../_virtual/_tslib.js"),t=require("react"),a=require("./CommentEditor.module.scss.js"),r=require("../../utils/forReactUtils.js"),n=require("./CommentWriterInfo.js"),l=require("../buttons/SolidCapButton.js"),s=require("../editor/WpEditor.js"),i=require("../../plugins/mention/Mention.js"),o=require("../../plugins/autoUrlMatch/AutoUrlMatch.js"),c=require("../../plugins/countTextLength/CountTextLength.js"),m=require("../../plugins/pasteToPlainText/PasteToPlainText.js"),u=require("../../utils/valueParserUtils.js"),d=require('./../../ext/lodash/merge.js');const h=r.makeCxFunc(a),g=t.forwardRef(((a,r)=>{var g,{className:p="",writerName:v,writerImg:x,btnSubmitText:T="POST",value:b,config:f,minLength:C=1,maxLength:N=1e3,placeholder:j,name:q,handleChange:S,handleSubmit:E}=a,k=e.__rest(a,["className","writerName","writerImg","btnSubmitText","value","config","minLength","maxLength","placeholder","name","handleChange","handleSubmit"]);const w=t.useRef(),[L,M]=t.useState(u.convertMarkdownToHtmlStr(null!=b?b:"")),[U,P]=t.useState(null!==(g=null==b?void 0:b.length)&&void 0!==g?g:0),_=t.useCallback((e=>{let{textUrls:t}=e;return t.map((e=>'<a href="'.concat(e,'" target="_blank">').concat(e,"</a>")))}),[]),H=t.useCallback(((e,t)=>{const a=u.convertHtmlToMarkdownStr(e);M(a),S&&S(a,t)}),[q,S]),I=t.useCallback((()=>{E&&E(L)}),[L,E]);return t.useEffect((()=>{if(b&&!L){const e=u.convertMarkdownToHtmlStr(b);M(e)}}),[b,L]),t.useImperativeHandle(r,(()=>{const{setData:e}=w.current;return w.current.setData=(t,a)=>{const r=u.convertMarkdownToHtmlStr(t);e(r,a)},w.current})),t.createElement("div",{className:h(p,"comment-editor")},t.createElement(n,{className:h("editor-profile"),writerName:v,writerImg:x}),t.createElement("div",{className:h("editor-area")},t.createElement(s,Object.assign({className:h("editor",{filled:L.length}),plugin:[i,o,m,c],config:d({},f,{pasteToPlainText:{onMatchUrlReplace:_},autoUrlMatch:{onMatchUrl:e=>_({textUrls:[e]})},countTextLength:{hideUi:!0,onChangeTextLength:P}}),name:q,initialValue:L,placeholder:j,maxLength:N,handleChange:H},k,{ref:w}))),t.createElement("div",{className:h("editor-tool")},t.createElement("em",{className:h("counter-current")},u.commaWithValue(U)),"/",t.createElement("span",{className:h("counter-max")},u.commaWithValue(N)),t.createElement(l,{size:"medium",className:h("btn-post"),disabled:C>U||!u.removeSpaceAndLineBreak(L),onClick:I},T)))}));g.displayName="CommentEditor";var p=g;module.exports=p;

"use strict";var t=require("@babel/runtime/helpers/toConsumableArray"),e=require("@babel/runtime/helpers/slicedToArray"),r=require("@babel/runtime/regenerator"),n=require("../../_virtual/_tslib.js"),o=require("lodash-es"),i=require("react"),c=require("react-device-detect"),a=require("../../hooks/useClickOutside.js"),l=require("../../utils/forReactUtils.js"),u=require("../portal/Portal.js"),s=require("./Tooltip.module.scss.js"),d=require("../../assets/svgs/ico-tooltip-arrow.svg.js"),p=function(t){return new Promise((function(e){return setTimeout(e,t)}))},f=l.makeCxFunc(s);module.exports=function(l){var s=l.className,h=void 0===s?"":s,v=l.anchorId,g=l.width,b=void 0===g?200:g,w=l.space,m=void 0===w?4:w,x=l.place,H=void 0===x?"bottom":x,W=l.events,E=void 0===W?["hover"]:W,k=l.arrowPosition,y=void 0===k?0:k,C=l.hideArrow,q=l.tooltipPosition,L=l.tooltipColor,N=l.tooltipTextColor,R=l.tooltipBoxShadow,Y=l.tooltipBorderRadius,T=l.open,X=l.whenWindowScrollClose,j=l.children,A=i.useRef(),S=i.useRef(),B=i.useRef(),P=i.useRef(),_=i.useRef(0),z=i.useRef(!1),M=i.useState(!1),D=e(M,2),I=D[0],F=D[1],O=i.useState(H),U=e(O,2),G=U[0],J=U[1],K=i.useState(!!T),Q=e(K,2),V=Q[0],Z=Q[1],$=i.useMemo((function(){var e=t(E),r=e.findIndex((function(t){return"hover"===t}));return-1===r||c.isMobile||e.splice(r,0,"mouseover","mouseout"),e}),[E]),tt=i.useCallback((function(){if(S.current)return S.current;var t=document.querySelector("#".concat(v));t&&(S.current=t)}),[v]),et=i.useCallback((function(t,e){var r,n=window,o=n.scrollY,i=o,c=o+n.innerHeight,a=(null===(r=S.current)||void 0===r?void 0:r.getBoundingClientRect()).top;return i>t&&a>0?t+a:c<t+e?c-e-10:t}),[]),rt=i.useCallback((function(t,e){var r=window,n=r.scrollX,o=n+r.innerWidth;return n>t?n+m:o<t+e?o-e-m:t}),[m]),nt=i.useCallback((function(t){var e=t.targetTop,r=t.targetLeft,n=t.targetWidth,o=t.targetHeight,i=t.tooltipHeight,c=t.arrowWidth,a=t.arrowHeight;return scrollY+e-i-a-m<scrollY&&"top"===H?"bottom":scrollY+e+o+a+m>scrollY+innerHeight&&"bottom"===H?"top":r-c-m<100&&"left"===H?"right":innerWidth-(scrollX+r+n+c+m+10)<100&&"right"===H?"left":r+scrollX<scrollX?"right":H}),[H,m]),ot=i.useCallback((function(){var t;if(!A.current||!S.current)return{targetTop:0,targetLeft:0,targetWidth:0,targetHeight:0,arrowWidth:0,arrowHeight:0,tooltipWidth:0,tooltipHeight:0,scrollX:0,scrollY:0,innerWidth:0,innerHeight:0};var e=S.current.getBoundingClientRect(),r=e.top,n=e.left,o=e.height,i=e.width,c=A.current,a=c.offsetHeight,l=c.offsetWidth,u=null!==(t=B.current)&&void 0!==t?t:{},s=u.clientWidth,d=void 0===s?0:s,p=u.clientHeight,f=void 0===p?0:p,h=window,v=h.scrollX,g=h.scrollY,b=h.innerWidth,w=h.innerHeight,m=document.body.style,x=m.position,H=m.top,W=m.left,E="fixed"===x?-1*Number(H.replace("px","")):0,k="fixed"===x?-1*Number(W.replace("px","")):0;return{targetTop:r,targetLeft:n,targetWidth:i,targetHeight:o,arrowWidth:d,arrowHeight:f,tooltipWidth:l,tooltipHeight:a,scrollX:k||v,scrollY:E||g,innerWidth:b,innerHeight:w}}),[]),it=i.useCallback((function(){return n.__awaiter(void 0,void 0,void 0,r.mark((function t(){var e,n,o,i,c,a,l,u,s,d,f,h,v,g,b,w,x,H,W,E,k,C,L;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(S.current&&A.current){t.next=2;break}return t.abrupt("return");case 2:e=ot(),n=e.targetTop,o=e.targetLeft,i=e.targetWidth,c=e.targetHeight,a=e.arrowWidth,l=e.arrowHeight,u=e.tooltipWidth,s=e.tooltipHeight,d=e.scrollX,f=e.scrollY,h=e.innerWidth,v=e.innerHeight,b=(g=null!=q?q:{}).top,w=void 0===b?0:b,x=g.left,H=void 0===x?0:x,W=y||0,E=nt({targetTop:n,targetLeft:o,targetWidth:i,targetHeight:c,arrowWidth:a,arrowHeight:l,tooltipWidth:u,tooltipHeight:s,scrollX:d,scrollY:f,innerWidth:h,innerHeight:v}),J(E),k="",C="",L="",t.t0=E,t.next="top"===t.t0?13:"left"===t.t0?16:"right"===t.t0?19:(t.t0,22);break;case 13:return k+="\n          top: ".concat(w+f+n-s-l-m,"px;\n          left: ").concat(rt(H+d+o+i/2-u/2,u),"px;\n        "),C+="\n          top: ".concat(w+f+n-l-m,"px;\n          left: ").concat(W+d+o+i/2-a/2,"px;\n        "),t.abrupt("break",25);case 16:return k+="\n          top: ".concat(et(w+f+n-(s-c)/2,s),"px;\n          left: ").concat(rt(H+d+o-u-l-m,u),"px;\n          max-width: ").concat(o-a-m,"px;\n        "),C+="\n          top: ".concat(W+f+n+c/2-a/2,"px;\n          left: ").concat(H+d+o-a-m,"px;\n        "),t.abrupt("break",25);case 19:return k+="\n          top: ".concat(et(w+f+n-(s-c)/2,s),"px;\n          left: ").concat(H+d+o+i+a+m,"px;\n          max-width: ").concat(h-(d+o+i+a+m+10),"px;\n        "),C+="\n          top: ".concat(W+f+n+c/2-l/2,"px;\n          left: ").concat(H+d+o+i+m,"px;\n        "),t.abrupt("break",25);case 22:return k+="\n        top: ".concat(w+f+n+c+l+m,"px;\n        left: ").concat(rt(H+d+o+i/2-u/2,u),"px;\n      "),C+="\n        transform: rotate(0deg);\n        top: ".concat(w+f+n+c+m,"px;\n        left: ").concat(W+d+o+i/2-a/2,"px;\n      "),t.abrupt("break",25);case 25:if(L+="\n      ".concat(k,"\n      width: ").concat(u,"px;\n      height: ").concat(s,"px;\n    "),A.current.setAttribute("style",k),P.current.setAttribute("style",L),B.current&&B.current.setAttribute("style",C),2!==_.current){t.next=34;break}return _.current=0,t.abrupt("return",Z(!0));case 34:return t.next=36,p(20);case 36:_.current+=1,it();case 38:case"end":return t.stop()}}),t)})))}),[y,m,q,nt,rt,et,ot]),ct=i.useMemo((function(){return o.debounce((function(t){"click"!==t.type&&z.current||("click"===t.type&&(t.preventDefault(),z.current=!0),"mouseout"===t.type?Z(!1):0===_.current&&it(),t.preventDefault())}),100)}),[it]),at=i.useCallback((function(){S.current&&"boolean"!=typeof T&&$.forEach((function(t){S.current.addEventListener(t,ct)}))}),[T,$,ct]),lt=i.useCallback((function(){S.current&&$.forEach((function(t){S.current.removeEventListener(t,ct)}))}),[$,ct]);return a(A,(function(t){if("boolean"!=typeof T){var e=S.current;e&&!e.contains(t.target)&&(z.current=!1,Z(!1))}})),i.useEffect((function(){return tt(),at(),function(){lt()}}),[it,tt,at,lt]),i.useEffect((function(){var t=o.throttle((function(){Z(!1)}),30);return window.removeEventListener("resize",t),window.addEventListener("resize",t),X&&(window.removeEventListener("scroll",t),window.addEventListener("scroll",t)),function(){window.removeEventListener("resize",t),window.removeEventListener("scroll",t)}}),[X,it]),i.useEffect((function(){T&&I&&it(),Z(T)}),[I,T,it]),i.createElement(u,{id:"tooltip"},i.createElement("div",{ref:function(){I||F(!0)},className:f("tooltip",h,G,{open:V}),style:{visibility:V?"visible":"hidden","--tooltip-color":L,"--tooltip-text-color":N,"--tooltip-box-shadow":R,"--tooltip-border-radius":Y}},i.createElement("div",{ref:P,className:f("tooltip-shadow")}),!C&&i.createElement("div",{ref:B,className:f("tooltip-arrow")},i.createElement("span",null,i.createElement(d,{className:f("tooltip-arrow-icon")}))),i.createElement("div",{ref:A,className:f("tooltip-text")},i.createElement("div",{className:f("speech-bubble-wrap")},i.createElement("div",{className:f("speech-bubble"),style:{width:b}},i.createElement("div",null,j))))))};

"use client";
"use strict";var e=require("../../_virtual/_tslib.js"),r=require("react"),t=require("../../utils/forReactUtils.js"),n=require("../loadings/Spinner.js"),l=require("./InfiniteScroll.module.scss.js");const u=t.makeCxFunc(l);var o=t=>{var{className:l="",tag:o="div",list:c,scrollTarget:i=null,rootMargin:s=100,loading:a,loadingElement:d=r.createElement(n,null),children:f,handleLoadMore:g}=t,v=e.__rest(t,["className","tag","list","scrollTarget","rootMargin","loading","loadingElement","children","handleLoadMore"]);const h=r.useRef(null),m=r.useRef(c),E=r.useRef("totalCount"in v?v.totalCount:void 0),M=r.useRef("hasMore"in v?v.hasMore:void 0),R=r.useRef(a),C=r.useRef(-1),[b,p]=r.useState(0),q=r.useMemo((()=>"undefined"==typeof window?null:new IntersectionObserver(((e,r)=>{null!==(null==h?void 0:h.current)&&e[0].intersectionRatio>.2&&(R.current||(p((e=>e+1)),r.disconnect()))}),{root:i?"current"in i?i.current:i:null,rootMargin:"".concat(s,"px 0px"),threshold:[.1,.2,.5,.8,.9,1]})),[h,s,i]),N=r.useCallback((()=>{if(!m.current||R.current)return!1;let e=m.current.length>0;return e=void 0!==E.current?E.current>m.current.length:!!M.current,e}),[]);return r.useEffect((()=>{var e;b>0&&C.current<b&&(null!==(e=m.current)&&void 0!==e?e:[]).length&&N()&&(C.current=b,g&&g())}),[b,N,g]),r.useEffect((()=>{const e=null==h?void 0:h.current;return e&&(null==q||q.observe(e)),()=>{e&&q&&q.unobserve(e)}}),[h,c,q]),r.useEffect((()=>{"totalCount"in v?-1!==C.current&&m.current&&c&&m.current.length===c.length&&v.totalCount>c.length||(E.current=v.totalCount):M.current=v.hasMore,m.current=[...c||[]]}),[c,v]),r.useEffect((()=>{R.current=a}),[a]),r.createElement("div",{className:u(l,"infinite-scroll")},r.createElement(o||"div",{children:f}),r.createElement("div",{ref:h,className:u("io-target")},r.createElement("div",{className:u("infinite-scroll-loading",{active:a&&(null!=c?c:[]).length})},a&&(null!=c?c:[]).length>0&&d)))};module.exports=o;

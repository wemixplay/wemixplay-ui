"use strict";var e=require("@babel/runtime/helpers/toConsumableArray"),r=require("@babel/runtime/helpers/slicedToArray"),n=require("../../_virtual/_tslib.js"),t=require("react"),l=require("../../utils/forReactUtils.js"),u=require("../loadings/Spinner.js"),i=require("./InfiniteScroll.module.scss.js"),o=l.makeCxFunc(i);module.exports=function(l){var i=l.className,c=void 0===i?"":i,a=l.tag,s=void 0===a?"div":a,d=l.list,f=l.scrollTarget,v=void 0===f?null:f,g=l.rootMargin,h=void 0===g?100:g,m=l.loading,E=l.loadingElement,b=void 0===E?t.createElement(u,null):E,M=l.children,C=l.handleLoadMore,R=n.__rest(l,["className","tag","list","scrollTarget","rootMargin","loading","loadingElement","children","handleLoadMore"]),p=t.useRef(null),q=t.useRef(d),N=t.useRef("totalCount"in R?R.totalCount:void 0),j=t.useRef("hasMore"in R?R.hasMore:void 0),x=t.useRef(m),_=t.useRef(-1),w=t.useState(0),y=r(w,2),S=y[0],T=y[1],k=t.useMemo((function(){return"undefined"==typeof window?null:new IntersectionObserver((function(e,r){null!==(null==p?void 0:p.current)&&e[0].intersectionRatio>.2&&(x.current||(T((function(e){return e+1})),r.disconnect()))}),{root:v?"current"in v?v.current:v:null,rootMargin:"".concat(h,"px 0px"),threshold:[.1,.2,.5,.8,.9,1]})}),[p,h,v]),A=t.useCallback((function(){if(!q.current||x.current)return!1;q.current.length;return void 0!==N.current?N.current>q.current.length:!!j.current}),[]);return t.useEffect((function(){var e;S>0&&_.current<S&&(null!==(e=q.current)&&void 0!==e?e:[]).length&&A()&&(_.current=S,C&&C())}),[S,A,C]),t.useEffect((function(){var e=null==p?void 0:p.current;return e&&(null==k||k.observe(e)),function(){e&&k&&k.unobserve(e)}}),[p,d,k]),t.useEffect((function(){"totalCount"in R?-1!==_.current&&q.current&&d&&q.current.length===d.length&&R.totalCount>d.length||(N.current=R.totalCount):j.current=R.hasMore,q.current=e(d||[])}),[d,R]),t.useEffect((function(){x.current=m}),[m]),t.createElement("div",{className:o(c,"infinite-scroll")},t.createElement(s||"div",{children:M}),t.createElement("div",{ref:p,className:o("io-target")},t.createElement("div",{className:o("infinite-scroll-loading",{active:m&&(null!=d?d:[]).length})},m&&(null!=d?d:[]).length>0&&b)))};

"use strict";var e=require("@babel/runtime/helpers/slicedToArray"),t=require("react"),r=require("./FeedIframesView.module.scss.js"),n=require("../carousel/Carousel.js"),u=require("../../assets/svgs/ico-delete-x.svg.js"),a=require("../../utils/forReactUtils.js"),o=require('./../../ext/react-youtube/dist/YouTube.esm.js'),i="wp_ui_youtube_is_mute",c=a.makeCxFunc(r),s=t.forwardRef((function(r,a){var s=r.className,l=void 0===s?"":s,d=r.media,m=void 0===d?[]:d,f=r.intersectionVideo,p=r.handleDeleteIframe,v=t.useRef(),w=t.useRef(),y=t.useRef("NOT_YET"),b=t.useRef({playTimeoutId:0,pauseTimeoutId:0}),I=t.useState(!1),E=e(I,2),g=E[0],T=E[1],N=t.useCallback((function(t){var r=t.split("?");return e(r,1)[0].split("/").pop()}),[]),V=t.useCallback((function(e){v.current&&(Number(localStorage.getItem(i)||0)?v.current.mute():v.current.unMute(),-1===e.data?y.current="NOT_YET":0===e.data?y.current="ENDED":1===e.data?y.current="PLAYING":2===e.data?y.current="PAUSED":3===e.data?y.current="BUFFERING":5===e.data&&(y.current="CUED"))}),[]),k=t.useCallback((function(){v.current&&v.current.playVideo()}),[]),C=t.useCallback((function(){v.current&&v.current.pauseVideo()}),[]),R=t.useCallback((function(){var e;v.current&&(null===(e=v.current)||void 0===e?void 0:e.playerInfo)&&(localStorage.getItem(i)?v.current.isMuted()?localStorage.setItem(i,"1"):localStorage.setItem(i,"0"):(v.current.mute(),localStorage.setItem(i,"1")))}),[]),S=t.useMemo((function(){if("undefined"!=typeof window&&g&&f)return window.IntersectionObserver?new IntersectionObserver((function(e){var t,r,n,u;window.clearTimeout(b.current.playTimeoutId),v.current&&(null===(t=v.current)||void 0===t?void 0:t.playerInfo)&&((null===(r=e[0])||void 0===r?void 0:r.intersectionRatio)>0&&v.current.addEventListener("onVolumeChange",R),(null===(n=e[0])||void 0===n?void 0:n.intersectionRatio)>.8&&"PAUSED"!==y.current?b.current.playTimeoutId=window.setTimeout((function(){v.current.playVideo()}),500):(null===(u=e[0])||void 0===u?void 0:u.intersectionRatio)<=.8&&(v.current.pauseVideo(),b.current.pauseTimeoutId=window.setTimeout((function(){y.current="AUTO_PAUSED"}),200)))}),{threshold:[0,.25,.5,.75,1]}):void 0}),[f,g,R]);return t.useEffect((function(){var e=w.current;if(S&&g)return S.observe(e),function(){S.unobserve(e)}}),[g]),t.useImperativeHandle(a,(function(){return w.current?(w.current.playState=y.current,w.current.playVideo=k,w.current.pauseVideo=C,w.current):w.current})),t.createElement("div",{className:c(l,"feed-iframe-views")},t.createElement(n,{className:c("iframe-preview-slider"),freeMode:!0,loop:!1,slidesPerView:"auto",spaceBetween:10},m.map((function(e,r){return t.createElement("div",{key:"".concat(e.src,"-").concat(r),className:c("preview-iframe-area")},!!p&&t.createElement("button",{className:c("btn-img-delete"),onClick:function(){return p({deleteIndex:r})}},t.createElement(u,null)),t.createElement("div",{ref:w,key:e.src,"data-src":e.src,className:c("preview-iframe-box")},"youtube"===e.type&&t.createElement(o,{videoId:N(e.src),opts:{host:"https://www.youtube-nocookie.com",playerVars:{autoplay:0,rel:0,controls:1,modestbranding:1,loop:1,enablejsapi:1,origin:"http://www.youtube-nocookie.com"}},onReady:function(e){v.current=e.target,T(!0)},onStateChange:V}),"twitch"===e.type&&t.createElement("iframe",{src:e.src})))}))))}));s.displayName="FeedIframesView",module.exports=s;

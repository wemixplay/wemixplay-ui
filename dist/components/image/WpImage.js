"use strict";var e=require("react"),r=require("./ImageIntersectionObserver.js"),t=require("./WpImage.module.scss.js"),a=require("../../utils/forReactUtils.js");"undefined"==typeof window&&(e.useLayoutEffect=e.useEffect);const s=a.makeCxFunc(t),n=t=>{let{className:a="",src:n="",errorSrc:c="",alt:o="",isBackground:l=!1,isLazy:u=!0,blur:i=!1,width:m,height:d,transitionDuration:g,transitionDelay:f,onImageLoad:b}=t;const y=e.useRef(null),h=e.useRef(null),[k,p]=e.useState(u?"waiting":"loaded"),v=e.useCallback((e=>p(e)),[]),w=e.useCallback(((e,r)=>{e.src=r,l?h.current.style.backgroundImage="url(".concat(r,")"):y.current.src=r}),[l]),C=e.useCallback((e=>{const r=e.target,t=r.src;t.endsWith(n)?(v("loaded"),null==b||b()):t.endsWith(c)&&v("error-loaded"),r.remove()}),[c,n,v,b]),E=e.useCallback((e=>{if("string"==typeof e)return;const r=e.target,t=r.src;c&&!t.endsWith(c)?w(r,c):(p("error"),r.remove())}),[c,w]),I=e.useCallback((()=>{const e=new Image;w(e,n),e.onload=C,e.onerror=E,e.onabort=E}),[w,n,C,E]),q=e.useMemo((()=>({transitionDuration:"".concat(g,"ms"),transitionDelay:"".concat(f,"ms")})),[g,f]);return e.useLayoutEffect((()=>{const e=l?h.current:y.current;return u?r.startObserving(e,I):I(),()=>{r.quitOberving(e)}}),[n,c,u,l,v,I]),e.createElement("span",{className:s(a,"lazy-img-wrapper",k,{blur:i}),style:{width:m,height:d}},l?e.createElement("span",{ref:h,className:s("target-background"),style:q}):e.createElement("img",{ref:y,className:s("target-image"),alt:o,style:q}))};var c=e.memo(n);module.exports=c;

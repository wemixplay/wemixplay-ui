"use strict";var e=require("@babel/runtime/helpers/slicedToArray"),r=require("react"),t=require("./ImageIntersectionObserver.js"),a=require("./WpImage.module.scss.js"),n=require("../../utils/forReactUtils.js");"undefined"==typeof window&&(r.useLayoutEffect=r.useEffect);var s=n.makeCxFunc(a),i=function(a){var n=a.className,i=void 0===n?"":n,o=a.src,u=void 0===o?"":o,c=a.errorSrc,l=void 0===c?"":c,d=a.alt,m=void 0===d?"":d,f=a.isBackground,g=void 0!==f&&f,v=a.isLazy,b=void 0===v||v,y=a.blur,h=void 0!==y&&y,k=a.width,p=a.height,w=a.transitionDuration,q=a.transitionDelay,C=a.onImageLoad,E=r.useRef(null),I=r.useRef(null),D=r.useState(b?"waiting":"loaded"),L=e(D,2),N=L[0],W=L[1],j=r.useCallback((function(e){return W(e)}),[]),O=r.useCallback((function(e,r){e.src=r,g?I.current.style.backgroundImage="url(".concat(r,")"):E.current.src=r}),[g]),R=r.useCallback((function(e){var r=e.target,t=r.src;t.endsWith(u)?(j("loaded"),null==C||C()):t.endsWith(l)&&j("error-loaded"),r.remove()}),[l,u,j,C]),x=r.useCallback((function(e){if("string"!=typeof e){var r=e.target,t=r.src;l&&!t.endsWith(l)?O(r,l):(W("error"),r.remove())}}),[l,O]),z=r.useCallback((function(){var e=new Image;O(e,u),e.onload=R,e.onerror=x,e.onabort=x}),[O,u,R,x]),S=r.useMemo((function(){return{transitionDuration:"".concat(w,"ms"),transitionDelay:"".concat(q,"ms")}}),[w,q]);return r.useLayoutEffect((function(){var e=g?I.current:E.current;return b?t.startObserving(e,z):z(),function(){t.quitOberving(e)}}),[u,l,b,g,j,z]),r.createElement("span",{className:s(i,"lazy-img-wrapper",N,{blur:h}),style:{width:k,height:p}},g?r.createElement("span",{ref:I,className:s("target-background"),style:S}):r.createElement("img",{ref:E,className:s("target-image"),alt:m,style:S}))},o=r.memo(i);module.exports=o;

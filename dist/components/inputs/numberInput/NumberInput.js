"use strict";var e=require("@babel/runtime/helpers/slicedToArray"),n=require("../../../_virtual/_tslib.js"),r=require("decimal.js"),t=require('./../../../ext/lodash/last.js'),u=require('./../../../ext/lodash/replace.js'),i=require("react"),a=require("../../../utils/forReactUtils.js"),o=require("../../../utils/valueParserUtils.js"),l=require("../../../assets/svgs/keyboard-arrow-down-2.svg.js"),c=require("../../../assets/svgs/keyboard-arrow-up-2.svg.js"),s=require("../../ripple/Ripple.js"),d=require("./NumberInput.module.scss.js"),m=a.makeCxFunc(d),v=i.forwardRef((function(a,d){var v,f,p=a.className,w=void 0===p?"":p,b=a.step,g=void 0===b?1:b,h=a.error,E=a.isDirect,N=void 0===E||E,j=a.increaseStep,k=a.decreaseStep,C=a.maxLength,y=a.arrowUpElement,R=void 0===y?i.createElement(c,null):y,O=a.arrowDownElement,q=void 0===O?i.createElement(l,null):O,D=a.rippleOption,S=a.hideButton,T=a.handleChange,M=n.__rest(a,["className","step","error","isDirect","increaseStep","decreaseStep","maxLength","arrowUpElement","arrowDownElement","rippleOption","hideButton","handleChange","handleEnter"]),U=M.value,_=M.readOnly,x=M.disabled,P=M.min,B=M.max,W=void 0===B?"9999999999999":B,F=M.digit,I=void 0===F?18:F,L=M.onFocus,$=M.onBlur,A=i.useRef(),H=i.useRef(!1),V=i.useRef(),z=i.useRef(),G=i.useRef(),J=i.useRef(0),K=i.useRef(0),Q=i.useRef(1e3),X=i.useState(null!=U?U:""),Y=e(X,2),Z=Y[0],ee=Y[1],ne=i.useState(!1),re=e(ne,2),te=re[0],ue=re[1],ie=i.useMemo((function(){return x||new r(null!=P?P:0).cmp(new r(W))>0}),[x,W,P]),ae=i.useCallback((function(e,n,t){var u,i,a,o,l,c;return"up"===t?new r(e||0).add(new r(null!==(a=null!==(i=null===(u=z.current)||void 0===u?void 0:u.increase)&&void 0!==i?i:n)&&void 0!==a?a:1)).toDP(I,r.ROUND_DOWN).toString():new r(e||0).sub(new r(null!==(c=null!==(l=null===(o=z.current)||void 0===o?void 0:o.decrease)&&void 0!==l?l:n)&&void 0!==c?c:1)).toDP(I,r.ROUND_DOWN).toString()}),[I]),oe=i.useCallback((function(e){return void 0===e||!e||ie?"":e.endsWith(".")?e:void 0!==P&&new r(Number(e)).lt(new r(P))?String(P):void 0!==W&&new r(o.commaStrToNumber(e||"")).gt(new r(W))?String(W):e}),[P,W,ie]),le=i.useCallback((function(e){return ie?"":e.endsWith(".")?e:oe(e)}),[ie,oe]),ce=i.useCallback((function(e){var n=e.type,r=e.e;if(A.current&&!ie){var i=A.current,a=i.value,l=i.name,c=function(e){var n,r=null===(n=null==e?void 0:e.target)||void 0===n?void 0:n.value;return u(r,/^0+[\d,]/gm,(function(e){return t(e)})).replace(/[^\d.-]/g,"")}({target:{value:a}}),s=I?new RegExp("^[0-9]*[.]{0,1}[0-9]{0,".concat(I,"}$"),"gm"):/^\d{0,18}$/;c.match(s)&&(void 0!==C&&(c||"").split(".")[0].replace(/[^0-9]/g,"").length>Number(C)||(A.current.value=o.makeParts(c).join("."),V.current!==c&&(T&&T(c,l,{type:n}),r&&M.onChange&&M.onChange(r),V.current=c),ee(c)))}}),[ie,I,C,T,M]),se=i.useCallback((function(e,n){A.current&&(ue(n),n?L&&L(e):(A.current.value=le(A.current.value),ce({}),$&&$(e)))}),[L,le,ce,$]),de=i.useCallback((function(e){var n,r;if(ie||_)return H.current=!1,void window.clearTimeout(J.current);V.current=ae(null!==(n=V.current)&&void 0!==n?n:"0",G.current,e),V.current=oe(null!==(r=V.current)&&void 0!==r?r:"0"),ee(String(V.current)),T&&T(V.current,M.name,{type:e}),H.current&&(window.clearTimeout(K.current),K.current=window.setTimeout((function(){de(e),Q.current>100&&(Q.current-=Q.current/5)}),Q.current))}),[ae,oe,ie,T,M.name,_]),me=i.useCallback((function(e){if(ie||_)return H.current=!1,void window.clearTimeout(J.current);J.current=window.setTimeout((function(){H.current=!0,de(e)}),500)}),[ie,de,_]),ve=i.useCallback((function(e){if(ie||_)return H.current=!1,void window.clearTimeout(J.current);H.current=!1,Q.current=500,window.clearTimeout(J.current),e&&ce({type:e})}),[ie,ce,_]);return i.useEffect((function(){void 0!==U&&ee(U)}),[U]),i.useEffect((function(){G.current=g}),[g]),i.useEffect((function(){z.current={increase:j,decrease:k}}),[j,k]),i.useImperativeHandle(d,(function(){return A.current})),i.createElement("div",{className:m("number-input",w,{focus:te,readonly:_,disabled:x,error:h})},i.createElement("div",{className:m("number-inp-cont")},i.createElement("input",Object.assign({},M,{ref:d||A,type:"text",inputMode:"decimal",value:null!==(v=o.makeParts(Z).join("."))&&void 0!==v?v:"",defaultValue:null!==(f=o.makeParts(U).join("."))&&void 0!==f?f:"",readOnly:!N,onChange:function(e){return ce({e:e})},onFocus:function(e){return se(e,!0)},onBlur:function(e){return se(e,!1)}})),!S&&i.createElement("div",{className:m("number-btn-area")},i.createElement(s.default,Object.assign({},D,{disabled:ie||(null==D?void 0:D.disabled)}),i.createElement("button",{"data-type":"up",className:m("number-btn","up"),disabled:ie||W===Z,onMouseDown:function(){return me("up")},onMouseUp:function(){return ve("up")},onMouseOut:function(){return ve()},onClick:function(){return de("up")}},R)),i.createElement(s.default,Object.assign({},D,{disabled:ie||(null==D?void 0:D.disabled)}),i.createElement("button",{"data-type":"down",className:m("number-btn","down"),disabled:ie||P===Z,onMouseDown:function(){return me("down")},onMouseUp:function(){return ve("down")},onMouseOut:function(){return ve()},onClick:function(){return de("down")}},q)))))}));v.displayName="NumberInput";var f=v;module.exports=f;

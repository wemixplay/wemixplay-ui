"use strict";var e=require("../../../_virtual/_tslib.js"),r=require("decimal.js"),n=require('./../../../ext/lodash/last.js'),t=require('./../../../ext/lodash/replace.js'),u=require("react"),a=require("../../../utils/forReactUtils.js"),l=require("../../../utils/valueParserUtils.js"),s=require("../../../assets/svgs/keyboard-arrow-down-2.svg.js"),o=require("../../../assets/svgs/keyboard-arrow-up-2.svg.js"),i=require("../../ripple/Ripple.js"),c=require("./NumberInput.module.scss.js");const d=a.makeCxFunc(c),m=u.forwardRef(((a,c)=>{var m,p,{className:v="",step:w=1,error:b,isDirect:g=!0,increaseStep:f,decreaseStep:E,maxLength:h,arrowUpElement:N=u.createElement(o,null),arrowDownElement:j=u.createElement(s,null),rippleOption:k,hideButton:C,handleChange:R,handleEnter:y}=a,O=e.__rest(a,["className","step","error","isDirect","increaseStep","decreaseStep","maxLength","arrowUpElement","arrowDownElement","rippleOption","hideButton","handleChange","handleEnter"]);const{value:D,readOnly:S,disabled:q,min:M,max:T="9999999999999",digit:U=18,onFocus:_,onBlur:x}=O,P=u.useRef(),B=u.useRef(!1),W=u.useRef(),F=u.useRef(),I=u.useRef(),L=u.useRef(0),$=u.useRef(0),H=u.useRef(1e3),[V,z]=u.useState(null!=D?D:""),[A,G]=u.useState(!1),J=u.useMemo((()=>q||new r(null!=M?M:0).cmp(new r(T))>0),[q,T,M]),K=u.useCallback(((e,n,t)=>{var u,a,l,s,o,i;return"up"===t?new r(e||0).add(new r(null!==(l=null!==(a=null===(u=F.current)||void 0===u?void 0:u.increase)&&void 0!==a?a:n)&&void 0!==l?l:1)).toDP(U,r.ROUND_DOWN).toString():new r(e||0).sub(new r(null!==(i=null!==(o=null===(s=F.current)||void 0===s?void 0:s.decrease)&&void 0!==o?o:n)&&void 0!==i?i:1)).toDP(U,r.ROUND_DOWN).toString()}),[U]),Q=u.useCallback((e=>void 0===e||!e||J?"":e.endsWith(".")?e:void 0!==M&&new r(Number(e)).lt(new r(M))?String(M):void 0!==T&&new r(l.commaStrToNumber(e||"")).gt(new r(T))?String(T):e),[M,T,J]),X=u.useCallback((e=>J?"":e.endsWith(".")?e:Q(e)),[J,Q]),Y=u.useCallback((e=>{let{type:r,e:u}=e;if(!P.current||J)return;const{value:a,name:s}=P.current,o=(e=>{var r;const u=null===(r=null==e?void 0:e.target)||void 0===r?void 0:r.value;return t(u,/^0+[\d,]/gm,(e=>n(e))).replace(/[^\d.-]/g,"")})({target:{value:a}}),i=U?new RegExp("^[0-9]*[.]{0,1}[0-9]{0,".concat(U,"}$"),"gm"):/^\d{0,18}$/;o.match(i)&&(void 0!==h&&(o||"").split(".")[0].replace(/[^0-9]/g,"").length>Number(h)||(P.current.value=l.makeParts(null!=o?o:"").join("."),W.current!==o&&(R&&R(o,s,{type:r}),u&&O.onChange&&O.onChange(u),W.current=o),z(o)))}),[J,U,h,R,O]),Z=u.useCallback(((e,r)=>{P.current&&(G(r),r?_&&_(e):(P.current.value=X(P.current.value),Y({}),x&&x(e)))}),[_,X,Y,x]),ee=u.useCallback((e=>{var r,n;if(J||S)return B.current=!1,void window.clearTimeout(L.current);W.current=K(null!==(r=W.current)&&void 0!==r?r:"0",I.current,e),W.current=Q(null!==(n=W.current)&&void 0!==n?n:"0"),z(String(W.current)),R&&R(W.current,O.name,{type:e}),B.current&&(window.clearTimeout($.current),$.current=window.setTimeout((()=>{ee(e),H.current>100&&(H.current-=H.current/5)}),H.current))}),[K,Q,J,R,O.name,S]),re=u.useCallback((e=>{if(J||S)return B.current=!1,void window.clearTimeout(L.current);L.current=window.setTimeout((()=>{B.current=!0,ee(e)}),500)}),[J,ee,S]),ne=u.useCallback((e=>{if(J||S)return B.current=!1,void window.clearTimeout(L.current);B.current=!1,H.current=500,window.clearTimeout(L.current),e&&Y({type:e})}),[J,Y,S]);return u.useEffect((()=>{void 0!==D&&z(D)}),[D]),u.useEffect((()=>{I.current=w}),[w]),u.useEffect((()=>{F.current={increase:f,decrease:E}}),[f,E]),u.useImperativeHandle(c,(()=>P.current)),u.createElement("div",{className:d("number-input",v,{focus:A,readonly:S,disabled:q,error:b})},u.createElement("div",{className:d("number-inp-cont")},u.createElement("input",Object.assign({},O,{ref:c||P,type:"text",inputMode:"decimal",value:null!==(m=l.makeParts(null!=V?V:"").join("."))&&void 0!==m?m:"",defaultValue:null!==(p=l.makeParts(null!=D?D:"").join("."))&&void 0!==p?p:"",readOnly:!g,onChange:e=>Y({e:e}),onFocus:e=>Z(e,!0),onBlur:e=>Z(e,!1)})),!C&&u.createElement("div",{className:d("number-btn-area")},u.createElement(i.default,Object.assign({},k,{disabled:J||(null==k?void 0:k.disabled)}),u.createElement("button",{"data-type":"up",className:d("number-btn","up"),disabled:J||T===V,onMouseDown:()=>re("up"),onMouseUp:()=>ne("up"),onMouseOut:()=>ne(),onClick:()=>ee("up")},N)),u.createElement(i.default,Object.assign({},k,{disabled:J||(null==k?void 0:k.disabled)}),u.createElement("button",{"data-type":"down",className:d("number-btn","down"),disabled:J||M===V,onMouseDown:()=>re("down"),onMouseUp:()=>ne("down"),onMouseOut:()=>ne(),onClick:()=>ee("down")},j)))))}));m.displayName="NumberInput";var p=m;module.exports=p;

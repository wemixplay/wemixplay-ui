"use strict";var e=require("@babel/runtime/helpers/slicedToArray"),n=require("../../../_virtual/_tslib.js"),r=require("decimal.js"),t=require("lodash-es"),u=require("react"),i=require("../../../utils/forReactUtils.js"),a=require("../../../utils/valueParserUtils.js"),o=require("../../../assets/svgs/keyboard-arrow-down-2.svg.js"),l=require("../../../assets/svgs/keyboard-arrow-up-2.svg.js"),c=require("../../ripple/Ripple.js"),s=require("./NumberInput.module.scss.js"),d=i.makeCxFunc(s),m=u.forwardRef((function(i,s){var m,v,f=i.className,p=void 0===f?"":f,w=i.step,b=void 0===w?1:w,g=i.error,E=i.isDirect,h=void 0===E||E,N=i.increaseStep,k=i.decreaseStep,C=i.maxLength,j=i.arrowUpElement,y=void 0===j?u.createElement(l,null):j,R=i.arrowDownElement,O=void 0===R?u.createElement(o,null):R,D=i.rippleOption,S=i.hideButton,q=i.handleChange,T=n.__rest(i,["className","step","error","isDirect","increaseStep","decreaseStep","maxLength","arrowUpElement","arrowDownElement","rippleOption","hideButton","handleChange","handleEnter"]),M=T.value,U=T.readOnly,x=T.disabled,P=T.min,_=T.max,B=void 0===_?"9999999999999":_,W=T.digit,F=void 0===W?18:W,I=T.onFocus,L=T.onBlur,$=u.useRef(),A=u.useRef(!1),H=u.useRef(),V=u.useRef(),z=u.useRef(),G=u.useRef(0),J=u.useRef(0),K=u.useRef(1e3),Q=u.useState(null!=M?M:""),X=e(Q,2),Y=X[0],Z=X[1],ee=u.useState(!1),ne=e(ee,2),re=ne[0],te=ne[1],ue=u.useMemo((function(){return x||new r(null!=P?P:0).cmp(new r(B))>0}),[x,B,P]),ie=u.useCallback((function(e,n,t){var u,i,a,o,l,c;return"up"===t?new r(e||0).add(new r(null!==(a=null!==(i=null===(u=V.current)||void 0===u?void 0:u.increase)&&void 0!==i?i:n)&&void 0!==a?a:1)).toDP(F,r.ROUND_DOWN).toString():new r(e||0).sub(new r(null!==(c=null!==(l=null===(o=V.current)||void 0===o?void 0:o.decrease)&&void 0!==l?l:n)&&void 0!==c?c:1)).toDP(F,r.ROUND_DOWN).toString()}),[F]),ae=u.useCallback((function(e){return void 0===e||!e||ue?"":e.endsWith(".")?e:void 0!==P&&new r(Number(e)).lt(new r(P))?String(P):void 0!==B&&new r(a.commaStrToNumber(e||"")).gt(new r(B))?String(B):e}),[P,B,ue]),oe=u.useCallback((function(e){return ue?"":e.endsWith(".")?e:ae(e)}),[ue,ae]),le=u.useCallback((function(e){var n=e.type,r=e.e;if($.current&&!ue){var u=$.current,i=u.value,o=u.name,l=function(e){var n,r=null===(n=null==e?void 0:e.target)||void 0===n?void 0:n.value;return t.replace(r,/^0+[\d,]/gm,(function(e){return t.last(e)})).replace(/[^\d.-]/g,"")}({target:{value:i}}),c=F?new RegExp("^[0-9]*[.]{0,1}[0-9]{0,".concat(F,"}$"),"gm"):/^\d{0,18}$/;l.match(c)&&(void 0!==C&&(l||"").split(".")[0].replace(/[^0-9]/g,"").length>Number(C)||($.current.value=a.makeParts(l).join("."),H.current!==l&&(q&&q(l,o,{type:n}),r&&T.onChange&&T.onChange(r),H.current=l),Z(l)))}}),[ue,F,C,q,T]),ce=u.useCallback((function(e,n){$.current&&(te(n),n?I&&I(e):($.current.value=oe($.current.value),le({}),L&&L(e)))}),[I,oe,le,L]),se=u.useCallback((function(e){var n,r;if(ue||U)return A.current=!1,void window.clearTimeout(G.current);H.current=ie(null!==(n=H.current)&&void 0!==n?n:"0",z.current,e),H.current=ae(null!==(r=H.current)&&void 0!==r?r:"0"),Z(String(H.current)),q&&q(H.current,T.name,{type:e}),A.current&&(window.clearTimeout(J.current),J.current=window.setTimeout((function(){se(e),K.current>100&&(K.current-=K.current/5)}),K.current))}),[ie,ae,ue,q,T.name,U]),de=u.useCallback((function(e){if(ue||U)return A.current=!1,void window.clearTimeout(G.current);G.current=window.setTimeout((function(){A.current=!0,se(e)}),500)}),[ue,se,U]),me=u.useCallback((function(e){if(ue||U)return A.current=!1,void window.clearTimeout(G.current);A.current=!1,K.current=500,window.clearTimeout(G.current),e&&le({type:e})}),[ue,le,U]);return u.useEffect((function(){void 0!==M&&Z(M)}),[M]),u.useEffect((function(){z.current=b}),[b]),u.useEffect((function(){V.current={increase:N,decrease:k}}),[N,k]),u.useImperativeHandle(s,(function(){return $.current})),u.createElement("div",{className:d("number-input",p,{focus:re,readonly:U,disabled:x,error:g})},u.createElement("div",{className:d("number-inp-cont")},u.createElement("input",Object.assign({},T,{ref:s||$,type:"text",inputMode:"decimal",value:null!==(m=a.makeParts(Y).join("."))&&void 0!==m?m:"",defaultValue:null!==(v=a.makeParts(M).join("."))&&void 0!==v?v:"",readOnly:!h,onChange:function(e){return le({e:e})},onFocus:function(e){return ce(e,!0)},onBlur:function(e){return ce(e,!1)}})),!S&&u.createElement("div",{className:d("number-btn-area")},u.createElement(c.default,Object.assign({},D,{disabled:ue||(null==D?void 0:D.disabled)}),u.createElement("button",{"data-type":"up",className:d("number-btn","up"),disabled:ue||B===Y,onMouseDown:function(){return de("up")},onMouseUp:function(){return me("up")},onMouseOut:function(){return me()},onClick:function(){return se("up")}},y)),u.createElement(c.default,Object.assign({},D,{disabled:ue||(null==D?void 0:D.disabled)}),u.createElement("button",{"data-type":"down",className:d("number-btn","down"),disabled:ue||P===Y,onMouseDown:function(){return de("down")},onMouseUp:function(){return me("down")},onMouseOut:function(){return me()},onClick:function(){return se("down")}},O)))))}));m.displayName="NumberInput",module.exports=m;

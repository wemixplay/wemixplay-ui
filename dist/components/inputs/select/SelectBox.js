"use strict";var e=require("../../../_virtual/_tslib.js"),l=require("react"),r=require("../../../hooks/useClickOutside.js"),a=require("../../../utils/forReactUtils.js"),t=require("../../noData/NoDataText.js"),o=require("../../portal/Portal.js"),n=require("../../../assets/svgs/ico-accordion.svg.js"),s=require("./SelectBox.module.scss.js"),u=require("./SelectDropBox.js");const c=a.makeCxFunc(s),i=l.forwardRef(((a,s)=>{const{className:i="",children:p,name:d,value:h,error:v,search:m,mobileLabel:f,placeholder:C,disabled:g,readOnly:b,dropBoxClassName:x,selectArrow:w=l.createElement(n,null),keepDropDown:E,searchPlaceholder:k="Search",showCloseBtn:y,whenScrollCloseDropBox:D,noDataMsg:S=l.createElement(t,{className:c("no-data")}),onClick:B,handleChange:N}=a,j=e.__rest(a,["className","children","name","value","error","search","mobileLabel","placeholder","disabled","readOnly","dropBoxClassName","selectArrow","keepDropDown","searchPlaceholder","showCloseBtn","whenScrollCloseDropBox","noDataMsg","onClick","handleChange"]),q=l.useRef(null),O=l.useRef(null),P=l.useRef(null),[M,A]=l.useState(null!=h?h:""),[L,F]=l.useState(""),[R,T]=l.useState(""),[_,I]=l.useState(!1),[K,U]=l.useState(!1),H=l.useMemo((()=>{const e=e=>{let{value:l}=e;g||(A(l),N&&N(l,d),q.current.value=String(l),j.onChange&&j.onChange({target:q.current}),E||I(!1))},r=a=>(null!=a?a:[]).flatMap((a=>{var t;if(!(null==a?void 0:a.props))return[];if("Option"===(null===(t=a.type)||void 0===t?void 0:t.displayName)){let r;return a.props.text||(r="string"==typeof a.props.label?a.props.label:"string"==typeof a.props.children?a.props.children:a.props.value.toString()),l.cloneElement(a,Object.assign(Object.assign({},a.props),{text:r.toLowerCase(),selectedValue:M,searchText:L,handleChange:e}))}return Array.isArray(a.props.children)?r(a.props.children):[]})),a=l.Children.map(p,(e=>e));return r(a)}),[p,g,N,E,d,L,M,j]),V=l.useMemo((()=>H.filter((e=>e.props.text.toLowerCase().includes(R.toLowerCase())))),[H,R]),z=l.useMemo((()=>H.find((e=>e.props.value===M||e.props.value===h))),[H,M,h]),G=l.useMemo((()=>{var e,l,r,a,t;if(!z)return{text:null!==(a=null!==(l=null!=C?C:null===(e=H[0])||void 0===e?void 0:e.props.label)&&void 0!==l?l:null===(r=H[0])||void 0===r?void 0:r.props.children)&&void 0!==a?a:"",isPlaceholder:!!C};const{label:o,children:n}=z.props;return{text:null!==(t=null!=o?o:n)&&void 0!==t?t:"",isPlaceholder:!1}}),[z,H,C]),J=l.useCallback((()=>{if(B)B();else{if(g||b)return;I((e=>!e))}}),[g,b,B]),Q=l.useCallback((e=>{F(e),T(e)}),[]),W=l.useCallback((()=>{if(!_)return void I(!0);const e=H.find((e=>e.props.text.includes(L.toLowerCase())));e&&(A(e.props.value),N&&N(e.props.value,d),q.current.value=e.props.value,j.onChange&&j.onChange({target:q.current}),I(!1),q.current.blur())}),[N,j,d,_,H,L]),X=l.useCallback((e=>{let l;const r=H.findIndex((e=>L?e.props.text===L:e.props.value===M));l="down"===e?r+1>=H.length?H[0]:H[r+1]:r<=0?H[H.length-1]:H[r-1];const a=l.props.text;F(a)}),[H,M,L]),Y=l.useCallback((e=>{"Enter"!==e.key||e.nativeEvent.isComposing?"ArrowDown"===e.key?(X("down"),e.preventDefault()):"ArrowUp"===e.key&&(X("up"),e.preventDefault()):W()}),[W,X]),Z=l.useCallback(((e,l)=>{U(l),l?j.onFocus&&j.onFocus(e):j.onBlur&&j.onBlur(e)}),[j]);return r(O,(e=>{var l;"button"in e&&2===e.button||(null===(l=P.current)||void 0===l?void 0:l.contains(e.target))||I(!1)}),{offTouchEvent:!0}),l.useEffect((()=>{if(H.length&&!C&&!z){const e=H[0].props.value;A(e)}}),[C,z,H]),l.useEffect((()=>{void 0!==h&&A(h)}),[h]),l.useEffect((()=>{_||F("")}),[_]),l.useImperativeHandle(s,(()=>(q.current.handleClickSelectBox=J,q.current))),l.createElement(l.Fragment,null,l.createElement("div",{ref:O,className:c("select-box",i,{open:_,focus:K,disabled:g,error:v,readonly:b,placeholder:G.isPlaceholder,"not-allow":g}),onClick:J},l.createElement("label",null,l.createElement("div",{className:c("value",{placeholder:G.isPlaceholder})},l.createElement("span",null,G.text)),l.createElement("input",Object.assign({},j,{ref:q,type:"text",value:M,name:d,readOnly:!0,onFocus:e=>Z(e,!0),onBlur:e=>Z(e,!1),onKeyDown:Y})),l.createElement("i",{className:c("ico-arrow")},w))),_&&l.createElement(o,null,l.createElement(u,{ref:P,className:x,label:f,inputEl:q.current,parentEl:O.current,setOpen:I,search:m,searchText:L,searchPlaceholder:k,showCloseBtn:y,whenScrollCloseDropBox:D,noDataMsg:S,handleSearchTextChange:Q,handleKeyPress:Y},V)))}));i.displayName="SelectBox";var p=i;module.exports=p;

"use client";
"use strict";var e=require("../../_virtual/_tslib.js"),r=require("react"),t=require("../../utils/forReactUtils.js"),n=require("./Counter.module.scss.js"),u=require("../../utils/valueParserUtils.js");const s=t.makeCxFunc(n),a=e=>{var r;return(null===(r=u.splitNumberStringByComma(String(e))[1])||void 0===r?void 0:r.length)||0},c=(e,r)=>new Promise((t=>{const n=setTimeout((()=>{t("pass")}),e);r.addEventListener("abort",(()=>{clearTimeout(n),t("aborted")}))}));var o=t=>{let{className:n="",endValue:o=0,startValue:l=0,delay:i=0,countOnIntersected:m=!0,duration:d=1500,separator:f=!0,iterationCount:p=1,pause:b=!1,digits:C=0,usePauseResume:k=!1,onEnd:v}=t;const g=r.useRef(null),R=r.useRef(l),w=r.useRef(0),q=r.useRef(d),E=r.useRef(null),h=r.useRef(null),y=r.useRef(b?"paused":"go"),N=r.useRef(null),[S,A]=r.useState(b),[F,j]=r.useState(!1),x=r.useMemo((()=>o>l?"up":"down"),[o,l]),M=r.useMemo((()=>void 0===C?a(o):C),[C,o]),P=r.useCallback((e=>{const r=e-w.current;return q.current=d-r,l+r/d*(o-l)}),[d,o,l]),T=r.useCallback((e=>{const[r,t]=u.splitNumberStringByComma(String(e)),n=r+(M&&t?".".concat(t.slice(0,M)):"");return f?u.formatNumberValueWithComma(n):n}),[M,f]),_=r.useCallback((e=>{const r=P(e);return R.current=r,T(r)}),[P,T]),V=r.useCallback((e=>{const{current:r}=g;r&&(r.innerHTML=e)}),[]),B=r.useCallback((()=>{R.current=l,q.current=d,w.current=performance.now(),E.current=null,y.current="go"}),[l,d]),I=r.useCallback((()=>new Promise((e=>{const r=t=>{if("props-changed"===y.current)return e("break");if("up"===x?R.current>=o:R.current<=o)return V(T(o)),e("done");V(_(t)),E.current=requestAnimationFrame(r)};B(),h.current=r,E.current=requestAnimationFrame(r)}))),[o,x,B,V,_,T]),L=r.useCallback((()=>e.__awaiter(void 0,void 0,void 0,(function*(){for(let e=0;e<p;e++){if(i>0){const r=yield c(i,N.current.signal);if("paused"===y.current){e--;continue}if("aborted"===r)break}const r=yield I();if("break"===r)break;e===p-1&&"done"===r&&j(!0)}h.current=null}))),[i,p,I]),O=r.useCallback((()=>{if(m&&"undefined"!=typeof Window){const e=new IntersectionObserver((r=>{let[{intersectionRatio:t}]=r;t>0&&(L(),e.disconnect())}),{root:null,rootMargin:"100px 0px",threshold:[.1,.2,.3,.4,.5,.7,.8,.9,1]});e.observe(g.current)}else L()}),[m,L]),U=r.useCallback((()=>{S?(y.current="go",h.current&&(w.current=performance.now()-(d-q.current),requestAnimationFrame(h.current))):(y.current="paused",cancelAnimationFrame(E.current)),A(!S)}),[d,S]);return r.useEffect((()=>(N.current=new AbortController,V(T(l)),A(b),setTimeout((()=>{y.current=b?"paused":"go"}),20),O(),()=>{N.current.abort(),y.current="props-changed"})),[l,o,i,d,f,p,C,b,V,T,O]),r.useEffect((()=>{F&&(null==v||v(),j(!1))}),[F,v]),r.createElement("span",{className:s("counter-wrapper",n)},r.createElement("span",{ref:g,className:s("counter-value")}),k&&r.createElement("button",{onClick:U},S?"resume":"pause"))};module.exports=o;

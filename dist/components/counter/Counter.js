"use strict";var e=require("@babel/runtime/helpers/slicedToArray"),r=require("@babel/runtime/regenerator"),n=require("../../_virtual/_tslib.js"),t=require("react"),u=require("../../utils/forReactUtils.js"),a=require("./Counter.module.scss.js"),o=require("../../utils/valueParserUtils.js"),c=u.makeCxFunc(a),i=function(e){var r;return(null===(r=o.splitNumberStringByComma(String(e))[1])||void 0===r?void 0:r.length)||0},s=function(e,r){return new Promise((function(n){var t=setTimeout((function(){n("pass")}),e);r.addEventListener("abort",(function(){clearTimeout(t),n("aborted")}))}))};module.exports=function(u){var a=u.className,l=void 0===a?"":a,f=u.endValue,d=void 0===f?0:f,m=u.startValue,b=void 0===m?0:m,v=u.delay,p=void 0===v?0:v,k=u.countOnIntersected,C=void 0===k||k,g=u.duration,x=void 0===g?1500:g,w=u.separator,R=void 0===w||w,q=u.iterationCount,h=void 0===q?1:q,E=u.pause,A=void 0!==E&&E,N=u.digits,S=void 0===N?0:N,y=u.usePauseResume,F=void 0!==y&&y,T=u.onEnd,j=t.useRef(null),M=t.useRef(b),P=t.useRef(0),_=t.useRef(x),V=t.useRef(null),B=t.useRef(null),I=t.useRef(A?"paused":"go"),L=t.useRef(null),O=t.useState(A),U=e(O,2),W=U[0],H=U[1],z=t.useState(!1),D=e(z,2),G=D[0],J=D[1],K=t.useMemo((function(){return d>b?"up":"down"}),[d,b]),Q=t.useMemo((function(){return void 0===S?i(d):S}),[S,d]),X=t.useCallback((function(e){var r=e-P.current;return _.current=x-r,b+r/x*(d-b)}),[x,d,b]),Y=t.useCallback((function(r){var n=o.splitNumberStringByComma(String(r)),t=e(n,2),u=t[0],a=t[1],c=u+(Q&&a?".".concat(a.slice(0,Q)):"");return R?o.formatNumberValueWithComma(c):c}),[Q,R]),Z=t.useCallback((function(e){var r=X(e);return M.current=r,Y(r)}),[X,Y]),$=t.useCallback((function(e){var r=j.current;r&&(r.innerHTML=e)}),[]),ee=t.useCallback((function(){M.current=b,_.current=x,P.current=performance.now(),V.current=null,I.current="go"}),[b,x]),re=t.useCallback((function(){return new Promise((function(e){var r=function(n){return"props-changed"===I.current?e("break"):("up"===K?M.current>=d:M.current<=d)?($(Y(d)),e("done")):($(Z(n)),void(V.current=requestAnimationFrame(r)))};ee(),B.current=r,V.current=requestAnimationFrame(r)}))}),[d,K,ee,$,Z,Y]),ne=t.useCallback((function(){return n.__awaiter(void 0,void 0,void 0,r.mark((function e(){var n,t,u;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<h)){e.next=20;break}if(!(p>0)){e.next=11;break}return e.next=5,s(p,L.current.signal);case 5:if(t=e.sent,"paused"!==I.current){e.next=9;break}return n--,e.abrupt("continue",17);case 9:if("aborted"!==t){e.next=11;break}return e.abrupt("break",20);case 11:return e.next=13,re();case 13:if("break"!==(u=e.sent)){e.next=16;break}return e.abrupt("break",20);case 16:n===h-1&&"done"===u&&J(!0);case 17:n++,e.next=1;break;case 20:B.current=null;case 21:case"end":return e.stop()}}),e)})))}),[p,h,re]),te=t.useCallback((function(){if(C&&"undefined"!=typeof Window){var r=new IntersectionObserver((function(n){e(n,1)[0].intersectionRatio>0&&(ne(),r.disconnect())}),{root:null,rootMargin:"100px 0px",threshold:[.1,.2,.3,.4,.5,.7,.8,.9,1]});r.observe(j.current)}else ne()}),[C,ne]),ue=t.useCallback((function(){W?(I.current="go",B.current&&(P.current=performance.now()-(x-_.current),requestAnimationFrame(B.current))):(I.current="paused",cancelAnimationFrame(V.current)),H(!W)}),[x,W]);return t.useEffect((function(){return L.current=new AbortController,$(Y(b)),H(A),setTimeout((function(){I.current=A?"paused":"go"}),20),te(),function(){L.current.abort(),I.current="props-changed"}}),[b,d,p,x,R,h,S,A,$,Y,te]),t.useEffect((function(){G&&(null==T||T(),J(!1))}),[G,T]),t.createElement("span",{className:c("counter-wrapper",l)},t.createElement("span",{ref:j,className:c("counter-value")}),F&&t.createElement("button",{onClick:ue},W?"resume":"pause"))};

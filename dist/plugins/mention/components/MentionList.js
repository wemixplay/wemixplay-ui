'use client';
"use strict";var e=require("react"),t=require("react-device-detect"),n=require("./MentionList.module.scss.js"),c=require("../../../utils/forReactUtils.js"),r=require("../../../components/avatars/Person.js"),s=require("../../../assets/svgs/ico-certified-v2.svg.js"),l=require("../../../hooks/useCheckDevice.js");const o=c.makeCxFunc(n),i=e.forwardRef(((n,c)=>{let{targetMentionId:i,className:a="",list:u,contentEditableEl:m,listElement:d,selectMentionItem:h,closeMentionList:f}=n;const b=e.useRef(),p=e.useRef(),v=e.useRef({x:0,y:0}),[g,E]=e.useState({}),[y,k]=e.useState(0),{isMobile:w}=l(),C=e.useCallback((()=>{if(!(null!=u?u:[]).length)return;const e=0===y?u.length-1:y-1;k(e);const t=p.current.querySelector("li:nth-child(".concat(e+1,")"));p.current.scrollTop=t.offsetTop-20}),[y,u]),L=e.useCallback((()=>{if(!(null!=u?u:[]).length)return;const e=y===u.length-1?0:y+1;k(e);const t=p.current.querySelector("li:nth-child(".concat(e+1,")"));p.current.scrollTop=t.offsetTop-20}),[u,y]),q=e.useCallback((e=>{if((null!=u?u:[]).length)return u[null!=e?e:y]}),[y,u]),x=e.useCallback((e=>{t.isDesktop&&k(e)}),[]),N=e.useCallback((e=>{k(e),h(e)}),[h]),T=e.useCallback((e=>{var t,n;if(!e)return;const{offsetHeight:c}=e,r=e.getBoundingClientRect(),s="fixed"===document.body.style.position&&!!document.body.style.top&&Number(document.body.style.top.replace("px",""))<0?-1*Number(document.body.style.top.replace("px","")):window.scrollY,l=r.left+b.current.offsetWidth-window.innerWidth,o=r.top+s,i=r.bottom+s,a=l>0?r.left-l-10:r.left,u=s,m=s+window.innerHeight;let d="bottom",h=null!==(t=b.current.clientHeight)&&void 0!==t?t:0;h>m-i&&(d=o-u>m-i?"top":"bottom"),h>o-u&&h>m-i&&(p.current.style.height="".concat("top"===d?o-u-32:m-i-32,"px")),h=null!==(n=b.current.clientHeight)&&void 0!==n?n:0;const f={position:"absolute",zIndex:"9999999",visibility:"visible"};switch(w&&(f.maxWidth="95%"),d){case"top":f.top=o-h,f.left=w?"50%":a;break;case"bottom":f.top=o+c,f.left=w?"50%":a}return w&&(f.transform="translateX(-50%)"),f}),[w]),j=e.useCallback((e=>{v.current={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}}),[]),H=e.useCallback((e=>{const t=p.current.scrollTop,n=p.current.scrollHeight;(e.cancelable&&t<=0&&e.changedTouches[0].clientY-v.current.y>0||e.cancelable&&t>=n-p.current.clientHeight&&v.current.y-e.changedTouches[0].clientY>0)&&e.preventDefault()}),[]);return e.useImperativeHandle(c,(()=>(b.current.handleArrowUp=C,b.current.handleArrowDown=L,b.current.handleSubmit=q,b.current))),e.useEffect((()=>{if(m.current&&i){const e=m.current.querySelector("#".concat(i)),t=T(e);E(t)}else E({})}),[i,u.length,T]),e.useEffect((()=>{k(0)}),[u]),e.useEffect((()=>{const e=e=>{const t=e.target;!b.current||b.current.contains(t)||t.classList.contains("mention")||f()};return document.addEventListener("click",e),window.addEventListener("resize",f),()=>{document.removeEventListener("click",e),window.removeEventListener("resize",f)}}),[f]),e.useEffect((()=>{const e=p.current;return e.addEventListener("touchstart",j),e.addEventListener("touchmove",H),()=>{e.removeEventListener("touchstart",j),e.removeEventListener("touchmove",H)}}),[j,H]),e.createElement("div",{ref:b,className:o(a,"mention-list"),contentEditable:!1,style:Object.assign(Object.assign({},g),{display:(null!=u?u:[]).length>0?"block":"none"})},e.createElement("ul",{ref:p,className:o("mention-list-area")},(null!=u?u:[]).map(((t,n)=>e.createElement("li",{className:o("mention-item",{active:y===n}),key:"".concat(t.name,"-").concat(n),"data-id":t.id,onMouseOver:()=>x(n),onClick:()=>N(n)},d?d(t):e.createElement(e.Fragment,null,e.createElement(r,{src:t.profileImg,size:"custom",className:o("thumb")}),e.createElement("p",{className:o("item-info")},e.createElement("strong",{className:o("item-title")},t.name),!!t.isOfficial&&e.createElement(s,{width:12,height:12}))))))))}));i.displayName="MentionList",module.exports=i;

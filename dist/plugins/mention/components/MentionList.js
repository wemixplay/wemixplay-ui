"use strict";var e=require("@babel/runtime/helpers/slicedToArray"),t=require("react"),n=require("react-device-detect"),r=require("./MentionList.module.scss.js"),c=require("../../../utils/forReactUtils.js"),i=require("../../../components/avatars/Person.js"),o=require("../../../assets/svgs/ico-certified-v2.svg.js"),l=require("../../../hooks/useCheckDevice.js"),s=c.makeCxFunc(r),a=t.forwardRef((function(r,c){var a=r.targetMentionId,u=r.className,f=void 0===u?"":u,d=r.list,m=r.contentEditableEl,h=r.listElement,v=r.selectMentionItem,b=r.closeMentionList,p=t.useRef(),g=t.useRef(),E=t.useRef({x:0,y:0}),y=t.useState({}),k=e(y,2),w=k[0],C=k[1],L=t.useState(0),q=e(L,2),x=q[0],N=q[1],T=l().isMobile,j=t.useCallback((function(){if((null!=d?d:[]).length){var e=0===x?d.length-1:x-1;N(e);var t=g.current.querySelector("li:nth-child(".concat(e+1,")"));g.current.scrollTop=t.offsetTop-20}}),[x,d]),H=t.useCallback((function(){if((null!=d?d:[]).length){var e=x===d.length-1?0:x+1;N(e);var t=g.current.querySelector("li:nth-child(".concat(e+1,")"));g.current.scrollTop=t.offsetTop-20}}),[d,x]),M=t.useCallback((function(e){if((null!=d?d:[]).length)return d[null!=e?e:x]}),[x,d]),R=t.useCallback((function(e){n.isDesktop&&N(e)}),[]),S=t.useCallback((function(e){N(e),v(e)}),[v]),I=t.useCallback((function(e){var t,n;if(e){var r=e.offsetHeight,c=e.getBoundingClientRect(),i="fixed"===document.body.style.position&&!!document.body.style.top&&Number(document.body.style.top.replace("px",""))<0?-1*Number(document.body.style.top.replace("px","")):window.scrollY,o=c.left+p.current.offsetWidth-window.innerWidth,l=c.top+i,s=c.bottom+i,a=o>0?c.left-o-10:c.left,u=i,f=i+window.innerHeight,d="bottom",m=null!==(t=p.current.clientHeight)&&void 0!==t?t:0;m>f-s&&(d=l-u>f-s?"top":"bottom"),m>l-u&&m>f-s&&(g.current.style.height="".concat("top"===d?l-u-32:f-s-32,"px")),m=null!==(n=p.current.clientHeight)&&void 0!==n?n:0;var h={position:"absolute",zIndex:"9999999",visibility:"visible"};switch(T&&(h.maxWidth="95%"),d){case"top":h.top=l-m,h.left=T?"50%":a;break;case"bottom":h.top=l+r,h.left=T?"50%":a}return T&&(h.transform="translateX(-50%)"),h}}),[T]),z=t.useCallback((function(e){E.current={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}}),[]),D=t.useCallback((function(e){var t=g.current.scrollTop,n=g.current.scrollHeight;(e.cancelable&&t<=0&&e.changedTouches[0].clientY-E.current.y>0||e.cancelable&&t>=n-g.current.clientHeight&&E.current.y-e.changedTouches[0].clientY>0)&&e.preventDefault()}),[]);return t.useImperativeHandle(c,(function(){return p.current.handleArrowUp=j,p.current.handleArrowDown=H,p.current.handleSubmit=M,p.current})),t.useEffect((function(){if(m.current&&a){var e=m.current.querySelector("#".concat(a)),t=I(e);C(t)}else C({})}),[a,d.length,I]),t.useEffect((function(){N(0)}),[d]),t.useEffect((function(){var e=function(e){var t=e.target;!p.current||p.current.contains(t)||t.classList.contains("mention")||b()};return document.addEventListener("click",e),window.addEventListener("resize",b),function(){document.removeEventListener("click",e),window.removeEventListener("resize",b)}}),[b]),t.useEffect((function(){var e=g.current;return e.addEventListener("touchstart",z),e.addEventListener("touchmove",D),function(){e.removeEventListener("touchstart",z),e.removeEventListener("touchmove",D)}}),[z,D]),t.createElement("div",{ref:p,className:s(f,"mention-list"),contentEditable:!1,style:Object.assign(Object.assign({},w),{display:(null!=d?d:[]).length>0?"block":"none"})},t.createElement("ul",{ref:g,className:s("mention-list-area")},(null!=d?d:[]).map((function(e,n){return t.createElement("li",{className:s("mention-item",{active:x===n}),key:"".concat(e.name,"-").concat(n),"data-id":e.id,onMouseOver:function(){return R(n)},onClick:function(){return S(n)}},h?h(e):t.createElement(t.Fragment,null,t.createElement(i,{src:e.profileImg,size:"custom",className:s("thumb")}),t.createElement("p",{className:s("item-info")},t.createElement("strong",{className:s("item-title")},e.name),!!e.isOfficial&&t.createElement(o,{width:12,height:12}))))}))))}));a.displayName="MentionList",module.exports=a;

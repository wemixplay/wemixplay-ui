"use strict";var e=require("@babel/runtime/helpers/slicedToArray"),t=require("react"),n=require("react-device-detect"),r=require("./HashList.module.scss.js"),c=require("../../../utils/forReactUtils.js"),l=require("../../../hooks/useCheckDevice.js"),a=c.makeCxFunc(r),i=t.forwardRef((function(r,c){var i=r.className,o=void 0===i?"":i,s=r.contentEditableEl,u=r.targetHashId,f=r.list,d=r.listElement,h=r.selectHashItem,m=r.closeHashList,v=t.useRef(),b=t.useRef(),p=t.useRef({x:0,y:0}),g=t.useState({}),E=e(g,2),y=E[0],k=E[1],w=t.useState(0),C=e(w,2),H=C[0],L=C[1],x=l().isMobile,T=t.useCallback((function(){if((null!=f?f:[]).length){var e=0===H?f.length-1:H-1;L(e);var t=b.current.querySelector("li:nth-child(".concat(e+1,")"));b.current.scrollTop=t.offsetTop-20}}),[H,f]),q=t.useCallback((function(){if((null!=f?f:[]).length){var e=H===f.length-1?0:H+1;L(e);var t=b.current.querySelector("li:nth-child(".concat(e+1,")"));b.current.scrollTop=t.offsetTop-20}}),[f,H]),N=t.useCallback((function(e){if((null!=f?f:[]).length)return f[null!=e?e:H]}),[H,f]),S=t.useCallback((function(e){n.isDesktop&&L(e)}),[]),j=t.useCallback((function(e){L(e),h(e)}),[h]),R=t.useCallback((function(e){var t,n;if(e){var r=e.offsetHeight,c=e.getBoundingClientRect(),l="fixed"===document.body.style.position&&!!document.body.style.top&&Number(document.body.style.top.replace("px",""))<0?-1*Number(document.body.style.top.replace("px","")):window.scrollY,a=c.left+v.current.offsetWidth-window.innerWidth,i=c.top+l,o=c.bottom+l,s=a>0?c.left-a-10:c.left,u=l,f=l+window.innerHeight,d="bottom",h=null!==(t=v.current.clientHeight)&&void 0!==t?t:0;h>f-o&&(d=i-u>f-o?"top":"bottom"),h>i-u&&h>f-o&&(b.current.style.height="".concat("top"===d?i-u-32:f-o-32,"px")),h=null!==(n=v.current.clientHeight)&&void 0!==n?n:0;var m={position:"absolute",zIndex:"9999999",visibility:"visible"};switch(x&&(m.maxWidth="95%"),d){case"top":m.top=i-h,m.left=x?"50%":s;break;case"bottom":m.top=i+r,m.left=x?"50%":s}return x&&(m.transform="translateX(-50%)"),m}}),[x]),D=t.useCallback((function(e){p.current={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}}),[]),I=t.useCallback((function(e){var t=b.current.scrollTop,n=b.current.scrollHeight;(e.cancelable&&t<=0&&e.changedTouches[0].clientY-p.current.y>0||e.cancelable&&t>=n-b.current.clientHeight&&p.current.y-e.changedTouches[0].clientY>0)&&e.preventDefault()}),[]);return t.useImperativeHandle(c,(function(){return v.current.handleArrowUp=T,v.current.handleArrowDown=q,v.current.handleSubmit=N,v.current})),t.useEffect((function(){if(s.current&&u){var e=s.current.querySelector("#".concat(u)),t=R(e);k(t)}else k({})}),[u,f.length,R]),t.useEffect((function(){L(0)}),[f]),t.useEffect((function(){var e=function(e){var t=e.target;!v.current||v.current.contains(t)||t.classList.contains("hash")||m()};return document.addEventListener("click",e),window.addEventListener("resize",m),function(){document.removeEventListener("click",e),window.removeEventListener("resize",m)}}),[m]),t.useEffect((function(){var e=b.current;return e.addEventListener("touchstart",D),e.addEventListener("touchmove",I),function(){e.removeEventListener("touchstart",D),e.removeEventListener("touchmove",I)}}),[D,I]),t.createElement("div",{ref:v,className:a(o,"hash-list"),contentEditable:!1,style:Object.assign(Object.assign({},y),{display:(null!=f?f:[]).length>0?"block":"none"})},t.createElement("ul",{ref:b,className:a("hash-list-area")},(null!=f?f:[]).map((function(n,r){return t.createElement("li",{ref:function(t){t&&Object.entries(n).map((function(n){var r=e(n,2),c=r[0],l=r[1];t.dataset[c]=String(l)}))},className:a("hash-item",{active:H===r}),key:"".concat(n.name,"-").concat(r),onMouseOver:function(){return S(r)},onClick:function(){return j(r)}},d?d(n):t.createElement(t.Fragment,null,t.createElement("div",{className:a("info-area")},t.createElement("strong",{className:a("title")},t.createElement("span",null,"#"),n.name))))}))))}));i.displayName="HashList",module.exports=i;

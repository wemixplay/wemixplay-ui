"use client";
"use strict";var e=require("react"),t=require("react-device-detect"),n=require("./HashList.module.scss.js"),c=require("../../../utils/forReactUtils.js"),r=require("../../../hooks/useCheckDevice.js");const l=c.makeCxFunc(n),s=e.forwardRef(((n,c)=>{let{className:s="",contentEditableEl:o,targetHashId:a,list:i,listElement:u,selectHashItem:d,closeHashList:h}=n;const m=e.useRef(),f=e.useRef(),b=e.useRef({x:0,y:0}),[p,v]=e.useState({}),[g,E]=e.useState(0),{isMobile:y}=r(),k=e.useCallback((()=>{if(!(null!=i?i:[]).length)return;const e=0===g?i.length-1:g-1;E(e);const t=f.current.querySelector("li:nth-child(".concat(e+1,")"));f.current.scrollTop=t.offsetTop-20}),[g,i]),w=e.useCallback((()=>{if(!(null!=i?i:[]).length)return;const e=g===i.length-1?0:g+1;E(e);const t=f.current.querySelector("li:nth-child(".concat(e+1,")"));f.current.scrollTop=t.offsetTop-20}),[i,g]),C=e.useCallback((e=>{if((null!=i?i:[]).length)return i[null!=e?e:g]}),[g,i]),H=e.useCallback((e=>{t.isDesktop&&E(e)}),[]),L=e.useCallback((e=>{E(e),d(e)}),[d]),x=e.useCallback((e=>{var t,n;if(!e)return;const{offsetHeight:c}=e,r=e.getBoundingClientRect(),l="fixed"===document.body.style.position&&!!document.body.style.top&&Number(document.body.style.top.replace("px",""))<0?-1*Number(document.body.style.top.replace("px","")):window.scrollY,s=r.left+m.current.offsetWidth-window.innerWidth,o=r.top+l,a=r.bottom+l,i=s>0?r.left-s-10:r.left,u=l,d=l+window.innerHeight;let h="bottom",b=null!==(t=m.current.clientHeight)&&void 0!==t?t:0;b>d-a&&(h=o-u>d-a?"top":"bottom"),b>o-u&&b>d-a&&(f.current.style.height="".concat("top"===h?o-u-32:d-a-32,"px")),b=null!==(n=m.current.clientHeight)&&void 0!==n?n:0;const p={position:"absolute",zIndex:"9999999",visibility:"visible"};switch(y&&(p.maxWidth="95%"),h){case"top":p.top=o-b,p.left=y?"50%":i;break;case"bottom":p.top=o+c,p.left=y?"50%":i}return y&&(p.transform="translateX(-50%)"),p}),[y]),N=e.useCallback((e=>{b.current={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}}),[]),T=e.useCallback((e=>{const t=f.current.scrollTop,n=f.current.scrollHeight;(e.cancelable&&t<=0&&e.changedTouches[0].clientY-b.current.y>0||e.cancelable&&t>=n-f.current.clientHeight&&b.current.y-e.changedTouches[0].clientY>0)&&e.preventDefault()}),[]);return e.useImperativeHandle(c,(()=>(m.current.handleArrowUp=k,m.current.handleArrowDown=w,m.current.handleSubmit=C,m.current))),e.useEffect((()=>{if(o.current&&a){const e=o.current.querySelector("#".concat(a)),t=x(e);v(t)}else v({})}),[a,i.length,x]),e.useEffect((()=>{E(0)}),[i]),e.useEffect((()=>{const e=e=>{const t=e.target;!m.current||m.current.contains(t)||t.classList.contains("hash")||h()};return document.addEventListener("click",e),window.addEventListener("resize",h),()=>{document.removeEventListener("click",e),window.removeEventListener("resize",h)}}),[h]),e.useEffect((()=>{const e=f.current;return e.addEventListener("touchstart",N),e.addEventListener("touchmove",T),()=>{e.removeEventListener("touchstart",N),e.removeEventListener("touchmove",T)}}),[N,T]),e.createElement("div",{ref:m,className:l(s,"hash-list"),contentEditable:!1,style:Object.assign(Object.assign({},p),{display:(null!=i?i:[]).length>0?"block":"none"})},e.createElement("ul",{ref:f,className:l("hash-list-area")},(null!=i?i:[]).map(((t,n)=>e.createElement("li",{ref:e=>{e&&Object.entries(t).map((t=>{let[n,c]=t;e.dataset[n]=String(c)}))},className:l("hash-item",{active:g===n}),key:"".concat(t.name,"-").concat(n),onMouseOver:()=>H(n),onClick:()=>L(n)},u?u(t):e.createElement(e.Fragment,null,e.createElement("div",{className:l("info-area")},e.createElement("strong",{className:l("title")},e.createElement("span",null,"#"),t.name))))))))}));s.displayName="HashList",module.exports=s;

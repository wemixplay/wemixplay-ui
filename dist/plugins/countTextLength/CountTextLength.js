"use strict";var e=require("@babel/runtime/helpers/classCallCheck"),t=require("@babel/runtime/helpers/createClass"),n=function(){return t((function t(n){var a=n.contentEditableEl;e(this,t),this.commandKey="countTextLength",this.config={},this.contentEditableEl=a}),[{key:"setConfig",value:function(e){var t=this;this.config=Object.assign(Object.assign({},this.config),null!=e?e:{});var n=this.contentEditableEl.current,a=null==n?void 0:n.parentElement;if(!this.config.hideUi&&a&&!(null==a?void 0:a.querySelector(".count-text-length-tool"))){var i=document.createElement("div");i.classList.add("count-text-length-tool");var r=document.createElement("span");r.id="ctlt-count",r.innerHTML="0",i.append(r);var o=n.ariaValueMax;if(o){var l=document.createElement("span");l.className="maxLength",l.innerHTML=" / ".concat(o),i.append(l)}a.append(i)}"undefined"==typeof window||this.mutationObserver||(this.mutationObserver=new MutationObserver((function(){t.countText()})),this.mutationObserver.observe(this.contentEditableEl.current,{characterData:!0,subtree:!0,childList:!0}))}},{key:"countText",value:function(){var e=this.contentEditableEl.current,t=e.textContent.length;if(!this.config.hideUi){var n=document.getElementById("ctlt-count");n.innerHTML=String(t);var a=Number(e.ariaValueMax);a&&(t>a?n.classList.add("error"):n.classList.remove("error"))}return this.config.onChangeTextLength&&this.config.onChangeTextLength(t),t}},{key:"handleKeyDown",value:function(e){var t=e.event,n=this.countText(),a=Number(this.contentEditableEl.current.ariaValueMax);if(a&&n>=a){var i="KeyA"===t.code&&t.metaKey,r="KeyC"===t.code&&t.metaKey,o="KeyX"===t.code&&t.metaKey,l="KeyZ"===t.code&&t.metaKey;[8,37,38,39,40,46].includes(t.keyCode)||i||o||l||r||t.preventDefault()}}},{key:"handleChange",value:function(e){var t,n,a=e.event,i=this.countText(),r=Number(this.contentEditableEl.current.ariaValueMax);if(i>r){var o=window.getSelection(),l=null==o?void 0:o.getRangeAt(0);if(l){var c=l.startContainer,u=l.startOffset,s=i-r;if(c.nodeType===Node.TEXT_NODE){var d=c;if(u>0){var v=Math.max(u-s,0);d.nodeValue=(null===(t=d.nodeValue)||void 0===t?void 0:t.slice(0,v))+(null===(n=d.nodeValue)||void 0===n?void 0:n.slice(u))||"";var h=document.createRange(),m=window.getSelection();h.setStart(d,v),h.collapse(!0),null==m||m.removeAllRanges(),null==m||m.addRange(h)}}}a.preventDefault()}}}])}();module.exports=n;

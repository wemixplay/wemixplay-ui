"use strict";module.exports=class{constructor(e){let{contentEditableEl:t}=e;this.commandKey="countTextLength",this.config={},this.contentEditableEl=t}setConfig(e){this.config=Object.assign(Object.assign({},this.config),null!=e?e:{});const t=this.contentEditableEl.current,n=null==t?void 0:t.parentElement;if(!this.config.hideUi&&n&&!(null==n?void 0:n.querySelector(".count-text-length-tool"))){const e=document.createElement("div");e.classList.add("count-text-length-tool");const o=document.createElement("span");o.id="ctlt-count",o.innerHTML="0",e.append(o);const i=t.ariaValueMax;if(i){const t=document.createElement("span");t.className="maxLength",t.innerHTML=" / ".concat(i),e.append(t)}n.append(e)}"undefined"==typeof window||this.mutationObserver||(this.mutationObserver=new MutationObserver((()=>{this.countText()})),this.mutationObserver.observe(this.contentEditableEl.current,{characterData:!0,subtree:!0,childList:!0}))}countText(){const e=this.contentEditableEl.current,t=e.textContent.length;if(!this.config.hideUi){const n=document.getElementById("ctlt-count");n.innerHTML=String(t);const o=Number(e.ariaValueMax);o&&(t>o?n.classList.add("error"):n.classList.remove("error"))}return this.config.onChangeTextLength&&this.config.onChangeTextLength(t),t}handleKeyDown(e){let{event:t}=e;const n=this.countText(),o=Number(this.contentEditableEl.current.ariaValueMax);if(o&&n>=o){const e=[8,37,38,39,40,46],n="KeyA"===t.code&&t.metaKey,o="KeyC"===t.code&&t.metaKey,i="KeyX"===t.code&&t.metaKey,c="KeyZ"===t.code&&t.metaKey;e.includes(t.keyCode)||n||i||c||o||t.preventDefault()}}handleChange(e){let{event:t}=e;var n,o;const i=this.countText(),c=Number(this.contentEditableEl.current.ariaValueMax);if(i>c){const e=window.getSelection(),a=null==e?void 0:e.getRangeAt(0);if(a){const e=a.startContainer,t=a.startOffset,s=i-c;if(e.nodeType===Node.TEXT_NODE){const i=e;if(t>0){const e=Math.max(t-s,0);i.nodeValue=(null===(n=i.nodeValue)||void 0===n?void 0:n.slice(0,e))+(null===(o=i.nodeValue)||void 0===o?void 0:o.slice(t))||"";const c=document.createRange(),a=window.getSelection();c.setStart(i,e),c.collapse(!0),null==a||a.removeAllRanges(),null==a||a.addRange(c)}}}t.preventDefault()}}};

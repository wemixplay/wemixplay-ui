"use strict";module.exports=class{constructor(t){let{contentEditableEl:e}=t;this.commandKey="autoUrlMatch",this.urls=[],this.config={},this.contentEditableEl=e}setConfig(t){this.config=Object.assign(Object.assign({},this.config),null!=t?t:{})}getUrlMatchList(t){var e,n;return null!==(n=null===(e=(null!=t?t:"").match(/(https?:\/\/[^\s/$.?#].[^\s]*)|(www\.[^\s/$.?#].[^\s]*)|(ftp:\/\/[^\s/$.?#].[^\s]*)/gi))||void 0===e?void 0:e.map((t=>t.trim())))&&void 0!==n?n:[]}handleKeyDown(t){let{event:e}=t;var n,a,r,l;const o=window.getSelection(),s=document.createRange(),c=Number(this.contentEditableEl.current.ariaValueMax),i=(null===(n=this.contentEditableEl.current.textContent)||void 0===n?void 0:n.length)||0,d=o.focusNode,h=o.getRangeAt(0).startOffset,m=null!==(a=this.getUrlMatchList(d.textContent).pop())&&void 0!==a?a:"";if("Space"===e.code||"Enter"===e.code||"NumpadEnter"===e.code)if("A"===(null===(r=d.parentElement)||void 0===r?void 0:r.tagName)){const t=o.getRangeAt(0),n=t.startOffset,a=d.textContent,r=a.slice(0,n),l=a.slice(n);if(d.textContent=r,d.parentElement.href=r,"Space"===e.code){if(e.preventDefault(),l){if(!!this.getUrlMatchList(l)[0]){const t=document.createElement("a");t.href=l,t.textContent=l.startsWith("http")?l:"https://".concat(l),d.parentElement.insertAdjacentElement("afterend",t)}else d.parentElement.parentNode.insertBefore(document.createTextNode(l),d.parentElement.nextSibling)}const n=document.createTextNode(" ");d.parentElement.parentNode.insertBefore(n,d.parentElement.nextSibling),t.setStartAfter(n),t.setEndAfter(n),o.removeAllRanges(),o.addRange(t)}else{if(e.preventDefault(),l){if(!!this.getUrlMatchList(l)[0]){const t=document.createElement("a");t.href=l,t.textContent=l.startsWith("http")?l:"https://".concat(l),d.parentElement.insertAdjacentElement("afterend",t)}else d.parentElement.parentNode.insertBefore(document.createTextNode(l),d.parentElement.nextSibling)}const n=document.createElement("br");d.parentElement.parentNode.insertBefore(n,d.parentElement.nextSibling),t.setStartAfter(n),t.setEndAfter(n),o.removeAllRanges(),o.addRange(t)}r||d.parentElement.remove(),this.contentEditableEl.current.dispatchEvent(new Event("input",{bubbles:!0}))}else if(m&&h>0&&d.nodeType===Node.TEXT_NODE&&c>=i+1){const t=m.startsWith("http")?m:"https://".concat(m);this.config.onMatchUrl&&this.config.onMatchUrl(t);const n=document.createElement("div");n.innerHTML='<a href="'.concat(t,'" target="_blank">').concat(m,"</a>");const a=Array.from(n.childNodes);if(a.length>0){const t=(null!==(l=d.textContent)&&void 0!==l?l:"").indexOf(m),n=t+m.length;s.setStart(d,t),s.setEnd(d,n),s.deleteContents(),a.forEach((t=>{s.insertNode(t),s.setStartAfter(t)}));const r=document.createTextNode("Â ");s.insertNode(r),s.setStartAfter(r),s.setEndAfter(r),o.removeAllRanges(),o.addRange(s),e.preventDefault(),this.contentEditableEl.current.dispatchEvent(new Event("input",{bubbles:!0}))}}}handleChange(t){let{event:e}=t;var n,a;const r=window.getSelection().focusNode;if("A"===(null===(n=r.parentElement)||void 0===n?void 0:n.tagName))if(this.getUrlMatchList(r.textContent).length)r.parentElement.href=r.textContent;else{const t=r.parentElement,e=t.textContent||"",n=document.createTextNode(e),a=t.parentElement;if(a){a.replaceChild(n,t);const e=document.createRange(),r=window.getSelection();e.setStart(n,n.length),e.collapse(!0),null==r||r.removeAllRanges(),null==r||r.addRange(e)}}const l=(null!==(a=(e.target.innerHTML||"").match(/<a[^>]*>(.*?)<\/a>/g))&&void 0!==a?a:[]).map((t=>{const e=t.match(/<a[^>]*>(.*?)<\/a>/)[1];return e.startsWith("http")?e:"https://".concat(e)}));l.length===this.urls.length&&l.every((t=>this.urls.includes(t)))||(this.urls=[...l],this.config.onChangeMatchUrls&&this.config.onChangeMatchUrls(l))}};

import e from"@babel/runtime/helpers/toConsumableArray";import n from"@babel/runtime/helpers/slicedToArray";import t from"@babel/runtime/regenerator";import{__awaiter as r}from"../../_virtual/_tslib.js";import o,{forwardRef as i,useRef as a,useState as u,useMemo as c,useCallback as s,cloneElement as l,useEffect as m,useImperativeHandle as p}from"react";import d from"./PopoverButton.module.scss.js";import f from"../ripple/Ripple.js";import v from"../../hooks/useClickOutside.js";import{makeCxFunc as b}from"../../utils/forReactUtils.js";import w from"../portal/Portal.js";var x=b(d),k=[],E=i((function(i,d){var b=i.id,E=i.className,g=void 0===E?"":E,h=i.anchorId,j=i.detectDoubleClick,y=i.popoverElement,N=i.popoverStyle,C=void 0===N?{top:0,left:0,zIndex:1}:N,O=i.popoverAnimation,F=void 0===O?{name:"",duration:0}:O,P=i.ripple,S=i.excludeOutSideIds,T=void 0===S?k:S,A=i.whenWindowScrollClose,D=i.children,I=i.onClick,B=a(),L=a(!1),R=u(!1),_=n(R,2),q=_[0],z=_[1],M=u(""),U=n(M,2),W=U[0],G=U[1],H=c((function(){return q&&("enter"===W||"leave"===W)?{animationName:F.name,animationDuration:"".concat(F.duration,"ms"),animationTimingFunction:F.timingFunc||"ease",animationDirection:"leave"===W?"reverse":"normal",animationFillMode:"leave"===W?"forwards":"normal"}:{}}),[F,q,W]),J=s((function(e){return new Promise((function(n){return setTimeout(n,e)}))}),[]),K=s((function(){return r(void 0,void 0,void 0,t.mark((function e(){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h){e.next=2;break}return e.abrupt("return");case 2:return G(""),e.next=5,J(10);case 5:return G("leave"),e.next=8,J(F.duration);case 8:z(!1);case 9:case"end":return e.stop()}}),e)})))}),[h,F.duration,J]),Q=s((function(){return r(void 0,void 0,void 0,t.mark((function e(){return t.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h){e.next=2;break}return e.abrupt("return");case 2:return z(!0),G("enter"),e.next=6,J(F.duration);case 6:G("");case 7:case"end":return e.stop()}}),e)})))}),[h,F.duration,J]),V=s((function(){q?K():Q()}),[q,K,Q]),X=s((function(e){return r(void 0,void 0,void 0,t.mark((function n(){return t.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!L.current||!j){n.next=2;break}return n.abrupt("return");case 2:L.current=!0,setTimeout((function(){L.current=!1}),500),V(),I&&I(e);case 6:case"end":return n.stop()}}),n)})))}),[j,V,I]),Y=c((function(){var e="string"==typeof(null==y?void 0:y.type)?void 0:{close:K};return o.createElement("div",{className:x("popover-element-wrap")},q&&o.createElement("div",{className:x("popover-element",W),style:Object.assign(Object.assign({},C),H)},l(null!=y?y:o.createElement(o.Fragment,null),e)))}),[H,K,q,y,C,W]);return v(B,(function(n){var t=[].concat(e(T),[h]).filter((function(e){return!!e})).concat(k).map((function(e){return document.querySelector("#".concat(e))})).filter((function(e){return e})),r=n.target;document.body.contains(r)&&(t.some((function(e){return null==e?void 0:e.contains(r)}))||q&&K())}),{event:"mouseup"}),m((function(){var e=function(){z(!1),G("")};return q&&A&&window.addEventListener("scroll",e),function(){window.removeEventListener("scroll",e)}}),[A,q]),p(d,(function(){return{close:K,open:Q}})),o.createElement("div",{ref:B,id:b,className:x("popover-area")},o.createElement(f,Object.assign({},P),o.createElement("button",{className:x("btn-popover",g,q&&"open"),onClick:X},D)),h?o.createElement(w,{id:h},Y):null)}));E.displayName="PopoverButton";export{E as default};

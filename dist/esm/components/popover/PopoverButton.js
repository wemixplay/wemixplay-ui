"use client";
import{__awaiter as e}from"../../_virtual/_tslib.js";import o,{forwardRef as t,useRef as n,useState as i,useMemo as r,useCallback as a,cloneElement as l,useEffect as s,useImperativeHandle as c}from"react";import m from"./PopoverButton.module.scss.js";import d from"../ripple/Ripple.js";import u from"../../hooks/useClickOutside.js";import{makeCxFunc as p}from"../../utils/forReactUtils.js";import v from"../portal/Portal.js";const f=p(m),y=[],E=t(((t,m)=>{let{id:p,className:E="",anchorId:j,detectDoubleClick:w,popoverElement:b,popoverStyle:g={top:0,left:0,zIndex:1},popoverAnimation:N={name:"",duration:0},ripple:k,excludeOutSideIds:C=y,whenWindowScrollClose:O,children:h,onClick:F}=t;const P=n(),S=n(!1),[x,D]=i(!1),[I,T]=i(""),B=r((()=>x&&("enter"===I||"leave"===I)?{animationName:N.name,animationDuration:"".concat(N.duration,"ms"),animationTimingFunction:N.timingFunc||"ease",animationDirection:"leave"===I?"reverse":"normal",animationFillMode:"leave"===I?"forwards":"normal"}:{}),[N,x,I]),L=a((e=>new Promise((o=>setTimeout(o,e)))),[]),R=a((()=>e(void 0,void 0,void 0,(function*(){j&&(T(""),yield L(10),T("leave"),yield L(N.duration),D(!1))}))),[j,N.duration,L]),_=a((()=>e(void 0,void 0,void 0,(function*(){j&&(D(!0),T("enter"),yield L(N.duration),T(""))}))),[j,N.duration,L]),q=a((()=>{x?R():_()}),[x,R,_]),z=a((o=>e(void 0,void 0,void 0,(function*(){S.current&&w||(S.current=!0,setTimeout((()=>{S.current=!1}),500),q(),F&&F(o))}))),[w,q,F]),A=r((()=>{const e="string"==typeof(null==b?void 0:b.type)?void 0:{close:R};return o.createElement("div",{className:f("popover-element-wrap")},x&&o.createElement("div",{className:f("popover-element",I),style:Object.assign(Object.assign({},g),B)},l(null!=b?b:o.createElement(o.Fragment,null),e)))}),[B,R,x,b,g,I]);return u(P,(e=>{const o=[...C,j].filter((e=>!!e)).concat(y).map((e=>document.querySelector("#".concat(e)))).filter((e=>e)),t=e.target;document.body.contains(t)&&(o.some((e=>null==e?void 0:e.contains(t)))||x&&R())}),{event:"mouseup"}),s((()=>{const e=()=>{D(!1),T("")};return x&&O&&window.addEventListener("scroll",e),()=>{window.removeEventListener("scroll",e)}}),[O,x]),c(m,(()=>({close:R,open:_}))),o.createElement("div",{ref:P,id:p,className:f("popover-area")},o.createElement(d,Object.assign({},k),o.createElement("button",{className:f("btn-popover",E,x&&"open"),onClick:z},h)),j?o.createElement(v,{id:j},A):null)}));E.displayName="PopoverButton";var j=E;export{j as default};

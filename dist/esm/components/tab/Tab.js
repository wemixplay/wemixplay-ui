import e from"@babel/runtime/helpers/slicedToArray";import n,{useRef as t,useMemo as r,useState as i,useCallback as a,useEffect as l}from"react";import{Swiper as c,SwiperSlide as o}from'./../../ext/swiper/swiper-react.js';import{makeCxFunc as s}from"../../utils/forReactUtils.js";import d from"../ripple/Ripple.js";import u from"./Tab.module.scss.js";var f=s(u),v=function(s){var u,v=s.className,m=void 0===v?"":v,b=s.tabItems,p=s.activeKey,y=s.name,h=s.slider,k=s.swipeContent,w=s.disabled,E=s.rippleOption,N=void 0===E?{disabled:!0}:E,x=s.tabNavScrollRef,I=s.destroyInactiveTabPanel,L=void 0===I||I,g=s.onClick,j=s.handleChange,C=t(null),T=t(null),R=t([]),z=t(),O=t(!1),S=r((function(){var e;return null!==(e=null==b?void 0:b.filter((function(e){return!(null==e?void 0:e.isHide)})))&&void 0!==e?e:[]}),[b]),W=i(null!=p?p:null===(u=S[0])||void 0===u?void 0:u.key),H=e(W,2),P=H[0],X=H[1],A=r((function(){var e=S.findIndex((function(e){return e.key===P}));return-1===e?0:e}),[P,S]),D=r((function(){var e,t,r;if(!S.length)return[];if(k){return n.createElement(c,{className:f("tab-content-holder"),autoHeight:!0,threshold:1,slidesPerView:1,enabled:!w,onSwiper:function(e){z.current=e},onSlideChange:function(){var e,n,t=z.current.swipeDirection,r=S[z.current.activeIndex],i=r.key,a=r.disabled,l=(null!==(e=S[z.current.activeIndex-1])&&void 0!==e?e:S[0]).key,c=(null!==(n=S[z.current.activeIndex+1])&&void 0!==n?n:S[z.current.activeIndex]).key;a?(X("next"===t?c:l),j&&j("next"===t?c:l,y)):(X(i),j&&j(i,y))}},S.map((function(e,t){return n.createElement(o,{key:e.key,className:f("tabs-content","active",{disabled:w||e.disabled}),style:{visibility:e.disabled?"hidden":"visible"}},e.children)})))}return L?n.createElement("div",{key:"contents-".concat(null===(e=S[A])||void 0===e?void 0:e.key),className:f("tab-content-holder")},n.createElement("div",{className:f("tabs-content","active",{disabled:w||(null===(t=S[A])||void 0===t?void 0:t.disabled)})},null===(r=S[A])||void 0===r?void 0:r.children)):n.createElement("div",{className:f("tab-content-holder")},S.map((function(e,t){return n.createElement("div",{key:"contents-".concat(e.key),className:f("tabs-content",{active:A===t,disabled:w||e.disabled})},e.children)})))}),[A,L,w,j,y,k,S]),K=a((function(){var e,n,t=null!==(e=null==x?void 0:x.current)&&void 0!==e?e:T.current,r=null!==(n=R.current.find((function(e){return e&&e.classList.contains("active")})))&&void 0!==n?n:R.current[0];if(r){var i=r.offsetLeft,a=r.clientWidth,l=i-t.offsetWidth/2+a/2;t.scrollTo({top:0,left:l,behavior:"smooth"})}}),[x]),U=a((function(){var e,n=C.current;if(h&&n){var t=null!==(e=R.current.find((function(e){return e&&e.classList.contains("active")})))&&void 0!==e?e:R.current[0];if(t){var r=t.offsetLeft,i=t.clientWidth;n.style.transform="translateX(".concat(r,"px)"),n.style.width="".concat(i,"px"),O.current?n.style.transition="":(n.style.transition="none",O.current=!0)}else n.style.transform="translateX(0px)",n.style.width="0px"}}),[h]),V=a((function(e,n){void 0===p&&X(e),j&&j(e,y),g&&g(e,n)}),[p,y,j,g]),_=r((function(){if("undefined"!=typeof window)return new ResizeObserver((function(){U()}))}),[U]);return l((function(){void 0!==p&&p!==P&&X(p)}),[p,P]),l((function(){U(),K(),z.current&&z.current.slideTo(A,250)}),[A,U,K]),l((function(){var e=function(){U(),K()};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[U,K]),l((function(){k&&z.current&&(w?z.current.disable():z.current.enable())}),[w,k]),l((function(){if(_){var e=R.current;return e.forEach((function(e){e&&_.observe(e)})),function(){e.forEach((function(e){e&&_.unobserve(e)}))}}}),[_]),n.createElement("div",{className:f(m,"tab",{"swipe-content":k})},n.createElement("div",{className:f("tab-nav-wrap")},n.createElement("div",{ref:T,className:f("tab-nav-scroll")},n.createElement("div",{className:f("tab-nav")},S.map((function(e,t){return n.createElement(d,Object.assign({key:e.key},N,{disabled:N.disabled||e.disabled||w}),n.createElement("button",{ref:function(e){R.current[t]=e},key:e.key,role:"tab",className:f("tab-btn",{active:P===e.key}),disabled:w||e.disabled,onClick:function(n){return V(e.key,n)}},e.label))})),h&&n.createElement("span",{ref:C,className:f("slider")})))),D)};export{v as default};

import e from"@babel/runtime/helpers/slicedToArray";import t,{forwardRef as r,useRef as n,useState as o,useCallback as i,useMemo as a,useEffect as u,useImperativeHandle as c}from"react";import s from"./FeedIframesView.module.scss.js";import l from"../carousel/Carousel.js";import d from"../../assets/svgs/ico-delete-x.svg.js";import{makeCxFunc as m}from"../../utils/forReactUtils.js";import p from'./../../ext/react-youtube/dist/YouTube.esm.js';var f="wp_ui_youtube_is_mute",v=m(s),w=r((function(r,s){var m=r.className,w=void 0===m?"":m,y=r.media,I=void 0===y?[]:y,b=r.intersectionVideo,E=r.handleDeleteIframe,g=n(),T=n(),N=n("NOT_YET"),V=n({playTimeoutId:0,pauseTimeoutId:0}),h=o(!1),S=e(h,2),_=S[0],D=S[1],U=i((function(t){var r=t.split("?");return e(r,1)[0].split("/").pop()}),[]),j=i((function(e){g.current&&(Number(localStorage.getItem(f)||0)?g.current.mute():g.current.unMute(),-1===e.data?N.current="NOT_YET":0===e.data?N.current="ENDED":1===e.data?N.current="PLAYING":2===e.data?N.current="PAUSED":3===e.data?N.current="BUFFERING":5===e.data&&(N.current="CUED"))}),[]),A=i((function(){g.current&&g.current.playVideo()}),[]),R=i((function(){g.current&&g.current.pauseVideo()}),[]),k=i((function(){var e;g.current&&(null===(e=g.current)||void 0===e?void 0:e.playerInfo)&&(localStorage.getItem(f)?g.current.isMuted()?localStorage.setItem(f,"1"):localStorage.setItem(f,"0"):(g.current.mute(),localStorage.setItem(f,"1")))}),[]),C=a((function(){if("undefined"!=typeof window&&_&&b)return window.IntersectionObserver?new IntersectionObserver((function(e){var t,r,n,o;window.clearTimeout(V.current.playTimeoutId),g.current&&(null===(t=g.current)||void 0===t?void 0:t.playerInfo)&&((null===(r=e[0])||void 0===r?void 0:r.intersectionRatio)>0&&g.current.addEventListener("onVolumeChange",k),(null===(n=e[0])||void 0===n?void 0:n.intersectionRatio)>.8&&"PAUSED"!==N.current?V.current.playTimeoutId=window.setTimeout((function(){g.current.playVideo()}),500):(null===(o=e[0])||void 0===o?void 0:o.intersectionRatio)<=.8&&(g.current.pauseVideo(),V.current.pauseTimeoutId=window.setTimeout((function(){N.current="AUTO_PAUSED"}),200)))}),{threshold:[0,.25,.5,.75,1]}):void 0}),[b,_,k]);return u((function(){var e=T.current;if(C&&_)return C.observe(e),function(){C.unobserve(e)}}),[_]),c(s,(function(){return T.current?(T.current.playState=N.current,T.current.playVideo=A,T.current.pauseVideo=R,T.current):T.current})),t.createElement("div",{className:v(w,"feed-iframe-views")},t.createElement(l,{className:v("iframe-preview-slider"),freeMode:!0,loop:!1,slidesPerView:"auto",spaceBetween:10},I.map((function(e,r){return t.createElement("div",{key:"".concat(e.src,"-").concat(r),className:v("preview-iframe-area")},!!E&&t.createElement("button",{className:v("btn-img-delete"),onClick:function(){return E({deleteIndex:r})}},t.createElement(d,null)),t.createElement("div",{ref:T,key:e.src,"data-src":e.src,className:v("preview-iframe-box")},"youtube"===e.type&&t.createElement(p,{videoId:U(e.src),opts:{host:"https://www.youtube-nocookie.com",playerVars:{autoplay:0,rel:0,controls:1,modestbranding:1,loop:1,enablejsapi:1,origin:"http://www.youtube-nocookie.com"}},onReady:function(e){g.current=e.target,D(!0)},onStateChange:j}),"twitch"===e.type&&t.createElement("iframe",{src:e.src})))}))))}));w.displayName="FeedIframesView";export{w as default};

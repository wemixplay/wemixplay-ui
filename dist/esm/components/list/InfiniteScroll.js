import r from"@babel/runtime/helpers/toConsumableArray";import n from"@babel/runtime/helpers/slicedToArray";import{__rest as t}from"../../_virtual/_tslib.js";import e,{useRef as o,useState as l,useMemo as i,useCallback as u,useEffect as c,createElement as a}from"react";import{makeCxFunc as s}from"../../utils/forReactUtils.js";import d from"../loadings/Spinner.js";import m from"./InfiniteScroll.module.scss.js";var f=s(m),v=function(s){var m=s.className,v=void 0===m?"":m,g=s.tag,h=void 0===g?"div":g,p=s.list,b=s.scrollTarget,M=void 0===b?null:b,C=s.rootMargin,E=void 0===C?100:C,N=s.loading,j=s.loadingElement,w=void 0===j?e.createElement(d,null):j,x=s.children,y=s.handleLoadMore,T=t(s,["className","tag","list","scrollTarget","rootMargin","loading","loadingElement","children","handleLoadMore"]),A=o(null),I=o(p),L=o("totalCount"in T?T.totalCount:void 0),R=o("hasMore"in T?T.hasMore:void 0),S=o(N),_=o(-1),O=l(0),U=n(O,2),k=U[0],q=U[1],z=i((function(){return"undefined"==typeof window?null:new IntersectionObserver((function(r,n){null!==(null==A?void 0:A.current)&&r[0].intersectionRatio>.2&&(S.current||(q((function(r){return r+1})),n.disconnect()))}),{root:M?"current"in M?M.current:M:null,rootMargin:"".concat(E,"px 0px"),threshold:[.1,.2,.5,.8,.9,1]})}),[A,E,M]),B=u((function(){if(!I.current||S.current)return!1;I.current.length;return void 0!==L.current?L.current>I.current.length:!!R.current}),[]);return c((function(){var r;k>0&&_.current<k&&(null!==(r=I.current)&&void 0!==r?r:[]).length&&B()&&(_.current=k,y&&y())}),[k,B,y]),c((function(){var r=null==A?void 0:A.current;return r&&(null==z||z.observe(r)),function(){r&&z&&z.unobserve(r)}}),[A,p,z]),c((function(){"totalCount"in T?-1!==_.current&&I.current&&p&&I.current.length===p.length&&T.totalCount>p.length||(L.current=T.totalCount):R.current=T.hasMore,I.current=r(p||[])}),[p,T]),c((function(){S.current=N}),[N]),e.createElement("div",{className:f(v,"infinite-scroll")},a(h||"div",{children:x}),e.createElement("div",{ref:A,className:f("io-target")},e.createElement("div",{className:f("infinite-scroll-loading",{active:N&&(null!=p?p:[]).length})},N&&(null!=p?p:[]).length>0&&w)))};export{v as default};

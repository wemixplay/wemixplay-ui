import{__rest as r}from"../../_virtual/_tslib.js";import t,{useRef as e,useState as n,useMemo as l,useCallback as o,useEffect as i,createElement as c}from"react";import{makeCxFunc as a}from"../../utils/forReactUtils.js";import u from"../loadings/Spinner.js";import s from"./InfiniteScroll.module.scss.js";const d=a(s);var g=a=>{var{className:s="",tag:g="div",list:m,scrollTarget:v=null,rootMargin:h=100,loading:f,loadingElement:p=t.createElement(u,null),children:M,handleLoadMore:E}=a,C=r(a,["className","tag","list","scrollTarget","rootMargin","loading","loadingElement","children","handleLoadMore"]);const N=e(null),b=e(m),j=e("totalCount"in C?C.totalCount:void 0),w=e("hasMore"in C?C.hasMore:void 0),x=e(f),I=e(-1),[L,R]=n(0),S=l((()=>"undefined"==typeof window?null:new IntersectionObserver(((r,t)=>{null!==(null==N?void 0:N.current)&&r[0].intersectionRatio>.2&&(x.current||(R((r=>r+1)),t.disconnect()))}),{root:v?"current"in v?v.current:v:null,rootMargin:"".concat(h,"px 0px"),threshold:[.1,.2,.5,.8,.9,1]})),[N,h,v]),T=o((()=>{if(!b.current||x.current)return!1;let r=b.current.length>0;return r=void 0!==j.current?j.current>b.current.length:!!w.current,r}),[]);return i((()=>{var r;L>0&&I.current<L&&(null!==(r=b.current)&&void 0!==r?r:[]).length&&T()&&(I.current=L,E&&E())}),[L,T,E]),i((()=>{const r=null==N?void 0:N.current;return r&&(null==S||S.observe(r)),()=>{r&&S&&S.unobserve(r)}}),[N,m,S]),i((()=>{"totalCount"in C?-1!==I.current&&b.current&&m&&b.current.length===m.length&&C.totalCount>m.length||(j.current=C.totalCount):w.current=C.hasMore,b.current=[...m||[]]}),[m,C]),i((()=>{x.current=f}),[f]),t.createElement("div",{className:d(s,"infinite-scroll")},c(g||"div",{children:M}),t.createElement("div",{ref:N,className:d("io-target")},t.createElement("div",{className:d("infinite-scroll-loading",{active:f&&(null!=m?m:[]).length})},f&&(null!=m?m:[]).length>0&&p)))};export{g as default};

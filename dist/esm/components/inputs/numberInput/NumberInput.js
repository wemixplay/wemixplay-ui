import{__rest as e}from"../../../_virtual/_tslib.js";import r from"decimal.js";import n from'./../../../ext/lodash/last.js';import t from'./../../../ext/lodash/replace.js';import o,{forwardRef as u,useRef as l,useState as a,useMemo as i,useCallback as s,useEffect as c,useImperativeHandle as d}from"react";import{makeCxFunc as m}from"../../../utils/forReactUtils.js";import{commaStrToNumber as p,makeParts as v}from"../../../utils/valueParserUtils.js";import w from"../../../assets/svgs/keyboard-arrow-down-2.svg.js";import b from"../../../assets/svgs/keyboard-arrow-up-2.svg.js";import g from"../../ripple/Ripple.js";import f from"./NumberInput.module.scss.js";const h=m(f),E=u(((u,m)=>{var f,E,{className:j="",step:N=1,error:y,isDirect:O=!0,increaseStep:D,decreaseStep:S,maxLength:U,arrowUpElement:C=o.createElement(b,null),arrowDownElement:M=o.createElement(w,null),rippleOption:T,hideButton:x,handleChange:_,handleEnter:R}=u,k=e(u,["className","step","error","isDirect","increaseStep","decreaseStep","maxLength","arrowUpElement","arrowDownElement","rippleOption","hideButton","handleChange","handleEnter"]);const{value:B,readOnly:W,disabled:P,min:F,max:I="9999999999999",digit:L=18,onFocus:$,onBlur:V}=k,q=l(),z=l(!1),A=l(),G=l(),H=l(),J=l(0),K=l(0),Q=l(1e3),[X,Y]=a(null!=B?B:""),[Z,ee]=a(!1),re=i((()=>P||new r(null!=F?F:0).cmp(new r(I))>0),[P,I,F]),ne=s(((e,n,t)=>{var o,u,l,a,i,s;return"up"===t?new r(e||0).add(new r(null!==(l=null!==(u=null===(o=G.current)||void 0===o?void 0:o.increase)&&void 0!==u?u:n)&&void 0!==l?l:1)).toDP(L,r.ROUND_DOWN).toString():new r(e||0).sub(new r(null!==(s=null!==(i=null===(a=G.current)||void 0===a?void 0:a.decrease)&&void 0!==i?i:n)&&void 0!==s?s:1)).toDP(L,r.ROUND_DOWN).toString()}),[L]),te=s((e=>void 0===e||!e||re?"":e.endsWith(".")?e:void 0!==F&&new r(Number(e)).lt(new r(F))?String(F):void 0!==I&&new r(p(e||"")).gt(new r(I))?String(I):e),[F,I,re]),oe=s((e=>re?"":e.endsWith(".")?e:te(e)),[re,te]),ue=s((e=>{let{type:r,e:o}=e;if(!q.current||re)return;const{value:u,name:l}=q.current,a=(e=>{var r;const o=null===(r=null==e?void 0:e.target)||void 0===r?void 0:r.value;return t(o,/^0+[\d,]/gm,(e=>n(e))).replace(/[^\d.-]/g,"")})({target:{value:u}}),i=L?new RegExp("^[0-9]*[.]{0,1}[0-9]{0,".concat(L,"}$"),"gm"):/^\d{0,18}$/;a.match(i)&&(void 0!==U&&(a||"").split(".")[0].replace(/[^0-9]/g,"").length>Number(U)||(q.current.value=v(null!=a?a:"").join("."),A.current!==a&&(_&&_(a,l,{type:r}),o&&k.onChange&&k.onChange(o),A.current=a),Y(a)))}),[re,L,U,_,k]),le=s(((e,r)=>{q.current&&(ee(r),r?$&&$(e):(q.current.value=oe(q.current.value),ue({}),V&&V(e)))}),[$,oe,ue,V]),ae=s((e=>{var r,n;if(re||W)return z.current=!1,void window.clearTimeout(J.current);A.current=ne(null!==(r=A.current)&&void 0!==r?r:"0",H.current,e),A.current=te(null!==(n=A.current)&&void 0!==n?n:"0"),Y(String(A.current)),_&&_(A.current,k.name,{type:e}),z.current&&(window.clearTimeout(K.current),K.current=window.setTimeout((()=>{ae(e),Q.current>100&&(Q.current-=Q.current/5)}),Q.current))}),[ne,te,re,_,k.name,W]),ie=s((e=>{if(re||W)return z.current=!1,void window.clearTimeout(J.current);J.current=window.setTimeout((()=>{z.current=!0,ae(e)}),500)}),[re,ae,W]),se=s((e=>{if(re||W)return z.current=!1,void window.clearTimeout(J.current);z.current=!1,Q.current=500,window.clearTimeout(J.current),e&&ue({type:e})}),[re,ue,W]);return c((()=>{void 0!==B&&Y(B)}),[B]),c((()=>{H.current=N}),[N]),c((()=>{G.current={increase:D,decrease:S}}),[D,S]),d(m,(()=>q.current)),o.createElement("div",{className:h("number-input",j,{focus:Z,readonly:W,disabled:P,error:y})},o.createElement("div",{className:h("number-inp-cont")},o.createElement("input",Object.assign({},k,{ref:m||q,type:"text",inputMode:"decimal",value:null!==(f=v(null!=X?X:"").join("."))&&void 0!==f?f:"",defaultValue:null!==(E=v(null!=B?B:"").join("."))&&void 0!==E?E:"",readOnly:!O,onChange:e=>ue({e:e}),onFocus:e=>le(e,!0),onBlur:e=>le(e,!1)})),!x&&o.createElement("div",{className:h("number-btn-area")},o.createElement(g,Object.assign({},T,{disabled:re||(null==T?void 0:T.disabled)}),o.createElement("button",{"data-type":"up",className:h("number-btn","up"),disabled:re||I===X,onMouseDown:()=>ie("up"),onMouseUp:()=>se("up"),onMouseOut:()=>se(),onClick:()=>ae("up")},C)),o.createElement(g,Object.assign({},T,{disabled:re||(null==T?void 0:T.disabled)}),o.createElement("button",{"data-type":"down",className:h("number-btn","down"),disabled:re||F===X,onMouseDown:()=>ie("down"),onMouseUp:()=>se("down"),onMouseOut:()=>se(),onClick:()=>ae("down")},M)))))}));E.displayName="NumberInput";var j=E;export{j as default};

import e from"@babel/runtime/helpers/slicedToArray";import{__rest as n}from"../../../_virtual/_tslib.js";import r from"decimal.js";import t from'./../../../ext/lodash/last.js';import u from'./../../../ext/lodash/replace.js';import o,{forwardRef as i,useRef as a,useState as c,useMemo as l,useCallback as d,useEffect as s,useImperativeHandle as m}from"react";import{makeCxFunc as p}from"../../../utils/forReactUtils.js";import{commaStrToNumber as v,makeParts as f}from"../../../utils/valueParserUtils.js";import w from"../../../assets/svgs/keyboard-arrow-down-2.svg.js";import b from"../../../assets/svgs/keyboard-arrow-up-2.svg.js";import g from"../../ripple/Ripple.js";import h from"./NumberInput.module.scss.js";var j=p(h),E=i((function(i,p){var h,E,N=i.className,y=void 0===N?"":N,O=i.step,D=void 0===O?1:O,S=i.error,T=i.isDirect,U=void 0===T||T,C=i.increaseStep,M=i.decreaseStep,x=i.maxLength,_=i.arrowUpElement,R=void 0===_?o.createElement(b,null):_,k=i.arrowDownElement,B=void 0===k?o.createElement(w,null):k,W=i.rippleOption,P=i.hideButton,F=i.handleChange,I=n(i,["className","step","error","isDirect","increaseStep","decreaseStep","maxLength","arrowUpElement","arrowDownElement","rippleOption","hideButton","handleChange","handleEnter"]),L=I.value,$=I.readOnly,A=I.disabled,V=I.min,q=I.max,z=void 0===q?"9999999999999":q,G=I.digit,H=void 0===G?18:G,J=I.onFocus,K=I.onBlur,Q=a(),X=a(!1),Y=a(),Z=a(),ee=a(),ne=a(0),re=a(0),te=a(1e3),ue=c(null!=L?L:""),oe=e(ue,2),ie=oe[0],ae=oe[1],ce=c(!1),le=e(ce,2),de=le[0],se=le[1],me=l((function(){return A||new r(null!=V?V:0).cmp(new r(z))>0}),[A,z,V]),pe=d((function(e,n,t){var u,o,i,a,c,l;return"up"===t?new r(e||0).add(new r(null!==(i=null!==(o=null===(u=Z.current)||void 0===u?void 0:u.increase)&&void 0!==o?o:n)&&void 0!==i?i:1)).toDP(H,r.ROUND_DOWN).toString():new r(e||0).sub(new r(null!==(l=null!==(c=null===(a=Z.current)||void 0===a?void 0:a.decrease)&&void 0!==c?c:n)&&void 0!==l?l:1)).toDP(H,r.ROUND_DOWN).toString()}),[H]),ve=d((function(e){return void 0===e||!e||me?"":e.endsWith(".")?e:void 0!==V&&new r(Number(e)).lt(new r(V))?String(V):void 0!==z&&new r(v(e||"")).gt(new r(z))?String(z):e}),[V,z,me]),fe=d((function(e){return me?"":e.endsWith(".")?e:ve(e)}),[me,ve]),we=d((function(e){var n=e.type,r=e.e;if(Q.current&&!me){var o=Q.current,i=o.value,a=o.name,c=function(e){var n,r=null===(n=null==e?void 0:e.target)||void 0===n?void 0:n.value;return u(r,/^0+[\d,]/gm,(function(e){return t(e)})).replace(/[^\d.-]/g,"")}({target:{value:i}}),l=H?new RegExp("^[0-9]*[.]{0,1}[0-9]{0,".concat(H,"}$"),"gm"):/^\d{0,18}$/;c.match(l)&&(void 0!==x&&(c||"").split(".")[0].replace(/[^0-9]/g,"").length>Number(x)||(Q.current.value=f(c).join("."),Y.current!==c&&(F&&F(c,a,{type:n}),r&&I.onChange&&I.onChange(r),Y.current=c),ae(c)))}}),[me,H,x,F,I]),be=d((function(e,n){Q.current&&(se(n),n?J&&J(e):(Q.current.value=fe(Q.current.value),we({}),K&&K(e)))}),[J,fe,we,K]),ge=d((function(e){var n,r;if(me||$)return X.current=!1,void window.clearTimeout(ne.current);Y.current=pe(null!==(n=Y.current)&&void 0!==n?n:"0",ee.current,e),Y.current=ve(null!==(r=Y.current)&&void 0!==r?r:"0"),ae(String(Y.current)),F&&F(Y.current,I.name,{type:e}),X.current&&(window.clearTimeout(re.current),re.current=window.setTimeout((function(){ge(e),te.current>100&&(te.current-=te.current/5)}),te.current))}),[pe,ve,me,F,I.name,$]),he=d((function(e){if(me||$)return X.current=!1,void window.clearTimeout(ne.current);ne.current=window.setTimeout((function(){X.current=!0,ge(e)}),500)}),[me,ge,$]),je=d((function(e){if(me||$)return X.current=!1,void window.clearTimeout(ne.current);X.current=!1,te.current=500,window.clearTimeout(ne.current),e&&we({type:e})}),[me,we,$]);return s((function(){void 0!==L&&ae(L)}),[L]),s((function(){ee.current=D}),[D]),s((function(){Z.current={increase:C,decrease:M}}),[C,M]),m(p,(function(){return Q.current})),o.createElement("div",{className:j("number-input",y,{focus:de,readonly:$,disabled:A,error:S})},o.createElement("div",{className:j("number-inp-cont")},o.createElement("input",Object.assign({},I,{ref:p||Q,type:"text",inputMode:"decimal",value:null!==(h=f(ie).join("."))&&void 0!==h?h:"",defaultValue:null!==(E=f(L).join("."))&&void 0!==E?E:"",readOnly:!U,onChange:function(e){return we({e:e})},onFocus:function(e){return be(e,!0)},onBlur:function(e){return be(e,!1)}})),!P&&o.createElement("div",{className:j("number-btn-area")},o.createElement(g,Object.assign({},W,{disabled:me||(null==W?void 0:W.disabled)}),o.createElement("button",{"data-type":"up",className:j("number-btn","up"),disabled:me||z===ie,onMouseDown:function(){return he("up")},onMouseUp:function(){return je("up")},onMouseOut:function(){return je()},onClick:function(){return ge("up")}},R)),o.createElement(g,Object.assign({},W,{disabled:me||(null==W?void 0:W.disabled)}),o.createElement("button",{"data-type":"down",className:j("number-btn","down"),disabled:me||V===ie,onMouseDown:function(){return he("down")},onMouseUp:function(){return je("down")},onMouseOut:function(){return je()},onClick:function(){return ge("down")}},B)))))}));E.displayName="NumberInput";var N=E;export{N as default};

import e,{forwardRef as t,useRef as o,useState as s,useMemo as l,Children as n,useCallback as r,useEffect as c,useImperativeHandle as a}from"react";import i from"../../../hooks/useCheckDevice.js";import{scrollFreeze as m,scrollRelease as d}from"../../../utils/browserUtils.js";import{makeCxFunc as p}from"../../../utils/forReactUtils.js";import u from"../../drawer/Drawer.js";import w from"../../../assets/svgs/ico-close-black.svg.js";import h from"../../../assets/svgs/ico-search-black.svg.js";import v from"./SelectDropBox.module.scss.js";const b=p(v),f=t(((t,p)=>{const{className:v,children:f,label:E,inputEl:y,parentEl:x,maxHeight:g=200,search:N,searchText:k="",searchPlaceholder:D,noDataMsg:C,direction:L="bottom",showCloseBtn:j,whenScrollCloseDropBox:T,setOpen:B,handleSearchTextChange:S,handleKeyPress:H}=t,Y=o(null),z=o(null),{isDesktop:M,isMobile:P}=i(),[q,I]=s(!1),[K,R]=s(L),U=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",U+"px");const W=l((()=>0===n.map(f,(e=>e)).length),[f]),A=l((()=>!!P&&(E||j)),[P,E,j]),F=r(((e,t)=>{const o=window.scrollY,s=window.scrollY+window.innerHeight;"top"===L&&e-t+10<o?R("bottom"):"bottom"===L&&e+g+10>s&&R("top")}),[L,g]),O=r((e=>{var t;if(!e)return;const{clientWidth:o,clientHeight:s}=e,l=e.getBoundingClientRect(),n="fixed"===document.body.style.position&&!!document.body.style.top&&Number(document.body.style.top.replace("px",""))<0?-1*Number(document.body.style.top.replace("px","")):window.scrollY,r=l.top+n,{left:c}=l;let a="min-width:".concat(o,"px;");const i=null!==(t=Y.current.clientHeight)&&void 0!==t?t:0;switch(F(l.top+window.scrollY,i),K){case"top":a+="top: ".concat(r-i-10,"px; left: ").concat(c,"px;");break;case"bottom":a+="top: ".concat(r+s+10,"px; left: ").concat(c,"px;")}return a}),[F,K]),G=r((e=>{const{value:t}=e.target;S(t)}),[S]),J=r((()=>{S("")}),[S]),Q=r((()=>{y&&y.blur(),B(!1)}),[y,B]);return c((()=>{var e;const t=Y.current,o=z.current,s=O(x);if(t&&o){const l=o.querySelector(".active");"function"==typeof o.scrollTo&&o.scrollTo(0,null!==(e=null==l?void 0:l.offsetTop)&&void 0!==e?e:0),t.setAttribute("style",s)}}),[O,x]),c((()=>{if(z){const e=z.current,t=e.querySelector(".match");t&&([...e.children].map((e=>e.classList.remove("match"))),t.classList.add("match"),e.scrollTo(0,t.offsetTop))}}),[k,z]),c((()=>{const e=()=>{window.innerWidth<800||(B(!1),y&&y.blur())};return window.removeEventListener("resize",e),window.addEventListener("resize",e),T&&(window.removeEventListener("scroll",e),window.addEventListener("scroll",e)),()=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e)}}),[y,B,T]),c((()=>(P&&m(),()=>{P&&d()})),[P]),a(p,(()=>Y.current)),e.createElement("div",{ref:Y,role:"button",tabIndex:-1,className:b(v,K,"select-drop-box",P?"":"desktop")},e.createElement("div",{className:b("dim"),onClick:Q}),e.createElement(u,{className:b("contents"),direction:"top",disabled:M,onClose:()=>Q()},e.createElement("div",null,A&&e.createElement("div",{className:b("hd")},E&&e.createElement("label",{className:b("label")},E),j&&e.createElement("button",{type:"button",className:b("btn-close"),onClick:Q},e.createElement(w,null))),N&&e.createElement("div",{className:b("search-area")},e.createElement(h,{className:b("ico-search")}),e.createElement("input",{type:"search",placeholder:D,value:k,onInput:G,onKeyDown:H,onFocus:()=>I(!0),onBlur:()=>I(!1)}),e.createElement("button",{type:"button",style:{display:q&&k?"block":"none"},onMouseDown:J},e.createElement(w,{className:b("ico-reset")}))),e.createElement("div",{ref:z,className:b("scroll-area")},W?C:f))))}));f.displayName="SelectDropBox";var E=f;export{E as default};

import e from"@babel/runtime/helpers/toConsumableArray";import t from"@babel/runtime/helpers/slicedToArray";import o,{forwardRef as n,useRef as r,useState as l,useMemo as c,Children as s,useCallback as i,useEffect as a,useImperativeHandle as u}from"react";import m from"../../../hooks/useCheckDevice.js";import{scrollFreeze as d,scrollRelease as p}from"../../../utils/browserUtils.js";import{makeCxFunc as f}from"../../../utils/forReactUtils.js";import v from"../../drawer/Drawer.js";import b from"../../../assets/svgs/ico-close-black.svg.js";import h from"../../../assets/svgs/ico-search-black.svg.js";import w from"./SelectDropBox.module.scss.js";var y=f(w),E=n((function(n,f){var w=n.className,E=n.children,x=n.label,g=n.inputEl,N=n.parentEl,k=n.maxHeight,C=void 0===k?200:k,D=n.search,L=n.searchText,T=void 0===L?"":L,j=n.searchPlaceholder,B=n.noDataMsg,S=n.direction,H=void 0===S?"bottom":S,Y=n.showCloseBtn,z=n.whenScrollCloseDropBox,A=n.setOpen,M=n.handleSearchTextChange,P=n.handleKeyPress,q=r(null),I=r(null),K=m(),R=K.isDesktop,U=K.isMobile,W=l(!1),F=t(W,2),O=F[0],G=F[1],J=l(H),Q=t(J,2),V=Q[0],X=Q[1],Z=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",Z+"px");var $=c((function(){return 0===s.map(E,(function(e){return e})).length}),[E]),_=c((function(){return!!U&&(x||Y)}),[U,x,Y]),ee=i((function(e,t){var o=window.scrollY,n=window.scrollY+window.innerHeight;"top"===H&&e-t+10<o?X("bottom"):"bottom"===H&&e+C+10>n&&X("top")}),[H,C]),te=i((function(e){var t;if(e){var o=e.clientWidth,n=e.clientHeight,r=e.getBoundingClientRect(),l="fixed"===document.body.style.position&&!!document.body.style.top&&Number(document.body.style.top.replace("px",""))<0?-1*Number(document.body.style.top.replace("px","")):window.scrollY,c=r.top+l,s=r.left,i="min-width:".concat(o,"px;"),a=null!==(t=q.current.clientHeight)&&void 0!==t?t:0;switch(ee(r.top+window.scrollY,a),V){case"top":i+="top: ".concat(c-a-10,"px; left: ").concat(s,"px;");break;case"bottom":i+="top: ".concat(c+n+10,"px; left: ").concat(s,"px;")}return i}}),[ee,V]),oe=i((function(e){var t=e.target.value;M(t)}),[M]),ne=i((function(){M("")}),[M]),re=i((function(){g&&g.blur(),A(!1)}),[g,A]);return a((function(){var e,t=q.current,o=I.current,n=te(N);if(t&&o){var r=o.querySelector(".active");"function"==typeof o.scrollTo&&o.scrollTo(0,null!==(e=null==r?void 0:r.offsetTop)&&void 0!==e?e:0),t.setAttribute("style",n)}}),[te,N]),a((function(){if(I){var t=I.current,o=t.querySelector(".match");o&&(e(t.children).map((function(e){return e.classList.remove("match")})),o.classList.add("match"),t.scrollTo(0,o.offsetTop))}}),[T,I]),a((function(){var e=function(){window.innerWidth<800||(A(!1),g&&g.blur())};return window.removeEventListener("resize",e),window.addEventListener("resize",e),z&&(window.removeEventListener("scroll",e),window.addEventListener("scroll",e)),function(){window.removeEventListener("scroll",e),window.removeEventListener("resize",e)}}),[g,A,z]),a((function(){return U&&d(),function(){U&&p()}}),[U]),u(f,(function(){return q.current})),o.createElement("div",{ref:q,role:"button",tabIndex:-1,className:y(w,V,"select-drop-box",U?"":"desktop")},o.createElement("div",{className:y("dim"),onClick:re}),o.createElement(v,{className:y("contents"),direction:"top",disabled:R,onClose:function(){return re()}},o.createElement("div",null,_&&o.createElement("div",{className:y("hd")},x&&o.createElement("label",{className:y("label")},x),Y&&o.createElement("button",{type:"button",className:y("btn-close"),onClick:re},o.createElement(b,null))),D&&o.createElement("div",{className:y("search-area")},o.createElement(h,{className:y("ico-search")}),o.createElement("input",{type:"search",placeholder:j,value:T,onInput:oe,onKeyDown:P,onFocus:function(){return G(!0)},onBlur:function(){return G(!1)}}),o.createElement("button",{type:"button",style:{display:O&&T?"block":"none"},onMouseDown:ne},o.createElement(b,{className:y("ico-reset")}))),o.createElement("div",{ref:I,className:y("scroll-area")},$?B:E))))}));E.displayName="SelectDropBox";export{E as default};

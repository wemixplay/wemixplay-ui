import{__rest as e}from"../../../_virtual/_tslib.js";import r,{forwardRef as l,useRef as o,useState as t,useMemo as n,Children as a,useCallback as s,useEffect as c,useImperativeHandle as p,cloneElement as i}from"react";import u from"../../../hooks/useClickOutside.js";import{makeCxFunc as d}from"../../../utils/forReactUtils.js";import h from"../../noData/NoDataText.js";import m from"../../portal/Portal.js";import v from"../../../assets/svgs/ico-accordion.svg.js";import f from"./SelectBox.module.scss.js";import g from"./SelectDropBox.js";const x=d(f),C=l(((l,d)=>{const{className:f="",children:C,name:w,value:b,error:y,search:D,mobileLabel:E,placeholder:B,disabled:N,readOnly:j,dropBoxClassName:k,selectArrow:S=r.createElement(v,null),keepDropDown:O,searchPlaceholder:P="Search",showCloseBtn:A,whenScrollCloseDropBox:L,noDataMsg:T=r.createElement(h,{className:x("no-data")}),onClick:F,handleChange:M}=l,K=e(l,["className","children","name","value","error","search","mobileLabel","placeholder","disabled","readOnly","dropBoxClassName","selectArrow","keepDropDown","searchPlaceholder","showCloseBtn","whenScrollCloseDropBox","noDataMsg","onClick","handleChange"]),U=o(null),_=o(null),I=o(null),[R,V]=t(null!=b?b:""),[q,z]=t(""),[G,H]=t(""),[J,Q]=t(!1),[W,X]=t(!1),Y=n((()=>{const e=e=>{let{value:r}=e;N||(V(r),M&&M(r,w),U.current.value=String(r),K.onChange&&K.onChange({target:U.current}),O||Q(!1))},r=l=>(null!=l?l:[]).flatMap((l=>{var o;if(!(null==l?void 0:l.props))return[];if("Option"===(null===(o=l.type)||void 0===o?void 0:o.displayName)){let r;return l.props.text||(r="string"==typeof l.props.label?l.props.label:"string"==typeof l.props.children?l.props.children:l.props.value.toString()),i(l,Object.assign(Object.assign({},l.props),{text:r.toLowerCase(),selectedValue:R,searchText:q,handleChange:e}))}return Array.isArray(l.props.children)?r(l.props.children):[]})),l=a.map(C,(e=>e));return r(l)}),[C,N,M,O,w,q,R,K]),Z=n((()=>Y.filter((e=>e.props.text.toLowerCase().includes(G.toLowerCase())))),[Y,G]),$=n((()=>Y.find((e=>e.props.value===R||e.props.value===b))),[Y,R,b]),ee=n((()=>{var e,r,l,o,t;if(!$)return{text:null!==(o=null!==(r=null!=B?B:null===(e=Y[0])||void 0===e?void 0:e.props.label)&&void 0!==r?r:null===(l=Y[0])||void 0===l?void 0:l.props.children)&&void 0!==o?o:"",isPlaceholder:!!B};const{label:n,children:a}=$.props;return{text:null!==(t=null!=n?n:a)&&void 0!==t?t:"",isPlaceholder:!1}}),[$,Y,B]),re=s((()=>{if(F)F();else{if(N||j)return;Q((e=>!e))}}),[N,j,F]),le=s((e=>{z(e),H(e)}),[]),oe=s((()=>{if(!J)return void Q(!0);const e=Y.find((e=>e.props.text.includes(q.toLowerCase())));e&&(V(e.props.value),M&&M(e.props.value,w),U.current.value=e.props.value,K.onChange&&K.onChange({target:U.current}),Q(!1),U.current.blur())}),[M,K,w,J,Y,q]),te=s((e=>{let r;const l=Y.findIndex((e=>q?e.props.text===q:e.props.value===R));r="down"===e?l+1>=Y.length?Y[0]:Y[l+1]:l<=0?Y[Y.length-1]:Y[l-1];const o=r.props.text;z(o)}),[Y,R,q]),ne=s((e=>{"Enter"!==e.key||e.nativeEvent.isComposing?"ArrowDown"===e.key?(te("down"),e.preventDefault()):"ArrowUp"===e.key&&(te("up"),e.preventDefault()):oe()}),[oe,te]),ae=s(((e,r)=>{X(r),r?K.onFocus&&K.onFocus(e):K.onBlur&&K.onBlur(e)}),[K]);return u(_,(e=>{var r;"button"in e&&2===e.button||(null===(r=I.current)||void 0===r?void 0:r.contains(e.target))||Q(!1)}),{offTouchEvent:!0}),c((()=>{if(Y.length&&!B&&!$){const e=Y[0].props.value;V(e)}}),[B,$,Y]),c((()=>{void 0!==b&&V(b)}),[b]),c((()=>{J||z("")}),[J]),p(d,(()=>(U.current.handleClickSelectBox=re,U.current))),r.createElement(r.Fragment,null,r.createElement("div",{ref:_,className:x("select-box",f,{open:J,focus:W,disabled:N,error:y,readonly:j,placeholder:ee.isPlaceholder,"not-allow":N}),onClick:re},r.createElement("label",null,r.createElement("div",{className:x("value",{placeholder:ee.isPlaceholder})},r.createElement("span",null,ee.text)),r.createElement("input",Object.assign({},K,{ref:U,type:"text",value:R,name:w,readOnly:!0,onFocus:e=>ae(e,!0),onBlur:e=>ae(e,!1),onKeyDown:ne})),r.createElement("i",{className:x("ico-arrow")},S))),J&&r.createElement(m,null,r.createElement(g,{ref:I,className:k,label:E,inputEl:U.current,parentEl:_.current,setOpen:Q,search:D,searchText:q,searchPlaceholder:P,showCloseBtn:A,whenScrollCloseDropBox:L,noDataMsg:T,handleSearchTextChange:le,handleKeyPress:ne},Z)))}));C.displayName="SelectBox";var w=C;export{w as default};

"use client";
import{__awaiter as t}from"../../_virtual/_tslib.js";import e from'./../../ext/lodash/debounce.js';import r from'./../../ext/lodash/throttle.js';import o,{useRef as n,useState as i,useMemo as c,useCallback as l,useEffect as a}from"react";import{isMobile as s}from"react-device-detect";import p from"../../hooks/useClickOutside.js";import{makeCxFunc as d}from"../../utils/forReactUtils.js";import h from"../portal/Portal.js";import u from"./Tooltip.module.scss.js";import m from"../../assets/svgs/ico-tooltip-arrow.svg.js";const g=d(u);var f=d=>{let{className:u="",anchorId:f,width:w=200,space:v=4,place:x="bottom",events:b=["hover"],arrowPosition:H=0,hideArrow:W,tooltipPosition:E,tooltipColor:y,tooltipTextColor:L,tooltipBoxShadow:N,tooltipBorderRadius:Y,open:X,whenWindowScrollClose:j,children:T}=d;const k=n(),C=n(),A=n(),B=n(),P=n(0),R=n(!1),[_,z]=i(!1),[S,D]=i(x),[I,q]=i(!!X),O=c((()=>{const t=[...b],e=t.findIndex((t=>"hover"===t));return-1===e||s||t.splice(e,0,"mouseover","mouseout"),t}),[b]),U=l((()=>{if(C.current)return C.current;const t=document.querySelector("#".concat(f));t&&(C.current=t)}),[f]),F=l(((t,e)=>{var r;const{scrollY:o,innerHeight:n}=window,i=o,c=o+n,{top:l}=null===(r=C.current)||void 0===r?void 0:r.getBoundingClientRect();return i>t&&l>0?t+l:c<t+e?c-e-10:t}),[]),G=l(((t,e)=>{const{scrollX:r,innerWidth:o}=window,n=r+o;return r>t?r+v:n<t+e?n-e-v:t}),[v]),J=l((t=>{const{targetTop:e,targetLeft:r,targetWidth:o,targetHeight:n,tooltipHeight:i,arrowWidth:c,arrowHeight:l}=t;return scrollY+e-i-l-v<scrollY&&"top"===x?"bottom":scrollY+e+n+l+v>scrollY+innerHeight&&"bottom"===x?"top":r-c-v<100&&"left"===x?"right":innerWidth-(scrollX+r+o+c+v+10)<100&&"right"===x?"left":r+scrollX<scrollX?"right":x}),[x,v]),K=l((()=>{var t;if(!k.current||!C.current)return{targetTop:0,targetLeft:0,targetWidth:0,targetHeight:0,arrowWidth:0,arrowHeight:0,tooltipWidth:0,tooltipHeight:0,scrollX:0,scrollY:0,innerWidth:0,innerHeight:0};const{top:e,left:r,height:o,width:n}=C.current.getBoundingClientRect(),{offsetHeight:i,offsetWidth:c}=k.current,{clientWidth:l=0,clientHeight:a=0}=null!==(t=A.current)&&void 0!==t?t:{},{scrollX:s,scrollY:p,innerWidth:d,innerHeight:h}=window,{position:u,top:m,left:g}=document.body.style,f="fixed"===u?-1*Number(m.replace("px","")):0,w="fixed"===u?-1*Number(g.replace("px","")):0;return{targetTop:e,targetLeft:r,targetWidth:n,targetHeight:o,arrowWidth:l,arrowHeight:a,tooltipWidth:c,tooltipHeight:i,scrollX:w||s,scrollY:f||p,innerWidth:d,innerHeight:h}}),[]),M=l((()=>t(void 0,void 0,void 0,(function*(){if(!C.current||!k.current)return;const{targetTop:t,targetLeft:e,targetWidth:r,targetHeight:o,arrowWidth:n,arrowHeight:i,tooltipWidth:c,tooltipHeight:l,scrollX:a,scrollY:s,innerWidth:p,innerHeight:d}=K(),{top:h=0,left:u=0}=null!=E?E:{},m=H||0,g=J({targetTop:t,targetLeft:e,targetWidth:r,targetHeight:o,arrowWidth:n,arrowHeight:i,tooltipWidth:c,tooltipHeight:l,scrollX:a,scrollY:s,innerWidth:p,innerHeight:d});D(g);let f="",w="",x="";switch(g){case"top":f+="\n          top: ".concat(h+s+t-l-i-v,"px;\n          left: ").concat(G(u+a+e+r/2-c/2,c),"px;\n        "),w+="\n          top: ".concat(h+s+t-i-v,"px;\n          left: ").concat(m+a+e+r/2-n/2,"px;\n        ");break;case"left":f+="\n          top: ".concat(F(h+s+t-(l-o)/2,l),"px;\n          left: ").concat(G(u+a+e-c-i-v,c),"px;\n          max-width: ").concat(e-n-v,"px;\n        "),w+="\n          top: ".concat(m+s+t+o/2-n/2,"px;\n          left: ").concat(u+a+e-n-v,"px;\n        ");break;case"right":f+="\n          top: ".concat(F(h+s+t-(l-o)/2,l),"px;\n          left: ").concat(u+a+e+r+n+v,"px;\n          max-width: ").concat(p-(a+e+r+n+v+10),"px;\n        "),w+="\n          top: ".concat(m+s+t+o/2-i/2,"px;\n          left: ").concat(u+a+e+r+v,"px;\n        ");break;default:f+="\n        top: ".concat(h+s+t+o+i+v,"px;\n        left: ").concat(G(u+a+e+r/2-c/2,c),"px;\n      "),w+="\n        transform: rotate(0deg);\n        top: ".concat(h+s+t+o+v,"px;\n        left: ").concat(m+a+e+r/2-n/2,"px;\n      ")}if(x+="\n      ".concat(f,"\n      width: ").concat(c,"px;\n      height: ").concat(l,"px;\n    "),k.current.setAttribute("style",f),B.current.setAttribute("style",x),A.current&&A.current.setAttribute("style",w),2===P.current)return P.current=0,q(!0);var b;yield(b=20,new Promise((t=>setTimeout(t,b)))),P.current+=1,M()}))),[H,v,E,J,G,F,K]),Q=c((()=>e((t=>{"click"!==t.type&&R.current||("click"===t.type&&(t.preventDefault(),R.current=!0),"mouseout"===t.type?q(!1):0===P.current&&M(),t.preventDefault())}),100)),[M]),V=l((()=>{C.current&&"boolean"!=typeof X&&O.forEach((t=>{C.current.addEventListener(t,Q)}))}),[X,O,Q]),Z=l((()=>{C.current&&O.forEach((t=>{C.current.removeEventListener(t,Q)}))}),[O,Q]);return p(k,(t=>{if("boolean"==typeof X)return;const e=C.current;e&&!e.contains(t.target)&&(R.current=!1,q(!1))})),a((()=>(U(),V(),()=>{Z()})),[M,U,V,Z]),a((()=>{const t=r((()=>{q(!1)}),30);return window.removeEventListener("resize",t),window.addEventListener("resize",t),j&&(window.removeEventListener("scroll",t),window.addEventListener("scroll",t)),()=>{window.removeEventListener("resize",t),window.removeEventListener("scroll",t)}}),[j,M]),a((()=>{X&&_&&M(),q(X)}),[_,X,M]),o.createElement(h,{id:"tooltip"},o.createElement("div",{ref:()=>{_||z(!0)},className:g("tooltip",u,S,{open:I}),style:{visibility:I?"visible":"hidden","--tooltip-color":y,"--tooltip-text-color":L,"--tooltip-box-shadow":N,"--tooltip-border-radius":Y}},o.createElement("div",{ref:B,className:g("tooltip-shadow")}),!W&&o.createElement("div",{ref:A,className:g("tooltip-arrow")},o.createElement("span",null,o.createElement(m,{className:g("tooltip-arrow-icon")}))),o.createElement("div",{ref:k,className:g("tooltip-text")},o.createElement("div",{className:g("speech-bubble-wrap")},o.createElement("div",{className:g("speech-bubble"),style:{width:w}},o.createElement("div",null,T))))))};export{f as default};

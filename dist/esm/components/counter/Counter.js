import{__awaiter as e}from"../../_virtual/_tslib.js";import r,{useRef as t,useState as n,useMemo as o,useCallback as u,useEffect as c}from"react";import{makeCxFunc as s}from"../../utils/forReactUtils.js";import a from"./Counter.module.scss.js";import{splitNumberStringByComma as i,formatNumberValueWithComma as l}from"../../utils/valueParserUtils.js";const d=s(a),m=e=>{var r;return(null===(r=i(String(e))[1])||void 0===r?void 0:r.length)||0},p=(e,r)=>new Promise((t=>{const n=setTimeout((()=>{t("pass")}),e);r.addEventListener("abort",(()=>{clearTimeout(n),t("aborted")}))}));var f=s=>{let{className:a="",endValue:f=0,startValue:v=0,delay:b=0,countOnIntersected:g=!0,duration:w=1500,separator:h=!0,iterationCount:k=1,pause:A=!1,digits:E=0,usePauseResume:j=!1,onEnd:y}=s;const C=t(null),F=t(v),P=t(0),T=t(w),q=t(null),x=t(null),N=t(A?"paused":"go"),R=t(null),[I,L]=n(A),[M,O]=n(!1),S=o((()=>f>v?"up":"down"),[f,v]),U=o((()=>void 0===E?m(f):E),[E,f]),V=u((e=>{const r=e-P.current;return T.current=w-r,v+r/w*(f-v)}),[w,f,v]),_=u((e=>{const[r,t]=i(String(e)),n=r+(U&&t?".".concat(t.slice(0,U)):"");return h?l(n):n}),[U,h]),H=u((e=>{const r=V(e);return F.current=r,_(r)}),[V,_]),W=u((e=>{const{current:r}=C;r&&(r.innerHTML=e)}),[]),z=u((()=>{F.current=v,T.current=w,P.current=performance.now(),q.current=null,N.current="go"}),[v,w]),B=u((()=>new Promise((e=>{const r=t=>{if("props-changed"===N.current)return e("break");if("up"===S?F.current>=f:F.current<=f)return W(_(f)),e("done");W(H(t)),q.current=requestAnimationFrame(r)};z(),x.current=r,q.current=requestAnimationFrame(r)}))),[f,S,z,W,H,_]),D=u((()=>e(void 0,void 0,void 0,(function*(){for(let e=0;e<k;e++){if(b>0){const r=yield p(b,R.current.signal);if("paused"===N.current){e--;continue}if("aborted"===r)break}const r=yield B();if("break"===r)break;e===k-1&&"done"===r&&O(!0)}x.current=null}))),[b,k,B]),G=u((()=>{if(g&&"undefined"!=typeof Window){const e=new IntersectionObserver((r=>{let[{intersectionRatio:t}]=r;t>0&&(D(),e.disconnect())}),{root:null,rootMargin:"100px 0px",threshold:[.1,.2,.3,.4,.5,.7,.8,.9,1]});e.observe(C.current)}else D()}),[g,D]),J=u((()=>{I?(N.current="go",x.current&&(P.current=performance.now()-(w-T.current),requestAnimationFrame(x.current))):(N.current="paused",cancelAnimationFrame(q.current)),L(!I)}),[w,I]);return c((()=>(R.current=new AbortController,W(_(v)),L(A),setTimeout((()=>{N.current=A?"paused":"go"}),20),G(),()=>{R.current.abort(),N.current="props-changed"})),[v,f,b,w,h,k,E,A,W,_,G]),c((()=>{M&&(null==y||y(),O(!1))}),[M,y]),r.createElement("span",{className:d("counter-wrapper",a)},r.createElement("span",{ref:C,className:d("counter-value")}),j&&r.createElement("button",{onClick:J},I?"resume":"pause"))};export{f as default};

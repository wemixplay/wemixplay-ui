import r from"@babel/runtime/helpers/slicedToArray";import e from"@babel/runtime/regenerator";import{__awaiter as n}from"../../_virtual/_tslib.js";import t,{useRef as u,useState as o,useMemo as i,useCallback as a,useEffect as c}from"react";import{makeCxFunc as s}from"../../utils/forReactUtils.js";import l from"./Counter.module.scss.js";import{splitNumberStringByComma as f,formatNumberValueWithComma as d}from"../../utils/valueParserUtils.js";var m=s(l),p=function(s){var l=s.className,p=void 0===l?"":l,g=s.endValue,k=void 0===g?0:g,x=s.startValue,w=void 0===x?0:x,h=s.delay,A=void 0===h?0:h,E=s.countOnIntersected,T=void 0===E||E,j=s.duration,C=void 0===j?1500:j,F=s.separator,P=void 0===F||F,q=s.iterationCount,y=void 0===q?1:q,N=s.pause,R=void 0!==N&&N,I=s.digits,L=void 0===I?0:I,M=s.usePauseResume,O=void 0!==M&&M,S=s.onEnd,U=u(null),V=u(w),_=u(0),H=u(C),W=u(null),z=u(null),B=u(R?"paused":"go"),D=u(null),G=o(R),J=r(G,2),K=J[0],Q=J[1],X=o(!1),Y=r(X,2),Z=Y[0],$=Y[1],rr=i((function(){return k>w?"up":"down"}),[k,w]),er=i((function(){return void 0===L?v(k):L}),[L,k]),nr=a((function(r){var e=r-_.current;return H.current=C-e,w+e/C*(k-w)}),[C,k,w]),tr=a((function(e){var n=f(String(e)),t=r(n,2),u=t[0],o=t[1],i=u+(er&&o?".".concat(o.slice(0,er)):"");return P?d(i):i}),[er,P]),ur=a((function(r){var e=nr(r);return V.current=e,tr(e)}),[nr,tr]),or=a((function(r){var e=U.current;e&&(e.innerHTML=r)}),[]),ir=a((function(){V.current=w,H.current=C,_.current=performance.now(),W.current=null,B.current="go"}),[w,C]),ar=a((function(){return new Promise((function(r){var e=function(n){return"props-changed"===B.current?r("break"):("up"===rr?V.current>=k:V.current<=k)?(or(tr(k)),r("done")):(or(ur(n)),void(W.current=requestAnimationFrame(e)))};ir(),z.current=e,W.current=requestAnimationFrame(e)}))}),[k,rr,ir,or,ur,tr]),cr=a((function(){return n(void 0,void 0,void 0,e.mark((function r(){var n,t,u;return e.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=0;case 1:if(!(n<y)){r.next=20;break}if(!(A>0)){r.next=11;break}return r.next=5,b(A,D.current.signal);case 5:if(t=r.sent,"paused"!==B.current){r.next=9;break}return n--,r.abrupt("continue",17);case 9:if("aborted"!==t){r.next=11;break}return r.abrupt("break",20);case 11:return r.next=13,ar();case 13:if("break"!==(u=r.sent)){r.next=16;break}return r.abrupt("break",20);case 16:n===y-1&&"done"===u&&$(!0);case 17:n++,r.next=1;break;case 20:z.current=null;case 21:case"end":return r.stop()}}),r)})))}),[A,y,ar]),sr=a((function(){if(T&&"undefined"!=typeof Window){var e=new IntersectionObserver((function(n){r(n,1)[0].intersectionRatio>0&&(cr(),e.disconnect())}),{root:null,rootMargin:"100px 0px",threshold:[.1,.2,.3,.4,.5,.7,.8,.9,1]});e.observe(U.current)}else cr()}),[T,cr]),lr=a((function(){K?(B.current="go",z.current&&(_.current=performance.now()-(C-H.current),requestAnimationFrame(z.current))):(B.current="paused",cancelAnimationFrame(W.current)),Q(!K)}),[C,K]);return c((function(){return D.current=new AbortController,or(tr(w)),Q(R),setTimeout((function(){B.current=R?"paused":"go"}),20),sr(),function(){D.current.abort(),B.current="props-changed"}}),[w,k,A,C,P,y,L,R,or,tr,sr]),c((function(){Z&&(null==S||S(),$(!1))}),[Z,S]),t.createElement("span",{className:m("counter-wrapper",p)},t.createElement("span",{ref:U,className:m("counter-value")}),O&&t.createElement("button",{onClick:lr},K?"resume":"pause"))},v=function(r){var e;return(null===(e=f(String(r))[1])||void 0===e?void 0:e.length)||0},b=function(r,e){return new Promise((function(n){var t=setTimeout((function(){n("pass")}),r);e.addEventListener("abort",(function(){clearTimeout(t),n("aborted")}))}))};export{p as default};

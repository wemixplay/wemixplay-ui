import e from"@babel/runtime/helpers/slicedToArray";import{__rest as t}from"../../_virtual/_tslib.js";import r,{forwardRef as n,useRef as a,useState as i,useCallback as o,useEffect as m,useImperativeHandle as l}from"react";import s from"./CommentEditor.module.scss.js";import{makeCxFunc as c}from"../../utils/forReactUtils.js";import u from"./CommentWriterInfo.js";import d from"../buttons/SolidCapButton.js";import f from"../editor/WpEditor.js";import p from"../../plugins/mention/Mention.js";import h from"../../plugins/autoUrlMatch/AutoUrlMatch.js";import g from"../../plugins/countTextLength/CountTextLength.js";import v from"../../plugins/pasteToPlainText/PasteToPlainText.js";import{convertMarkdownToHtmlStr as b,convertHtmlToMarkdownStr as x,commaWithValue as j,removeSpaceAndLineBreak as N}from"../../utils/valueParserUtils.js";var T=c(s),E=n((function(n,s){var c,E=n.className,C=void 0===E?"":E,U=n.writerName,L=n.writerImg,w=n.btnSubmitText,M=void 0===w?"POST":w,P=n.value,S=n.config,I=n.minLength,O=void 0===I?1:I,_=n.maxLength,k=void 0===_?1e3:_,y=n.placeholder,A=n.name,D=n.handleChange,R=n.handleSubmit,W=t(n,["className","writerName","writerImg","btnSubmitText","value","config","minLength","maxLength","placeholder","name","handleChange","handleSubmit"]),z=a(),B=i(b(null!=P?P:"")),V=e(B,2),q=V[0],F=V[1],G=i(null!==(c=null==P?void 0:P.length)&&void 0!==c?c:0),H=e(G,2),J=H[0],K=H[1],Q=o((function(e){return e.textUrls.map((function(e){return'<a href="'.concat(e,'" target="_blank">').concat(e,"</a>")}))}),[]),X=o((function(e,t){var r=x(e);F(r),D&&D(r,t)}),[A,D]),Y=o((function(){R&&R(q)}),[q,R]);return m((function(){if(P&&!q){var e=b(P);F(e)}}),[P,q]),l(s,(function(){var e=z.current.setData;return z.current.setData=function(t,r){var n=b(t);e(n,r)},z.current})),r.createElement("div",{className:T(C,"comment-editor")},r.createElement(u,{className:T("editor-profile"),writerName:U,writerImg:L}),r.createElement("div",{className:T("editor-area")},r.createElement(f,Object.assign({className:T("editor",{filled:q.length}),plugin:[p,h,v,g],config:Object.assign(Object.assign({},S),{pasteToPlainText:{onMatchUrlReplace:Q},autoUrlMatch:{onMatchUrl:function(e){return Q({textUrls:[e]})}},countTextLength:{hideUi:!0,onChangeTextLength:K}}),name:A,initialValue:q,placeholder:y,maxLength:k,handleChange:X},W,{ref:z}))),r.createElement("div",{className:T("editor-tool")},r.createElement("em",{className:T("counter-current")},j(J)),"/",r.createElement("span",{className:T("counter-max")},j(k)),r.createElement(d,{size:"medium",className:T("btn-post"),disabled:O>J||!N(q),onClick:Y},M)))}));E.displayName="CommentEditor";export{E as default};

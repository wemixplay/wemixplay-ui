import{__rest as e}from"../../_virtual/_tslib.js";import t,{forwardRef as a,useRef as r,useState as n,useCallback as o,useEffect as l,useImperativeHandle as m}from"react";import i from"./CommentEditor.module.scss.js";import{makeCxFunc as s}from"../../utils/forReactUtils.js";import c from"./CommentWriterInfo.js";import u from"../buttons/SolidCapButton.js";import d from"../editor/WpEditor.js";import p from"../../plugins/mention/Mention.js";import g from"../../plugins/autoUrlMatch/AutoUrlMatch.js";import h from"../../plugins/countTextLength/CountTextLength.js";import f from"../../plugins/pasteToPlainText/PasteToPlainText.js";import{convertMarkdownToHtmlStr as x,convertHtmlToMarkdownStr as b,commaWithValue as j,removeSpaceAndLineBreak as N}from"../../utils/valueParserUtils.js";const T=s(i),v=a(((a,i)=>{var s,{className:v="",writerName:E,writerImg:C,btnSubmitText:U="POST",value:L,config:w,minLength:M=1,maxLength:P=1e3,placeholder:S,name:I,handleChange:O,handleSubmit:_}=a,k=e(a,["className","writerName","writerImg","btnSubmitText","value","config","minLength","maxLength","placeholder","name","handleChange","handleSubmit"]);const D=r(),[R,W]=n(x(null!=L?L:"")),[y,z]=n(null!==(s=null==L?void 0:L.length)&&void 0!==s?s:0),A=o((e=>{let{textUrls:t}=e;return t.map((e=>'<a href="'.concat(e,'" target="_blank">').concat(e,"</a>")))}),[]),B=o(((e,t)=>{const a=b(e);W(a),O&&O(a,t)}),[I,O]),V=o((()=>{_&&_(R)}),[R,_]);return l((()=>{if(L&&!R){const e=x(L);W(e)}}),[L,R]),m(i,(()=>{const{setData:e}=D.current;return D.current.setData=(t,a)=>{const r=x(t);e(r,a)},D.current})),t.createElement("div",{className:T(v,"comment-editor")},t.createElement(c,{className:T("editor-profile"),writerName:E,writerImg:C}),t.createElement("div",{className:T("editor-area")},t.createElement(d,Object.assign({className:T("editor",{filled:R.length}),plugin:[p,g,f,h],config:Object.assign(Object.assign({},w),{pasteToPlainText:{onMatchUrlReplace:A},autoUrlMatch:{onMatchUrl:e=>A({textUrls:[e]})},countTextLength:{hideUi:!0,onChangeTextLength:z}}),name:I,initialValue:R,placeholder:S,maxLength:P,handleChange:B},k,{ref:D}))),t.createElement("div",{className:T("editor-tool")},t.createElement("em",{className:T("counter-current")},j(y)),"/",t.createElement("span",{className:T("counter-max")},j(P)),t.createElement(u,{size:"medium",className:T("btn-post"),disabled:M>y||!N(R),onClick:V},U)))}));v.displayName="CommentEditor";var E=v;export{E as default};

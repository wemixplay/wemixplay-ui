"use client";
import{__rest as e}from"../../_virtual/_tslib.js";import t,{forwardRef as a,useRef as r,useState as n,useCallback as o,useEffect as m,useImperativeHandle as i}from"react";import l from"./CommentEditor.module.scss.js";import{makeCxFunc as s}from"../../utils/forReactUtils.js";import c from"./CommentWriterInfo.js";import u from"../buttons/SolidCapButton.js";import d from"../editor/WpEditor.js";import p from"../../plugins/mention/Mention.js";import h from"../../plugins/autoUrlMatch/AutoUrlMatch.js";import g from"../../plugins/countTextLength/CountTextLength.js";import f from"../../plugins/pasteToPlainText/PasteToPlainText.js";import{convertMarkdownToHtmlStr as b,convertHtmlToMarkdownStr as x,commaWithValue as N,removeSpaceAndLineBreak as j}from"../../utils/valueParserUtils.js";import T from'./../../ext/lodash/merge.js';const v=s(l),E=a(((a,l)=>{var s,{className:E="",writerName:C,writerImg:U,btnSubmitText:L="POST",value:S,config:w,minLength:M=1,maxLength:P=1e3,placeholder:D,name:I,isSubmitDisabled:_=!1,handleChange:k,handleSubmit:O}=a,R=e(a,["className","writerName","writerImg","btnSubmitText","value","config","minLength","maxLength","placeholder","name","isSubmitDisabled","handleChange","handleSubmit"]);const W=r(),[y,z]=n(b(null!=S?S:"")),[A,B]=n(null!==(s=null==S?void 0:S.length)&&void 0!==s?s:0),V=o((e=>{let{textUrls:t}=e;return t.map((e=>'<a href="'.concat(e,'" target="_blank">').concat(e,"</a>")))}),[]),q=o(((e,t)=>{const a=x(e);z(a),k&&k(a,t)}),[I,k]),F=o((()=>{O&&O(y)}),[y,O]);return m((()=>{if(S&&!y){const e=b(S);z(e)}}),[S,y]),i(l,(()=>{const{setData:e}=W.current;return W.current.setData=(t,a)=>{const r=b(t);e(r,a)},W.current})),t.createElement("div",{className:v(E,"comment-editor")},t.createElement(c,{className:v("editor-profile"),writerName:C,writerImg:U}),t.createElement("div",{className:v("editor-area")},t.createElement(d,Object.assign({className:v("editor",{filled:y.length}),plugin:[p,h,f,g],config:T({pasteToPlainText:{onMatchUrlReplace:V},autoUrlMatch:{onMatchUrl:e=>V({textUrls:[e]})},countTextLength:{hideUi:!0,onChangeTextLength:B}},w),name:I,initialValue:y,placeholder:D,maxLength:P,handleChange:q},R,{ref:W}))),t.createElement("div",{className:v("editor-tool")},t.createElement("em",{className:v("counter-current")},N(A)),"/",t.createElement("span",{className:v("counter-max")},N(P)),t.createElement(u,{size:"medium",className:v("btn-post"),disabled:M>A||!j(y)||_,onClick:F},L)))}));E.displayName="CommentEditor";var C=E;export{C as default};

"use client";
import e,{useRef as t,useCallback as r,useEffect as n}from"react";import{makeCxFunc as c}from"../../utils/forReactUtils.js";import o from"./Drawer.module.scss.js";const s=c(o);var l=c=>{let{className:o="",direction:l,disabled:i,children:a,breakRatioPoint:u,enableOverDrawer:h,onTouchMove:d,onClose:f}=c;const g=t(null),v=t({x:0,y:0,originTargetHeight:0,targetHeight:0}),y=t(null),m=t(!1),T=r((e=>{for(const t of e.children){const e=window.getComputedStyle(t);if(("auto"===e.overflow||"scroll"===e.overflow||"auto"===e.overflowX||"scroll"===e.overflowX||"auto"===e.overflowY||"scroll"===e.overflowY)&&(t.scrollTop>0||t.scrollLeft>0))return t;const r=T(t);if(r)return r}return null}),[]);r((e=>{const t=g.current.scrollTop,r=g.current.scrollHeight-g.current.clientHeight;t>0&&t<r&&e.stopPropagation()}),[]);const w=r((()=>{const e=y.current;e.style.transition="transform cubic-bezier(0.25, 0.1, 0.25, 1.0) 0.2s, height cubic-bezier(0.25, 0.1, 0.25, 1.0) 0.2s","top"===l?e.style.transform="translateY(100%)":"left"===l?e.style.transform="translateX(-100%)":"right"===l&&(e.style.transform="translateX(100%)"),setTimeout((()=>{e.style.visibility="hidden",f&&f()}),200)}),[l,f]),p=r((e=>{const t=y.current;g.current=T(t),t&&!i&&(t.style.transition="transform linear 0.2s, height linear 0.2s","top"===l?m.current=e.changedTouches[0].clientY-y.current.offsetTop<20:"left"===l?m.current=window.innerWidth-e.changedTouches[0].clientX<20:"right"===l&&(m.current=e.changedTouches[0].clientX<20),(!g.current||g.current.scrollTop<=0&&g.current.scrollLeft<=0||m.current)&&(v.current={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY,originTargetHeight:t.dataset.full?v.current.originTargetHeight:t.offsetHeight,targetHeight:t.offsetHeight}))}),[l,i,T]),Y=r((e=>{var t,r,n,c,o,s;const a=y.current,u=null!==(r=null===(t=g.current)||void 0===t?void 0:t.scrollHeight)&&void 0!==r?r:0,f=null!==(c=null===(n=g.current)||void 0===n?void 0:n.clientHeight)&&void 0!==c?c:0,T=null!==(s=null===(o=g.current)||void 0===o?void 0:o.scrollTop)&&void 0!==s?s:0;if("top"===l)if(h&&!a.dataset.full)m.current=v.current.y>e.changedTouches[0].clientY?u<=T+f:T<=0;else if(h&&a.dataset.full){if(m.current=v.current.y<e.changedTouches[0].clientY&&T<=0,v.current.y>e.changedTouches[0].clientY&&u<=T+f)return e.preventDefault()}else!h&&v.current.y<e.changedTouches[0].clientY?m.current=T<=0:!h&&v.current.y>e.changedTouches[0].clientY&&(m.current=!1);if(a&&m.current&&!g.current&&!i){if(d&&d({target:a,startPoint:v.current},e),"top"===l){const t=e.changedTouches[0].clientY<v.current.y&&!h?0:e.changedTouches[0].clientY-v.current.y;e.changedTouches[0].clientY<v.current.y&&h||a.dataset.full&&h?a.style.height="".concat(-1*t+v.current.targetHeight,"px"):a.style.transform="translateY(".concat(t,"px)")}else if("left"===l){const t=v.current.x-e.changedTouches[0].clientX<0?0:e.changedTouches[0].clientX-v.current.x;a.style.transform="translateX(".concat(t,"px)")}else if("right"===l){const t=window.innerWidth-e.changedTouches[0].clientX<0?0:e.changedTouches[0].clientX-v.current.x;a.style.transform="translateX(".concat(t,"px)")}m.current&&e.preventDefault()}}),[l,i,h,d]),X=r((e=>{if("BUTTON"===e.target.tagName)return;const t=y.current,r=window.visualViewport?window.visualViewport.height:window.innerHeight;t&&m.current&&!g.current&&!i&&("top"===l?h?t.dataset.full?(t.style.transition=" height 0.3s",t.style.height=e.changedTouches[0].clientY-v.current.y>r/6?"".concat(v.current.originTargetHeight,"px"):"100vh",t.style.transform="",t.dataset.full=e.changedTouches[0].clientY-v.current.y>r/6?"":"1"):!t.dataset.full&&v.current.y-e.changedTouches[0].clientY>r/6?(t.style.transition=" height 0.3s",t.style.height="100vh",t.style.transform="",t.dataset.full=v.current.y-e.changedTouches[0].clientY>r/6?"1":""):e.changedTouches[0].clientY-v.current.y>r/6&&!t.dataset.full?w():(t.style.transition="transform 0.3s",t.style.transform="translateY(0px)",t.style.height="",t.dataset.full=""):e.changedTouches[0].clientY-v.current.y>r/6?w():(t.style.transition="transform 0.3s",t.style.transform="translateY(0px)",t.style.height="",t.dataset.full=""):"left"===l?v.current.x-e.changedTouches[0].clientX>100?w():(t.style.transition="transform 0.3s",t.style.transform="translateX(0px)"):"right"===l&&(v.current.x-e.changedTouches[0].clientX>100?w():(t.style.transition="transform 0.3s",t.style.transform="translateX(100%)")),m.current&&e.preventDefault())}),[l,i,h,w]);return n((()=>{let e=0;const t=t=>{e=t.touches[0].clientX},r=t=>{(e<10||window.innerWidth-10<e)&&t.preventDefault()};return i||(window.addEventListener("touchstart",t,{passive:!1}),window.addEventListener("touchmove",r,{passive:!1})),()=>{window.removeEventListener("touchstart",t),window.removeEventListener("touchmove",r)}}),[i]),n((()=>{if(y.current&&y.current.children.length>1)throw Error("A Drawer component's children always receive a single element!");{const e=y.current;return g.current=T(e),i||(e.addEventListener("touchstart",p),e.addEventListener("touchmove",Y),e.addEventListener("touchend",X)),()=>{e.removeEventListener("touchstart",p),e.removeEventListener("touchmove",Y),e.removeEventListener("touchend",X)}}}),[i,X,Y,p,T]),e.createElement("div",{ref:y,className:s("drawer","".concat(o),"".concat(l),{disabled:i})},a)};export{l as default};

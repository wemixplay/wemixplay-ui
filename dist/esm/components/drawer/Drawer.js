import t,{useRef as e,useCallback as r,useEffect as n}from"react";import{makeCxFunc as c}from"../../utils/forReactUtils.js";import o from"./Drawer.module.scss.js";function i(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return a(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(t,e):void 0}}(t))||e){r&&(t=r);var n=0,c=function(){};return{s:c,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:c}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){l=!0,o=t},f:function(){try{i||null==r.return||r.return()}finally{if(l)throw o}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var l=c(o),s=function(c){var o=c.className,a=void 0===o?"":o,s=c.direction,u=c.disabled,h=c.children,f=c.enableOverDrawer,d=c.onTouchMove,g=c.onClose,v=e(null),y=e({x:0,y:0,originTargetHeight:0,targetHeight:0}),m=e(null),p=e(!1),w=r((function(t){var e,r=i(t.children);try{for(r.s();!(e=r.n()).done;){var n=e.value,c=window.getComputedStyle(n);if("auto"===c.overflow||"scroll"===c.overflow||"auto"===c.overflowX||"scroll"===c.overflowX||"auto"===c.overflowY||"scroll"===c.overflowY){if(n.scrollTop>0||n.scrollLeft>0)return n;n}var o=w(n);if(o)return o}}catch(t){r.e(t)}finally{r.f()}return null}),[]);r((function(t){var e=v.current.scrollTop,r=v.current.scrollHeight-v.current.clientHeight;e>0&&e<r&&t.stopPropagation()}),[]);var T=r((function(){var t=m.current;t.style.transition="transform cubic-bezier(0.25, 0.1, 0.25, 1.0) 0.2s, height cubic-bezier(0.25, 0.1, 0.25, 1.0) 0.2s","top"===s?t.style.transform="translateY(100%)":"left"===s?t.style.transform="translateX(-100%)":"right"===s&&(t.style.transform="translateX(100%)"),setTimeout((function(){t.style.visibility="hidden",g&&g()}),200)}),[s,g]),Y=r((function(t){var e=m.current;v.current=w(e),e&&!u&&(e.style.transition="transform linear 0.2s, height linear 0.2s","top"===s?p.current=t.changedTouches[0].clientY-m.current.offsetTop<20:"left"===s?p.current=window.innerWidth-t.changedTouches[0].clientX<20:"right"===s&&(p.current=t.changedTouches[0].clientX<20),(!v.current||v.current.scrollTop<=0&&v.current.scrollLeft<=0||p.current)&&(y.current={x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY,originTargetHeight:e.dataset.full?y.current.originTargetHeight:e.offsetHeight,targetHeight:e.offsetHeight}))}),[s,u,w]),X=r((function(t){var e,r,n,c,o,i,a=m.current,l=null!==(r=null===(e=v.current)||void 0===e?void 0:e.scrollHeight)&&void 0!==r?r:0,h=null!==(c=null===(n=v.current)||void 0===n?void 0:n.clientHeight)&&void 0!==c?c:0,g=null!==(i=null===(o=v.current)||void 0===o?void 0:o.scrollTop)&&void 0!==i?i:0;if("top"===s)if(f&&!a.dataset.full)p.current=y.current.y>t.changedTouches[0].clientY?l<=g+h:g<=0;else if(f&&a.dataset.full){if(p.current=y.current.y<t.changedTouches[0].clientY&&g<=0,y.current.y>t.changedTouches[0].clientY&&l<=g+h)return t.preventDefault()}else!f&&y.current.y<t.changedTouches[0].clientY?p.current=g<=0:!f&&y.current.y>t.changedTouches[0].clientY&&(p.current=!1);if(a&&p.current&&!v.current&&!u){if(d&&d({target:a,startPoint:y.current},t),"top"===s){var w=t.changedTouches[0].clientY<y.current.y&&!f?0:t.changedTouches[0].clientY-y.current.y;t.changedTouches[0].clientY<y.current.y&&f||a.dataset.full&&f?a.style.height="".concat(-1*w+y.current.targetHeight,"px"):a.style.transform="translateY(".concat(w,"px)")}else if("left"===s){var T=y.current.x-t.changedTouches[0].clientX<0?0:t.changedTouches[0].clientX-y.current.x;a.style.transform="translateX(".concat(T,"px)")}else if("right"===s){var Y=window.innerWidth-t.changedTouches[0].clientX<0?0:t.changedTouches[0].clientX-y.current.x;a.style.transform="translateX(".concat(Y,"px)")}p.current&&t.preventDefault()}}),[s,u,f,d]),x=r((function(t){if("BUTTON"!==t.target.tagName){var e=m.current,r=window.visualViewport?window.visualViewport.height:window.innerHeight;e&&p.current&&!v.current&&!u&&("top"===s?f?e.dataset.full?(e.style.transition=" height 0.3s",e.style.height=t.changedTouches[0].clientY-y.current.y>r/6?"".concat(y.current.originTargetHeight,"px"):"100vh",e.style.transform="",e.dataset.full=t.changedTouches[0].clientY-y.current.y>r/6?"":"1"):!e.dataset.full&&y.current.y-t.changedTouches[0].clientY>r/6?(e.style.transition=" height 0.3s",e.style.height="100vh",e.style.transform="",e.dataset.full=y.current.y-t.changedTouches[0].clientY>r/6?"1":""):t.changedTouches[0].clientY-y.current.y>r/6&&!e.dataset.full?T():(e.style.transition="transform 0.3s",e.style.transform="translateY(0px)",e.style.height="",e.dataset.full=""):t.changedTouches[0].clientY-y.current.y>r/6?T():(e.style.transition="transform 0.3s",e.style.transform="translateY(0px)",e.style.height="",e.dataset.full=""):"left"===s?y.current.x-t.changedTouches[0].clientX>100?T():(e.style.transition="transform 0.3s",e.style.transform="translateX(0px)"):"right"===s&&(y.current.x-t.changedTouches[0].clientX>100?T():(e.style.transition="transform 0.3s",e.style.transform="translateX(100%)")),p.current&&t.preventDefault())}}),[s,u,f,T]);return n((function(){var t=0,e=function(e){t=e.touches[0].clientX},r=function(e){(t<10||window.innerWidth-10<t)&&e.preventDefault()};return u||(window.addEventListener("touchstart",e,{passive:!1}),window.addEventListener("touchmove",r,{passive:!1})),function(){window.removeEventListener("touchstart",e),window.removeEventListener("touchmove",r)}}),[u]),n((function(){if(m.current&&m.current.children.length>1)throw Error("A Drawer component's children always receive a single element!");var t=m.current;return v.current=w(t),u||(t.addEventListener("touchstart",Y),t.addEventListener("touchmove",X),t.addEventListener("touchend",x)),function(){t.removeEventListener("touchstart",Y),t.removeEventListener("touchmove",X),t.removeEventListener("touchend",x)}}),[u,x,X,Y,w]),t.createElement("div",{ref:m,className:l("drawer","".concat(a),"".concat(s),{disabled:u})},h)};export{s as default};

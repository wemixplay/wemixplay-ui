import e from"@babel/runtime/helpers/slicedToArray";import t from"@babel/runtime/helpers/toConsumableArray";import i,{useRef as n,useState as r,useMemo as o,useCallback as s,useLayoutEffect as l}from"react";import c from"./Ellipsis.module.scss.js";import{makeCxFunc as a}from"../../utils/forReactUtils.js";import u from"../../assets/svgs/ico-ellipsis-chevron.svg.js";"undefined"==typeof window&&(i.useLayoutEffect=i.useEffect);var m=a(c),h=function(c){var a=c.className,h=c.content,g=void 0===h?"":h,f=c.triggerMore,p=void 0===f?"more":f,v=c.triggerLess,d=void 0===v?"less":v,H=c.lineClamp,b=void 0===H?2:H,y=c.defaultShortened,E=void 0!==y&&y,C=c.observingEnvs,x=void 0===C?[]:C,w=c.onShowMoreLessClick,L=n(null),N=n(!1),k=n(t(x)),j=r(E),M=e(j,2),S=M[0],A=M[1],T=r(!0),W=e(T,2),_=W[0],I=W[1],P=o((function(){var e,t,n=S?{lineClamp:b,WebkitLineClamp:b,height:null===(e=L.current)||void 0===e?void 0:e.style.minHeight}:{lineClamp:"unset",WebkitLineClamp:"unset",height:null===(t=L.current)||void 0===t?void 0:t.style.maxHeight};return"string"==typeof g?i.createElement("div",{ref:L,className:m("ellipsis-content"),style:n,dangerouslySetInnerHTML:{__html:g}}):i.createElement("div",{ref:L,className:m("ellipsis-content"),style:n},g)}),[g,b,S]),R=s((function(e){var t=L.current;if(t){var i=t.style;if(e){var n=e.openHeight,r=e.closeHeight;i.maxHeight="".concat(n,"px"),i.minHeight="".concat(r,"px"),i.height="".concat(r,"px")}else i.maxHeight="",i.minHeight="",i.height=""}}),[]),U=s((function(){R(null),A(!0),N.current=!0}),[R]),q=s((function(e){var t=e.openHeight,i=e.closeHeight;R({openHeight:t,closeHeight:i}),I(i+10<t),A(E),N.current=!1}),[E,R]),z=s((function(e){e.stopPropagation(),A((function(e){return!e}))}),[]);return l((function(){L.current&&U()}),[U]),l((function(){L.current&&(!!x.length&&x.some((function(e,t){return e!==k.current[t]}))&&(k.current=t(x),U()))}),[x,U,q]),l((function(){var e=L.current;S&&N.current&&e&&q({openHeight:e.scrollHeight,closeHeight:e.offsetHeight})}),[S,g,x,q]),i.createElement("div",{className:m("ellipsis-wrap",a,{shortened:S,"enable-show-more":w})},P,_&&i.createElement("button",{onClick:w||z,className:m("btn-ellipsis-trigger")},S?p:d,i.createElement(u,{width:14,height:14})))};export{h as default};

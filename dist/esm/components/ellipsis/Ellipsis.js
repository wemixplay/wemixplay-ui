"use client";
import e,{useRef as t,useState as n,useMemo as s,useCallback as i,useLayoutEffect as r}from"react";import o from"./Ellipsis.module.scss.js";import{makeCxFunc as l}from"../../utils/forReactUtils.js";import c from"../../assets/svgs/icon-chevron-down.svg.js";"undefined"==typeof window&&(e.useLayoutEffect=e.useEffect);const a=l(o);var g=o=>{let{className:l,content:g="",triggerMore:h="more",triggerLess:m="less",lineClamp:u=2,defaultShortened:p=!1,observingEnvs:f=[],onShowMoreLessClick:d}=o;const H=t(null),v=t(!1),y=t([...f]),[E,w]=n(p),[x,C]=n(!0),b=s((()=>{var t,n;const s=E?{lineClamp:u,WebkitLineClamp:u,height:null===(t=H.current)||void 0===t?void 0:t.style.minHeight}:{lineClamp:"unset",WebkitLineClamp:"unset",height:null===(n=H.current)||void 0===n?void 0:n.style.maxHeight};return"string"==typeof g?e.createElement("div",{ref:H,className:a("ellipsis-content"),style:s,dangerouslySetInnerHTML:{__html:g}}):e.createElement("div",{ref:H,className:a("ellipsis-content"),style:s},g)}),[g,u,E]),L=i((e=>{const{current:t}=H;if(t){const{style:n}=t;if(e){const{openHeight:t,closeHeight:s}=e;n.maxHeight="".concat(t,"px"),n.minHeight="".concat(s,"px"),n.height="".concat(s,"px")}else n.maxHeight="",n.minHeight="",n.height=""}}),[]),N=i((()=>{L(null),w(!0),v.current=!0}),[L]),k=i((e=>{let{openHeight:t,closeHeight:n}=e;L({openHeight:t,closeHeight:n}),C(n+10<t),w(p),v.current=!1}),[p,L]),j=i((e=>{e.stopPropagation(),w((e=>!e))}),[]);return r((()=>{const{current:e}=H;e&&N()}),[N]),r((()=>{const{current:e}=H;if(e){!!f.length&&f.some(((e,t)=>e!==y.current[t]))&&(y.current=[...f],N())}}),[f,N,k]),r((()=>{const{current:e}=H;E&&v.current&&e&&k({openHeight:e.scrollHeight,closeHeight:e.offsetHeight})}),[E,g,f,k]),e.createElement("div",{className:a("ellipsis-wrap",l,{shortened:E,"enable-show-more":d})},b,x&&e.createElement("button",{onClick:d||j,className:a("btn-ellipsis-trigger")},E?h:m,e.createElement(c,{width:14,height:14})))};export{g as default};

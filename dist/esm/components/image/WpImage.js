import r from"@babel/runtime/helpers/slicedToArray";import e,{memo as t,useRef as n,useState as a,useCallback as o,useMemo as i,useLayoutEffect as s}from"react";import c from"./ImageIntersectionObserver.js";import u from"./WpImage.module.scss.js";import{makeCxFunc as l}from"../../utils/forReactUtils.js";"undefined"==typeof window&&(e.useLayoutEffect=e.useEffect);var m=l(u),d=t((function(t){var u=t.className,l=void 0===u?"":u,d=t.src,f=void 0===d?"":d,g=t.errorSrc,v=void 0===g?"":g,p=t.alt,y=void 0===p?"":p,b=t.isBackground,h=void 0!==b&&b,w=t.isLazy,I=void 0===w||w,E=t.blur,D=void 0!==E&&E,N=t.width,W=t.height,j=t.transitionDuration,k=t.transitionDelay,L=t.onImageLoad,O=n(null),z=n(null),q=a(I?"waiting":"loaded"),x=r(q,2),A=x[0],B=x[1],R=o((function(r){return B(r)}),[]),S=o((function(r,e){r.src=e,h?z.current.style.backgroundImage="url(".concat(e,")"):O.current.src=e}),[h]),T=o((function(r){var e=r.target,t=e.src;t.endsWith(f)?(R("loaded"),null==L||L()):t.endsWith(v)&&R("error-loaded"),e.remove()}),[v,f,R,L]),U=o((function(r){if("string"!=typeof r){var e=r.target,t=e.src;v&&!t.endsWith(v)?S(e,v):(B("error"),e.remove())}}),[v,S]),C=o((function(){var r=new Image;S(r,f),r.onload=T,r.onerror=U,r.onabort=U}),[S,f,T,U]),F=i((function(){return{transitionDuration:"".concat(j,"ms"),transitionDelay:"".concat(k,"ms")}}),[j,k]);return s((function(){var r=h?z.current:O.current;return I?c.startObserving(r,C):C(),function(){c.quitOberving(r)}}),[f,v,I,h,R,C]),e.createElement("span",{className:m(l,"lazy-img-wrapper",A,{blur:D}),style:{width:N,height:W}},h?e.createElement("span",{ref:z,className:m("target-background"),style:F}):e.createElement("img",{ref:O,className:m("target-image"),alt:y,style:F}))}));export{d as default};

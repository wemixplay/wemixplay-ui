import e from"@babel/runtime/helpers/typeof";import r from"@babel/runtime/helpers/slicedToArray";import n from"@babel/runtime/helpers/toConsumableArray";import o from"@babel/runtime/regenerator";import{__awaiter as t}from"../../_virtual/_tslib.js";import l,{useState as a,useMemo as i,Children as s,isValidElement as d,Fragment as c}from"react";import{orderBy as u}from"lodash-es";import{makeCxFunc as p}from"../../utils/forReactUtils.js";import m from"../loadings/Spinner.js";import v from"../../assets/svgs/ico-sort-down-element.svg.js";import f from"../../assets/svgs/ico-sort-normal-element.svg.js";import b from"../../assets/svgs/ico-sort-up-element.svg.js";import h from"../noData/NoDataIconText.js";import g from"./Table.module.scss.js";import E from"./TdColumn.js";import S from"../error/ErrorBoundary.js";var j=p(g),N=function(e){var r=[];return s.forEach(e,(function(e){d(e)&&(e.type===c?r=[].concat(n(r),n(N(e.props.children))):e.type===E?r.push(e):r=[].concat(n(r),n(N(e.props.children))))})),r},x=function(n){var c=n.className,p=void 0===c?"":c,g=n.list,x=n.children,k=n.loadingElement,w=void 0===k?l.createElement(m,null):k,I=n.errorFallback,y=n.noDataMsg,C=n.hideThead,O=n.sortUpElement,T=void 0===O?l.createElement(b,null):O,D=n.sortDownElement,R=void 0===D?l.createElement(v,null):D,V=n.sortNormalElement,z=void 0===V?l.createElement(f,null):V,A=n.loading,U=a(!1),_=r(U,2),B=_[0],F=_[1],M=a(null),q=r(M,2),G=q[0],H=q[1],J=i((function(){var e=(g||[]).length>0?null==g?void 0:g[0]:{};return N(x({item:e,index:0}))}),[x,g]),K=i((function(){var e=null==J?void 0:J.map((function(e){var r,n,o,t,l,a,i,s,d,c,u,p,m,v,f,b=e;return{className:null!==(n=null===(r=b.props)||void 0===r?void 0:r.className)&&void 0!==n?n:"",label:null!==(t=null===(o=b.props)||void 0===o?void 0:o.label)&&void 0!==t?t:"",fieldId:null===(l=b.props)||void 0===l?void 0:l.fieldId,enableSorting:void 0!==(null===(a=b.props)||void 0===a?void 0:a.sortValue)||!!(null===(i=b.props)||void 0===i?void 0:i.handleClickSort),handleClickSort:null===(s=b.props)||void 0===s?void 0:s.handleClickSort,thColSpan:null===(d=b.props)||void 0===d?void 0:d.thColSpan,thRowSpan:null===(c=b.props)||void 0===c?void 0:c.thRowSpan,rowSpan:null===(u=b.props)||void 0===u?void 0:u.rowSpan,colSpan:null===(p=b.props)||void 0===p?void 0:p.colSpan,size:null===(m=b.props)||void 0===m?void 0:m.size,order:null!==(f=null===(v=b.props)||void 0===v?void 0:v.order)&&void 0!==f?f:""}}));return e?e.filter((function(e){return void 0!==e.label})).map((function(e){return(null==G?void 0:G.fieldId)?Object.assign(Object.assign({},e),{order:(null==G?void 0:G.fieldId)===e.fieldId?null==G?void 0:G.order:""}):e})):[]}),[J,G]),L=i((function(){var e=null!=G?G:{},r=e.fieldId,n=e.order;if(!n)return g;var o=g.map((function(e,r){return s.map(x({item:e,index:r}),(function(e){return d(e)?e.type===E?e:s.toArray(e.props.children):[]}))})).reduce((function(e,n){var o,t,l=n.find((function(e){return e.props.fieldId===r}));return e.push(null!==(t=null===(o=l.props)||void 0===o?void 0:o.sortValue)&&void 0!==t?t:0),e}),[]);return u(g.map((function(e,r){return Object.assign(Object.assign({},e),{sortValue:o[r]})})),["sortValue"],[n])}),[g,G,x]);return l.createElement(S,{fallback:I},l.createElement("div",{className:j("table",p,{"no-data":!!g&&0===g.length,loading:!g||B||A})},l.createElement("table",null,!C&&l.createElement("thead",null,l.createElement("tr",null,K.map((function(e,r){var n,a,i;return l.createElement("th",{key:"th-".concat(null!==(n=e.fieldId)&&void 0!==n?n:r),className:j(e.fieldId,e.className,{"enable-sorting":e.enableSorting}),rowSpan:null!==(a=e.thRowSpan)&&void 0!==a?a:e.rowSpan,colSpan:null!==(i=e.thColSpan)&&void 0!==i?i:e.colSpan,style:{width:e.size},onClick:function(){return function(e){return t(void 0,void 0,void 0,o.mark((function r(){var n,t,l,a,i,s,d;return o.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n="desc",t=e.order,l=e.index,a=e.fieldId,i=e.enableSorting,s=e.handleClickSort,i&&!B){r.next=4;break}return r.abrupt("return");case 4:if("desc"===t?n="asc":"asc"===t&&(n=""),H(d={index:l,order:n,fieldId:a}),!s){r.next=15;break}return r.prev=8,F(!0),r.next=12,s(d);case 12:return r.prev=12,F(!1),r.finish(12);case 15:case"end":return r.stop()}}),r,null,[[8,,12,15]])})))}(Object.assign(Object.assign({},e),{index:r}))}},l.createElement("div",{className:j("th-block")},e.label,!!e.enableSorting&&l.createElement("span",{className:j("ico-sorting")},"desc"!==e.order&&"asc"!==e.order&&z,"desc"===e.order&&R,"asc"===e.order&&T)))})))),l.createElement("tbody",null,(!g||B||A)&&l.createElement("tr",{className:j("loading-tr")},l.createElement("td",{colSpan:K.length},l.createElement("div",{className:j("table-loading")},w))),!!g&&!A&&!B&&(g.length>0?L.map((function(e,r){return x({item:e,index:r})})):l.createElement("tr",{className:j("no-data-tr")},l.createElement("td",{colSpan:K.length},"object"===e(y)?y:l.createElement(h,{className:j("table-no-data"),nullText:y}))))))))};export{x as default};

"use client";
import{__awaiter as e}from"../../_virtual/_tslib.js";import l,{useState as o,useMemo as t,Children as r,isValidElement as n,Fragment as a}from"react";import s from'./../../ext/lodash/orderBy.js';import{makeCxFunc as i}from"../../utils/forReactUtils.js";import d from"../loadings/Spinner.js";import c from"../../assets/svgs/ico-sort-down-element.svg.js";import p from"../../assets/svgs/ico-sort-normal-element.svg.js";import m from"../../assets/svgs/ico-sort-up-element.svg.js";import u from"../noData/NoDataIconText.js";import v from"./Table.module.scss.js";import f from"./TdColumn.js";import g from"../error/ErrorBoundary.js";const h=i(v),b=e=>{let l=[];return r.forEach(e,(e=>{n(e)&&(e.type===a?l=[...l,...b(e.props.children)]:e.type===f?l.push(e):l=[...l,...b(e.props.children)])})),l};var E=a=>{let{className:i="",list:v,children:E,loadingElement:S=l.createElement(d,null),errorFallback:j,noDataMsg:N,hideThead:y,sortUpElement:I=l.createElement(m,null),sortDownElement:w=l.createElement(c,null),sortNormalElement:k=l.createElement(p,null),loading:x}=a;const[C,O]=o(!1),[T,D]=o(null),R=t((()=>{const e=(v||[]).length>0?null==v?void 0:v[0]:{};return b(E({item:e,index:0}))}),[E,v]),V=t((()=>{const e=null==R?void 0:R.map((e=>{var l,o,t,r,n,a,s,i,d,c,p,m,u,v,f;const g=e;return{className:null!==(o=null===(l=g.props)||void 0===l?void 0:l.className)&&void 0!==o?o:"",label:null!==(r=null===(t=g.props)||void 0===t?void 0:t.label)&&void 0!==r?r:"",fieldId:null===(n=g.props)||void 0===n?void 0:n.fieldId,enableSorting:void 0!==(null===(a=g.props)||void 0===a?void 0:a.sortValue)||!!(null===(s=g.props)||void 0===s?void 0:s.handleClickSort),handleClickSort:null===(i=g.props)||void 0===i?void 0:i.handleClickSort,thColSpan:null===(d=g.props)||void 0===d?void 0:d.thColSpan,thRowSpan:null===(c=g.props)||void 0===c?void 0:c.thRowSpan,rowSpan:null===(p=g.props)||void 0===p?void 0:p.rowSpan,colSpan:null===(m=g.props)||void 0===m?void 0:m.colSpan,size:null===(u=g.props)||void 0===u?void 0:u.size,order:null!==(f=null===(v=g.props)||void 0===v?void 0:v.order)&&void 0!==f?f:""}}));return e?e.filter((e=>void 0!==e.label)).map((e=>(null==T?void 0:T.fieldId)?Object.assign(Object.assign({},e),{order:(null==T?void 0:T.fieldId)===e.fieldId?null==T?void 0:T.order:""}):e)):[]}),[R,T]),z=t((()=>{const{fieldId:e,order:l}=null!=T?T:{};if(!l)return v;const o=v.map(((e,l)=>r.map(E({item:e,index:l}),(e=>n(e)?e.type===f?e:r.toArray(e.props.children):[])))).reduce(((l,o)=>{var t,r;const n=o.find((l=>l.props.fieldId===e));return l.push(null!==(r=null===(t=n.props)||void 0===t?void 0:t.sortValue)&&void 0!==r?r:0),l}),[]);return s(v.map(((e,l)=>Object.assign(Object.assign({},e),{sortValue:o[l]}))),["sortValue"],[l])}),[v,T,E]);return l.createElement(g,{fallback:j},l.createElement("div",{className:h("table",i,{"no-data":!!v&&0===v.length,loading:!v||C||x})},l.createElement("table",null,!y&&l.createElement("thead",null,l.createElement("tr",null,V.map(((o,t)=>{var r,n,a;return l.createElement("th",{key:"th-".concat(null!==(r=o.fieldId)&&void 0!==r?r:t),className:h(o.fieldId,o.className,{"enable-sorting":o.enableSorting}),rowSpan:null!==(n=o.thRowSpan)&&void 0!==n?n:o.rowSpan,colSpan:null!==(a=o.thColSpan)&&void 0!==a?a:o.colSpan,style:{width:o.size},onClick:()=>(l=>e(void 0,void 0,void 0,(function*(){let e="desc";const{order:o,index:t,fieldId:r,enableSorting:n,handleClickSort:a}=l;if(!n||C)return;"desc"===o?e="asc":"asc"===o&&(e="");const s={index:t,order:e,fieldId:r};if(D(s),a)try{O(!0),yield a(s)}finally{O(!1)}})))(Object.assign(Object.assign({},o),{index:t}))},l.createElement("div",{className:h("th-block")},o.label,!!o.enableSorting&&l.createElement("span",{className:h("ico-sorting")},"desc"!==o.order&&"asc"!==o.order&&k,"desc"===o.order&&w,"asc"===o.order&&I)))})))),l.createElement("tbody",null,(!v||C||x)&&l.createElement("tr",{className:h("loading-tr")},l.createElement("td",{colSpan:V.length},l.createElement("div",{className:h("table-loading")},S))),!!v&&!x&&!C&&(v.length>0?z.map(((e,l)=>E({item:e,index:l}))):l.createElement("tr",{className:h("no-data-tr")},l.createElement("td",{colSpan:V.length},"object"==typeof N?N:l.createElement(u,{className:h("table-no-data"),nullText:N}))))))))};export{E as default};

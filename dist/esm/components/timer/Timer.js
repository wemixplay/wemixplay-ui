import e from"@babel/runtime/helpers/slicedToArray";import r,{useState as t,useRef as n,useMemo as s,useCallback as a,useEffect as u}from"react";import{makeCxFunc as o}from"../../utils/forReactUtils.js";import{pad as c}from"../../utils/valueParserUtils.js";import i from"./Timer.module.scss.js";var l=o(i),m=1e3,f=function(e){var r=e/m,t=Math.floor(r/86400),n=Math.floor(r%86400/3600),s=Math.floor(r%3600/60),a=Math.ceil(r%60);return{days:t,hours:n,minutes:s,seconds:60===a?59:a,restMs:e%m}},d=function(e){if("number"==typeof e)return e;var r=e.days,t=void 0===r?0:r,n=e.hours,s=void 0===n?0:n,a=e.minutes,u=void 0===a?0:a,o=e.seconds;return 86400*t+3600*s*m+60*u*m+(void 0===o?0:o)*m},p=function(o){var i=o.className,p=void 0===i?"":i,E=o.duration,h=o.saperator,v=o.suffix,w=o.useButtons,y=void 0===w||w,N=o.pausedElement,b=void 0===N?"pause":N,M=o.resumedElement,C=void 0===M?"resume":M,x=o.refreshElement,D=void 0===x?"refresh":x,g=o.defaultPaused,j=void 0!==g&&g,F=o.showAllUnits,H=void 0!==F&&F,T=o.onEnd,U=t(j),k=e(U,2),A=k[0],I=k[1],P=t(0===E),B=e(P,2),L=B[0],R=B[1],q=t(d(E)),z=e(q,2),G=z[0],J=z[1],K=n(G),O=n(null),Q=n(null),S=n(null),V=n(null),W=n(null),X=n(0),Y=n(!1),Z=s((function(){var e=f(G);return{showDaysCount:e.days>0,showHoursCount:e.hours>0,showMinutesCount:e.minutes>0}}),[G]),$=Z.showDaysCount,_=Z.showHoursCount,ee=Z.showMinutesCount,re=a((function(e){return c(e,"0",2)}),[]),te=a((function(e,r){e&&(e.innerHTML=re(r))}),[re]),ne=a((function(){var e=f(K.current),r=e.hours,t=e.minutes,n=e.seconds;te(S.current,r),te(Q.current,t),te(O.current,n)}),[te]),se=a((function(){clearInterval(W.current),W.current=null}),[]),ae=a((function(e,r){se(),X.current=Date.now(),W.current=setInterval((function(){return e(r)}),r)}),[se]),ue=a((function(e){var r=f(K.current),t=K.current-e,n=f(t);n.days!==r.days&&te(V.current,n.days),n.hours!==r.hours&&te(S.current,n.hours),n.minutes!==r.minutes&&te(Q.current,n.minutes),te(O.current,n.seconds),K.current=t,K.current<=0?(se(),R(!0)):e!==m&&(se(),ae(ue,m))}),[se,ae,te]),oe=a((function(){var e=f(K.current).restMs;ae(ue,e||m)}),[ae,ue]),ce=a((function(){if(!A){var e=Date.now()-X.current,r=f(e).restMs;K.current-=r}I(!A)}),[A]),ie=a((function(){A?se():K.current>0&&oe()}),[A,oe,se]),le=a((function(e){K.current=e}),[]),me=a((function(e){le(e),R(0===e),Y.current=!1,ne(),ie()}),[ie,le,ne]);u((function(){if("number"!=typeof E){var e=E.seconds,r=E.minutes,t=E.hours;if("number"==typeof e&&e>=60)throw new Error("duration prop에서 seconds의 값(".concat(e,")은 59 보다 클 수 없으며 이를 초과하는 나머지 값은 분 단위에 더하여 설정해야 합니다!"));if("number"==typeof r&&r>=60)throw new Error("duration prop에서 minutes의 값(".concat(r,")은 59 보다 클 수 없으며 이를 초과하는 나머지 값은 시간 단위에 더하여 설정해야 합니다!"));if("number"==typeof t&&t>=24)throw new Error("duration prop에서 hours의 값(".concat(t,")은 23 보다 클 수 없으며 이를 초과하는 나머지 값은 일 단위에 더하여 설정해야 합니다!"))}else if(E<0)throw new Error("duration은 0보다 작을 수 없습니다!");var n=d(E);n!==G&&(se(),J(n),me(n))}),[E,G,me,se]),u((function(){ie()}),[ie]),u((function(){L&&!Y.current&&(Y.current=!0,null==T||T())}),[L,T]);var fe=f(K.current),de=fe.days,pe=fe.hours,Ee=fe.minutes,he=fe.seconds;return r.createElement("span",{className:l("timer-wrapper",p)},y&&r.createElement("span",{className:l("timer-button-container")},r.createElement("button",{onClick:ce,className:l("timer-button")},A?C:b),r.createElement("button",{className:l("timer-button"),onClick:function(){return me(G)}},D)),r.createElement("span",{className:l("timer-counter-container")},(H||$)&&r.createElement(r.Fragment,null,r.createElement("span",{className:l("timer-counter")},r.createElement("span",{ref:V},re(de)),(null==v?void 0:v.days)&&r.createElement("span",{className:l("timer-suffix")},v.days)),h&&r.createElement("span",{className:l("timer-separator")},h)),(H||$||_)&&r.createElement(r.Fragment,null,r.createElement("span",{className:l("timer-counter")},r.createElement("span",{ref:S},re(pe)),(null==v?void 0:v.hours)&&r.createElement("span",{className:l("timer-suffix")},v.hours)),h&&r.createElement("span",{className:l("timer-separator")},h)),(H||$||_||ee)&&r.createElement(r.Fragment,null,r.createElement("span",{className:l("timer-counter")},r.createElement("span",{ref:Q},re(Ee)),(null==v?void 0:v.minutes)&&r.createElement("span",{className:l("timer-suffix")},v.minutes)),h&&r.createElement("span",{className:l("timer-separator")},h)),r.createElement("span",{className:l("timer-counter")},r.createElement("span",{ref:O},re(he)),(null==v?void 0:v.seconds)&&r.createElement("span",{className:l("timer-suffix")},v.seconds))))};export{p as default};

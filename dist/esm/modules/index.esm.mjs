import t from"path";import e from"constants";import n from"stream";import r from"assert";import i from"fs";import o from"util";function c(t,e,n,r){return new(n||(n=Promise))((function(i,o){function c(t){try{s(r.next(t))}catch(t){o(t)}}function a(t){try{s(r.throw(t))}catch(t){o(t)}}function s(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,a)}s((r=r.apply(t,e||[])).next())}))}var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function s(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var u={},f={fromCallback:function(t){return Object.defineProperty((function(...e){if("function"!=typeof e[e.length-1])return new Promise(((n,r)=>{e.push(((t,e)=>null!=t?r(t):n(e))),t.apply(this,e)}));t.apply(this,e)}),"name",{value:t.name})},fromPromise:function(t){return Object.defineProperty((function(...e){const n=e[e.length-1];if("function"!=typeof n)return t.apply(this,e);e.pop(),t.apply(this,e).then((t=>n(null,t)),n)}),"name",{value:t.name})}},l=e,y=process.cwd,d=null,p=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return d||(d=y.call(process)),d};try{process.cwd()}catch(t){}if("function"==typeof process.chdir){var h=process.chdir;process.chdir=function(t){d=null,h.call(process,t)},Object.setPrototypeOf&&Object.setPrototypeOf(process.chdir,h)}var m=function(t){l.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&function(t){t.lchmod=function(e,n,r){t.open(e,l.O_WRONLY|l.O_SYMLINK,n,(function(e,i){e?r&&r(e):t.fchmod(i,n,(function(e){t.close(i,(function(t){r&&r(e||t)}))}))}))},t.lchmodSync=function(e,n){var r,i=t.openSync(e,l.O_WRONLY|l.O_SYMLINK,n),o=!0;try{r=t.fchmodSync(i,n),o=!1}finally{if(o)try{t.closeSync(i)}catch(t){}else t.closeSync(i)}return r}}(t);t.lutimes||function(t){l.hasOwnProperty("O_SYMLINK")&&t.futimes?(t.lutimes=function(e,n,r,i){t.open(e,l.O_SYMLINK,(function(e,o){e?i&&i(e):t.futimes(o,n,r,(function(e){t.close(o,(function(t){i&&i(e||t)}))}))}))},t.lutimesSync=function(e,n,r){var i,o=t.openSync(e,l.O_SYMLINK),c=!0;try{i=t.futimesSync(o,n,r),c=!1}finally{if(c)try{t.closeSync(o)}catch(t){}else t.closeSync(o)}return i}):t.futimes&&(t.lutimes=function(t,e,n,r){r&&process.nextTick(r)},t.lutimesSync=function(){})}(t);t.chown=r(t.chown),t.fchown=r(t.fchown),t.lchown=r(t.lchown),t.chmod=e(t.chmod),t.fchmod=e(t.fchmod),t.lchmod=e(t.lchmod),t.chownSync=i(t.chownSync),t.fchownSync=i(t.fchownSync),t.lchownSync=i(t.lchownSync),t.chmodSync=n(t.chmodSync),t.fchmodSync=n(t.fchmodSync),t.lchmodSync=n(t.lchmodSync),t.stat=o(t.stat),t.fstat=o(t.fstat),t.lstat=o(t.lstat),t.statSync=c(t.statSync),t.fstatSync=c(t.fstatSync),t.lstatSync=c(t.lstatSync),t.chmod&&!t.lchmod&&(t.lchmod=function(t,e,n){n&&process.nextTick(n)},t.lchmodSync=function(){});t.chown&&!t.lchown&&(t.lchown=function(t,e,n,r){r&&process.nextTick(r)},t.lchownSync=function(){});"win32"===p&&(t.rename="function"!=typeof t.rename?t.rename:function(e){function n(n,r,i){var o=Date.now(),c=0;e(n,r,(function a(s){if(s&&("EACCES"===s.code||"EPERM"===s.code||"EBUSY"===s.code)&&Date.now()-o<6e4)return setTimeout((function(){t.stat(r,(function(t,o){t&&"ENOENT"===t.code?e(n,r,a):i(s)}))}),c),void(c<100&&(c+=10));i&&i(s)}))}return Object.setPrototypeOf&&Object.setPrototypeOf(n,e),n}(t.rename));function e(e){return e?function(n,r,i){return e.call(t,n,r,(function(t){a(t)&&(t=null),i&&i.apply(this,arguments)}))}:e}function n(e){return e?function(n,r){try{return e.call(t,n,r)}catch(t){if(!a(t))throw t}}:e}function r(e){return e?function(n,r,i,o){return e.call(t,n,r,i,(function(t){a(t)&&(t=null),o&&o.apply(this,arguments)}))}:e}function i(e){return e?function(n,r,i){try{return e.call(t,n,r,i)}catch(t){if(!a(t))throw t}}:e}function o(e){return e?function(n,r,i){function o(t,e){e&&(e.uid<0&&(e.uid+=4294967296),e.gid<0&&(e.gid+=4294967296)),i&&i.apply(this,arguments)}return"function"==typeof r&&(i=r,r=null),r?e.call(t,n,r,o):e.call(t,n,o)}:e}function c(e){return e?function(n,r){var i=r?e.call(t,n,r):e.call(t,n);return i&&(i.uid<0&&(i.uid+=4294967296),i.gid<0&&(i.gid+=4294967296)),i}:e}function a(t){return!t||("ENOSYS"===t.code||!(process.getuid&&0===process.getuid()||"EINVAL"!==t.code&&"EPERM"!==t.code))}t.read="function"!=typeof t.read?t.read:function(e){function n(n,r,i,o,c,a){var s;if(a&&"function"==typeof a){var u=0;s=function(f,l,y){if(f&&"EAGAIN"===f.code&&u<10)return u++,e.call(t,n,r,i,o,c,s);a.apply(this,arguments)}}return e.call(t,n,r,i,o,c,s)}return Object.setPrototypeOf&&Object.setPrototypeOf(n,e),n}(t.read),t.readSync="function"!=typeof t.readSync?t.readSync:(s=t.readSync,function(e,n,r,i,o){for(var c=0;;)try{return s.call(t,e,n,r,i,o)}catch(t){if("EAGAIN"===t.code&&c<10){c++;continue}throw t}});var s};var v=n.Stream,w=function(t){return{ReadStream:function e(n,r){if(!(this instanceof e))return new e(n,r);v.call(this);var i=this;this.path=n,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=65536,r=r||{};for(var o=Object.keys(r),c=0,a=o.length;c<a;c++){var s=o[c];this[s]=r[s]}this.encoding&&this.setEncoding(this.encoding);if(void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(void 0===this.end)this.end=1/0;else if("number"!=typeof this.end)throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(null!==this.fd)return void process.nextTick((function(){i._read()}));t.open(this.path,this.flags,this.mode,(function(t,e){if(t)return i.emit("error",t),void(i.readable=!1);i.fd=e,i.emit("open",e),i._read()}))},WriteStream:function e(n,r){if(!(this instanceof e))return new e(n,r);v.call(this),this.path=n,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,r=r||{};for(var i=Object.keys(r),o=0,c=i.length;o<c;o++){var a=i[o];this[a]=r[a]}if(void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],null===this.fd&&(this._open=t.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}};var S=function(t){if(null===t||"object"!=typeof t)return t;if(t instanceof Object)var e={__proto__:g(t)};else e=Object.create(null);return Object.getOwnPropertyNames(t).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e},g=Object.getPrototypeOf||function(t){return t.__proto__};var b,E,k=i,O=m,x=w,F=S,D=o;function P(t,e){Object.defineProperty(t,b,{get:function(){return e}})}"function"==typeof Symbol&&"function"==typeof Symbol.for?(b=Symbol.for("graceful-fs.queue"),E=Symbol.for("graceful-fs.previous")):(b="___graceful-fs.queue",E="___graceful-fs.previous");var N=function(){};if(D.debuglog?N=D.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(N=function(){var t=D.format.apply(D,arguments);t="GFS4: "+t.split(/\n/).join("\nGFS4: ")}),!k[b]){var j=a[b]||[];P(k,j),k.close=function(t){function e(e,n){return t.call(k,e,(function(t){t||_(),"function"==typeof n&&n.apply(this,arguments)}))}return Object.defineProperty(e,E,{value:t}),e}(k.close),k.closeSync=function(t){function e(e){t.apply(k,arguments),_()}return Object.defineProperty(e,E,{value:t}),e}(k.closeSync),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",(function(){N(k[b]),r.equal(k[b].length,0)}))}a[b]||P(a,k[b]);var L,T=C(F(k));function C(t){O(t),t.gracefulify=C,t.createReadStream=function(e,n){return new t.ReadStream(e,n)},t.createWriteStream=function(e,n){return new t.WriteStream(e,n)};var e=t.readFile;t.readFile=function(t,n,r){"function"==typeof n&&(r=n,n=null);return function t(n,r,i,o){return e(n,r,(function(e){!e||"EMFILE"!==e.code&&"ENFILE"!==e.code?"function"==typeof i&&i.apply(this,arguments):I([t,[n,r,i],e,o||Date.now(),Date.now()])}))}(t,n,r)};var n=t.writeFile;t.writeFile=function(t,e,r,i){"function"==typeof r&&(i=r,r=null);return function t(e,r,i,o,c){return n(e,r,i,(function(n){!n||"EMFILE"!==n.code&&"ENFILE"!==n.code?"function"==typeof o&&o.apply(this,arguments):I([t,[e,r,i,o],n,c||Date.now(),Date.now()])}))}(t,e,r,i)};var r=t.appendFile;r&&(t.appendFile=function(t,e,n,i){"function"==typeof n&&(i=n,n=null);return function t(e,n,i,o,c){return r(e,n,i,(function(r){!r||"EMFILE"!==r.code&&"ENFILE"!==r.code?"function"==typeof o&&o.apply(this,arguments):I([t,[e,n,i,o],r,c||Date.now(),Date.now()])}))}(t,e,n,i)});var i=t.copyFile;i&&(t.copyFile=function(t,e,n,r){"function"==typeof n&&(r=n,n=0);return function t(e,n,r,o,c){return i(e,n,r,(function(i){!i||"EMFILE"!==i.code&&"ENFILE"!==i.code?"function"==typeof o&&o.apply(this,arguments):I([t,[e,n,r,o],i,c||Date.now(),Date.now()])}))}(t,e,n,r)});var o=t.readdir;t.readdir=function(t,e,n){"function"==typeof e&&(n=e,e=null);var r=c.test(process.version)?function(t,e,n,r){return o(t,i(t,e,n,r))}:function(t,e,n,r){return o(t,e,i(t,e,n,r))};return r(t,e,n);function i(t,e,n,i){return function(o,c){!o||"EMFILE"!==o.code&&"ENFILE"!==o.code?(c&&c.sort&&c.sort(),"function"==typeof n&&n.call(this,o,c)):I([r,[t,e,n],o,i||Date.now(),Date.now()])}}};var c=/^v[0-5]\./;if("v0.8"===process.version.substr(0,4)){var a=x(t);y=a.ReadStream,d=a.WriteStream}var s=t.ReadStream;s&&(y.prototype=Object.create(s.prototype),y.prototype.open=function(){var t=this;h(t.path,t.flags,t.mode,(function(e,n){e?(t.autoClose&&t.destroy(),t.emit("error",e)):(t.fd=n,t.emit("open",n),t.read())}))});var u=t.WriteStream;u&&(d.prototype=Object.create(u.prototype),d.prototype.open=function(){var t=this;h(t.path,t.flags,t.mode,(function(e,n){e?(t.destroy(),t.emit("error",e)):(t.fd=n,t.emit("open",n))}))}),Object.defineProperty(t,"ReadStream",{get:function(){return y},set:function(t){y=t},enumerable:!0,configurable:!0}),Object.defineProperty(t,"WriteStream",{get:function(){return d},set:function(t){d=t},enumerable:!0,configurable:!0});var f=y;Object.defineProperty(t,"FileReadStream",{get:function(){return f},set:function(t){f=t},enumerable:!0,configurable:!0});var l=d;function y(t,e){return this instanceof y?(s.apply(this,arguments),this):y.apply(Object.create(y.prototype),arguments)}function d(t,e){return this instanceof d?(u.apply(this,arguments),this):d.apply(Object.create(d.prototype),arguments)}Object.defineProperty(t,"FileWriteStream",{get:function(){return l},set:function(t){l=t},enumerable:!0,configurable:!0});var p=t.open;function h(t,e,n,r){return"function"==typeof n&&(r=n,n=null),function t(e,n,r,i,o){return p(e,n,r,(function(c,a){!c||"EMFILE"!==c.code&&"ENFILE"!==c.code?"function"==typeof i&&i.apply(this,arguments):I([t,[e,n,r,i],c,o||Date.now(),Date.now()])}))}(t,e,n,r)}return t.open=h,t}function I(t){N("ENQUEUE",t[0].name,t[1]),k[b].push(t),A()}function _(){for(var t=Date.now(),e=0;e<k[b].length;++e)k[b][e].length>2&&(k[b][e][3]=t,k[b][e][4]=t);A()}function A(){if(clearTimeout(L),L=void 0,0!==k[b].length){var t=k[b].shift(),e=t[0],n=t[1],r=t[2],i=t[3],o=t[4];if(void 0===i)N("RETRY",e.name,n),e.apply(null,n);else if(Date.now()-i>=6e4){N("TIMEOUT",e.name,n);var c=n.pop();"function"==typeof c&&c.call(null,r)}else{var a=Date.now()-o,s=Math.max(o-i,1);a>=Math.min(1.2*s,100)?(N("RETRY",e.name,n),e.apply(null,n.concat([i]))):k[b].push(t)}void 0===L&&(L=setTimeout(A,0))}}process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!k.__patched&&(T=C(k),k.__patched=!0),function(t){const e=f.fromCallback,n=T,r=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchmod","lchown","link","lstat","mkdir","mkdtemp","open","opendir","readdir","readFile","readlink","realpath","rename","rm","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter((t=>"function"==typeof n[t]));Object.assign(t,n),r.forEach((r=>{t[r]=e(n[r])})),t.exists=function(t,e){return"function"==typeof e?n.exists(t,e):new Promise((e=>n.exists(t,e)))},t.read=function(t,e,r,i,o,c){return"function"==typeof c?n.read(t,e,r,i,o,c):new Promise(((c,a)=>{n.read(t,e,r,i,o,((t,e,n)=>{if(t)return a(t);c({bytesRead:e,buffer:n})}))}))},t.write=function(t,e,...r){return"function"==typeof r[r.length-1]?n.write(t,e,...r):new Promise(((i,o)=>{n.write(t,e,...r,((t,e,n)=>{if(t)return o(t);i({bytesWritten:e,buffer:n})}))}))},t.readv=function(t,e,...r){return"function"==typeof r[r.length-1]?n.readv(t,e,...r):new Promise(((i,o)=>{n.readv(t,e,...r,((t,e,n)=>{if(t)return o(t);i({bytesRead:e,buffers:n})}))}))},t.writev=function(t,e,...r){return"function"==typeof r[r.length-1]?n.writev(t,e,...r):new Promise(((i,o)=>{n.writev(t,e,...r,((t,e,n)=>{if(t)return o(t);i({bytesWritten:e,buffers:n})}))}))},"function"==typeof n.realpath.native?t.realpath.native=e(n.realpath.native):process.emitWarning("fs.realpath.native is not a function. Is fs being monkey-patched?","Warning","fs-extra-WARN0003")}(u);var $={},R={};const W=t;R.checkPath=function(t){if("win32"===process.platform){if(/[<>:"|?*]/.test(t.replace(W.parse(t).root,""))){const e=new Error(`Path contains invalid characters: ${t}`);throw e.code="EINVAL",e}}};const M=u,{checkPath:U}=R,J=t=>"number"==typeof t?t:{mode:511,...t}.mode;$.makeDir=async(t,e)=>(U(t),M.mkdir(t,{mode:J(e),recursive:!0})),$.makeDirSync=(t,e)=>(U(t),M.mkdirSync(t,{mode:J(e),recursive:!0}));const G=f.fromPromise,{makeDir:Y,makeDirSync:z}=$,B=G(Y);var Z={mkdirs:B,mkdirsSync:z,mkdirp:B,mkdirpSync:z,ensureDir:B,ensureDirSync:z};const K=f.fromPromise,V=u;var q={pathExists:K((function(t){return V.access(t).then((()=>!0)).catch((()=>!1))})),pathExistsSync:V.existsSync};const H=u;var X={utimesMillis:(0,f.fromPromise)((async function(t,e,n){const r=await H.open(t,"r+");let i=null;try{await H.futimes(r,e,n)}finally{try{await H.close(r)}catch(t){i=t}}if(i)throw i})),utimesMillisSync:function(t,e,n){const r=H.openSync(t,"r+");return H.futimesSync(r,e,n),H.closeSync(r)}};const Q=u,tt=t,et=f.fromPromise;function nt(t,e){return e.ino&&e.dev&&e.ino===t.ino&&e.dev===t.dev}function rt(t,e){const n=tt.resolve(t).split(tt.sep).filter((t=>t)),r=tt.resolve(e).split(tt.sep).filter((t=>t));return n.every(((t,e)=>r[e]===t))}function it(t,e,n){return`Cannot ${n} '${t}' to a subdirectory of itself, '${e}'.`}var ot={checkPaths:et((async function(t,e,n,r){const{srcStat:i,destStat:o}=await function(t,e,n){const r=n.dereference?t=>Q.stat(t,{bigint:!0}):t=>Q.lstat(t,{bigint:!0});return Promise.all([r(t),r(e).catch((t=>{if("ENOENT"===t.code)return null;throw t}))]).then((([t,e])=>({srcStat:t,destStat:e})))}(t,e,r);if(o){if(nt(i,o)){const r=tt.basename(t),c=tt.basename(e);if("move"===n&&r!==c&&r.toLowerCase()===c.toLowerCase())return{srcStat:i,destStat:o,isChangingCase:!0};throw new Error("Source and destination must not be the same.")}if(i.isDirectory()&&!o.isDirectory())throw new Error(`Cannot overwrite non-directory '${e}' with directory '${t}'.`);if(!i.isDirectory()&&o.isDirectory())throw new Error(`Cannot overwrite directory '${e}' with non-directory '${t}'.`)}if(i.isDirectory()&&rt(t,e))throw new Error(it(t,e,n));return{srcStat:i,destStat:o}})),checkPathsSync:function(t,e,n,r){const{srcStat:i,destStat:o}=function(t,e,n){let r;const i=n.dereference?t=>Q.statSync(t,{bigint:!0}):t=>Q.lstatSync(t,{bigint:!0}),o=i(t);try{r=i(e)}catch(t){if("ENOENT"===t.code)return{srcStat:o,destStat:null};throw t}return{srcStat:o,destStat:r}}(t,e,r);if(o){if(nt(i,o)){const r=tt.basename(t),c=tt.basename(e);if("move"===n&&r!==c&&r.toLowerCase()===c.toLowerCase())return{srcStat:i,destStat:o,isChangingCase:!0};throw new Error("Source and destination must not be the same.")}if(i.isDirectory()&&!o.isDirectory())throw new Error(`Cannot overwrite non-directory '${e}' with directory '${t}'.`);if(!i.isDirectory()&&o.isDirectory())throw new Error(`Cannot overwrite directory '${e}' with non-directory '${t}'.`)}if(i.isDirectory()&&rt(t,e))throw new Error(it(t,e,n));return{srcStat:i,destStat:o}},checkParentPaths:et((async function t(e,n,r,i){const o=tt.resolve(tt.dirname(e)),c=tt.resolve(tt.dirname(r));if(c===o||c===tt.parse(c).root)return;let a;try{a=await Q.stat(c,{bigint:!0})}catch(t){if("ENOENT"===t.code)return;throw t}if(nt(n,a))throw new Error(it(e,r,i));return t(e,n,c,i)})),checkParentPathsSync:function t(e,n,r,i){const o=tt.resolve(tt.dirname(e)),c=tt.resolve(tt.dirname(r));if(c===o||c===tt.parse(c).root)return;let a;try{a=Q.statSync(c,{bigint:!0})}catch(t){if("ENOENT"===t.code)return;throw t}if(nt(n,a))throw new Error(it(e,r,i));return t(e,n,c,i)},isSrcSubdir:rt,areIdentical:nt};const ct=u,at=t,{mkdirs:st}=Z,{pathExists:ut}=q,{utimesMillis:ft}=X,lt=ot;async function yt(t,e,n){return!n.filter||n.filter(t,e)}async function dt(t,e,n,r){const i=r.dereference?ct.stat:ct.lstat,o=await i(e);if(o.isDirectory())return async function(t,e,n,r,i){e||await ct.mkdir(r);const o=await ct.readdir(n);await Promise.all(o.map((async t=>{const e=at.join(n,t),o=at.join(r,t);if(!await yt(e,o,i))return;const{destStat:c}=await lt.checkPaths(e,o,"copy",i);return dt(c,e,o,i)}))),e||await ct.chmod(r,t.mode)}(o,t,e,n,r);if(o.isFile()||o.isCharacterDevice()||o.isBlockDevice())return async function(t,e,n,r,i){if(!e)return pt(t,n,r,i);if(i.overwrite)return await ct.unlink(r),pt(t,n,r,i);if(i.errorOnExist)throw new Error(`'${r}' already exists`)}(o,t,e,n,r);if(o.isSymbolicLink())return async function(t,e,n,r){let i=await ct.readlink(e);r.dereference&&(i=at.resolve(process.cwd(),i));if(!t)return ct.symlink(i,n);let o=null;try{o=await ct.readlink(n)}catch(t){if("EINVAL"===t.code||"UNKNOWN"===t.code)return ct.symlink(i,n);throw t}r.dereference&&(o=at.resolve(process.cwd(),o));if(lt.isSrcSubdir(i,o))throw new Error(`Cannot copy '${i}' to a subdirectory of itself, '${o}'.`);if(lt.isSrcSubdir(o,i))throw new Error(`Cannot overwrite '${o}' with '${i}'.`);return await ct.unlink(n),ct.symlink(i,n)}(t,e,n,r);if(o.isSocket())throw new Error(`Cannot copy a socket file: ${e}`);if(o.isFIFO())throw new Error(`Cannot copy a FIFO pipe: ${e}`);throw new Error(`Unknown file: ${e}`)}async function pt(t,e,n,r){if(await ct.copyFile(e,n),r.preserveTimestamps){128&t.mode||await function(t,e){return ct.chmod(t,128|e)}(n,t.mode);const r=await ct.stat(e);await ft(n,r.atime,r.mtime)}return ct.chmod(n,t.mode)}var ht=async function(t,e,n={}){"function"==typeof n&&(n={filter:n}),n.clobber=!("clobber"in n)||!!n.clobber,n.overwrite="overwrite"in n?!!n.overwrite:n.clobber,n.preserveTimestamps&&"ia32"===process.arch&&process.emitWarning("Using the preserveTimestamps option in 32-bit node is not recommended;\n\n\tsee https://github.com/jprichardson/node-fs-extra/issues/269","Warning","fs-extra-WARN0001");const{srcStat:r,destStat:i}=await lt.checkPaths(t,e,"copy",n);if(await lt.checkParentPaths(t,r,e,"copy"),!await yt(t,e,n))return;const o=at.dirname(e);await ut(o)||await st(o),await dt(i,t,e,n)};const mt=T,vt=t,wt=Z.mkdirsSync,St=X.utimesMillisSync,gt=ot;function bt(t,e,n,r){const i=(r.dereference?mt.statSync:mt.lstatSync)(e);if(i.isDirectory())return function(t,e,n,r,i){return e?Ot(n,r,i):function(t,e,n,r){return mt.mkdirSync(n),Ot(e,n,r),kt(n,t)}(t.mode,n,r,i)}(i,t,e,n,r);if(i.isFile()||i.isCharacterDevice()||i.isBlockDevice())return function(t,e,n,r,i){return e?function(t,e,n,r){if(r.overwrite)return mt.unlinkSync(n),Et(t,e,n,r);if(r.errorOnExist)throw new Error(`'${n}' already exists`)}(t,n,r,i):Et(t,n,r,i)}(i,t,e,n,r);if(i.isSymbolicLink())return function(t,e,n,r){let i=mt.readlinkSync(e);r.dereference&&(i=vt.resolve(process.cwd(),i));if(t){let t;try{t=mt.readlinkSync(n)}catch(t){if("EINVAL"===t.code||"UNKNOWN"===t.code)return mt.symlinkSync(i,n);throw t}if(r.dereference&&(t=vt.resolve(process.cwd(),t)),gt.isSrcSubdir(i,t))throw new Error(`Cannot copy '${i}' to a subdirectory of itself, '${t}'.`);if(gt.isSrcSubdir(t,i))throw new Error(`Cannot overwrite '${t}' with '${i}'.`);return function(t,e){return mt.unlinkSync(e),mt.symlinkSync(t,e)}(i,n)}return mt.symlinkSync(i,n)}(t,e,n,r);if(i.isSocket())throw new Error(`Cannot copy a socket file: ${e}`);if(i.isFIFO())throw new Error(`Cannot copy a FIFO pipe: ${e}`);throw new Error(`Unknown file: ${e}`)}function Et(t,e,n,r){return mt.copyFileSync(e,n),r.preserveTimestamps&&function(t,e,n){(function(t){return!(128&t)})(t)&&function(t,e){kt(t,128|e)}(n,t);(function(t,e){const n=mt.statSync(t);St(e,n.atime,n.mtime)})(e,n)}(t.mode,e,n),kt(n,t.mode)}function kt(t,e){return mt.chmodSync(t,e)}function Ot(t,e,n){mt.readdirSync(t).forEach((r=>function(t,e,n,r){const i=vt.join(e,t),o=vt.join(n,t);if(r.filter&&!r.filter(i,o))return;const{destStat:c}=gt.checkPathsSync(i,o,"copy",r);return bt(c,i,o,r)}(r,t,e,n)))}var xt=function(t,e,n){"function"==typeof n&&(n={filter:n}),(n=n||{}).clobber=!("clobber"in n)||!!n.clobber,n.overwrite="overwrite"in n?!!n.overwrite:n.clobber,n.preserveTimestamps&&"ia32"===process.arch&&process.emitWarning("Using the preserveTimestamps option in 32-bit node is not recommended;\n\n\tsee https://github.com/jprichardson/node-fs-extra/issues/269","Warning","fs-extra-WARN0002");const{srcStat:r,destStat:i}=gt.checkPathsSync(t,e,"copy",n);if(gt.checkParentPathsSync(t,r,e,"copy"),n.filter&&!n.filter(t,e))return;const o=vt.dirname(e);return mt.existsSync(o)||wt(o),bt(i,t,e,n)};var Ft={copy:(0,f.fromPromise)(ht),copySync:xt};const Dt=T;var Pt={remove:(0,f.fromCallback)((function(t,e){Dt.rm(t,{recursive:!0,force:!0},e)})),removeSync:function(t){Dt.rmSync(t,{recursive:!0,force:!0})}};const Nt=f.fromPromise,jt=u,Lt=t,Tt=Z,Ct=Pt,It=Nt((async function(t){let e;try{e=await jt.readdir(t)}catch{return Tt.mkdirs(t)}return Promise.all(e.map((e=>Ct.remove(Lt.join(t,e)))))}));function _t(t){let e;try{e=jt.readdirSync(t)}catch{return Tt.mkdirsSync(t)}e.forEach((e=>{e=Lt.join(t,e),Ct.removeSync(e)}))}var At={emptyDirSync:_t,emptydirSync:_t,emptyDir:It,emptydir:It};const $t=f.fromPromise,Rt=t,Wt=u,Mt=Z;var Ut={createFile:$t((async function(t){let e;try{e=await Wt.stat(t)}catch{}if(e&&e.isFile())return;const n=Rt.dirname(t);let r=null;try{r=await Wt.stat(n)}catch(e){if("ENOENT"===e.code)return await Mt.mkdirs(n),void await Wt.writeFile(t,"");throw e}r.isDirectory()?await Wt.writeFile(t,""):await Wt.readdir(n)})),createFileSync:function(t){let e;try{e=Wt.statSync(t)}catch{}if(e&&e.isFile())return;const n=Rt.dirname(t);try{Wt.statSync(n).isDirectory()||Wt.readdirSync(n)}catch(t){if(!t||"ENOENT"!==t.code)throw t;Mt.mkdirsSync(n)}Wt.writeFileSync(t,"")}};const Jt=f.fromPromise,Gt=t,Yt=u,zt=Z,{pathExists:Bt}=q,{areIdentical:Zt}=ot;var Kt={createLink:Jt((async function(t,e){let n,r;try{n=await Yt.lstat(e)}catch{}try{r=await Yt.lstat(t)}catch(t){throw t.message=t.message.replace("lstat","ensureLink"),t}if(n&&Zt(r,n))return;const i=Gt.dirname(e);await Bt(i)||await zt.mkdirs(i),await Yt.link(t,e)})),createLinkSync:function(t,e){let n;try{n=Yt.lstatSync(e)}catch{}try{const e=Yt.lstatSync(t);if(n&&Zt(e,n))return}catch(t){throw t.message=t.message.replace("lstat","ensureLink"),t}const r=Gt.dirname(e);return Yt.existsSync(r)||zt.mkdirsSync(r),Yt.linkSync(t,e)}};const Vt=t,qt=u,{pathExists:Ht}=q;var Xt={symlinkPaths:(0,f.fromPromise)((async function(t,e){if(Vt.isAbsolute(t)){try{await qt.lstat(t)}catch(t){throw t.message=t.message.replace("lstat","ensureSymlink"),t}return{toCwd:t,toDst:t}}const n=Vt.dirname(e),r=Vt.join(n,t);if(await Ht(r))return{toCwd:r,toDst:t};try{await qt.lstat(t)}catch(t){throw t.message=t.message.replace("lstat","ensureSymlink"),t}return{toCwd:t,toDst:Vt.relative(n,t)}})),symlinkPathsSync:function(t,e){if(Vt.isAbsolute(t)){if(!qt.existsSync(t))throw new Error("absolute srcpath does not exist");return{toCwd:t,toDst:t}}const n=Vt.dirname(e),r=Vt.join(n,t);if(qt.existsSync(r))return{toCwd:r,toDst:t};if(!qt.existsSync(t))throw new Error("relative srcpath does not exist");return{toCwd:t,toDst:Vt.relative(n,t)}}};const Qt=u;var te={symlinkType:(0,f.fromPromise)((async function(t,e){if(e)return e;let n;try{n=await Qt.lstat(t)}catch{return"file"}return n&&n.isDirectory()?"dir":"file"})),symlinkTypeSync:function(t,e){if(e)return e;let n;try{n=Qt.lstatSync(t)}catch{return"file"}return n&&n.isDirectory()?"dir":"file"}};const ee=f.fromPromise,ne=t,re=u,{mkdirs:ie,mkdirsSync:oe}=Z,{symlinkPaths:ce,symlinkPathsSync:ae}=Xt,{symlinkType:se,symlinkTypeSync:ue}=te,{pathExists:fe}=q,{areIdentical:le}=ot;var ye={createSymlink:ee((async function(t,e,n){let r;try{r=await re.lstat(e)}catch{}if(r&&r.isSymbolicLink()){const[n,r]=await Promise.all([re.stat(t),re.stat(e)]);if(le(n,r))return}const i=await ce(t,e);t=i.toDst;const o=await se(i.toCwd,n),c=ne.dirname(e);return await fe(c)||await ie(c),re.symlink(t,e,o)})),createSymlinkSync:function(t,e,n){let r;try{r=re.lstatSync(e)}catch{}if(r&&r.isSymbolicLink()){const n=re.statSync(t),r=re.statSync(e);if(le(n,r))return}const i=ae(t,e);t=i.toDst,n=ue(i.toCwd,n);const o=ne.dirname(e);return re.existsSync(o)||oe(o),re.symlinkSync(t,e,n)}};const{createFile:de,createFileSync:pe}=Ut,{createLink:he,createLinkSync:me}=Kt,{createSymlink:ve,createSymlinkSync:we}=ye;var Se={createFile:de,createFileSync:pe,ensureFile:de,ensureFileSync:pe,createLink:he,createLinkSync:me,ensureLink:he,ensureLinkSync:me,createSymlink:ve,createSymlinkSync:we,ensureSymlink:ve,ensureSymlinkSync:we};var ge={stringify:function(t,{EOL:e="\n",finalEOL:n=!0,replacer:r=null,spaces:i}={}){const o=n?e:"";return JSON.stringify(t,r,i).replace(/\n/g,e)+o},stripBom:function(t){return Buffer.isBuffer(t)&&(t=t.toString("utf8")),t.replace(/^\uFEFF/,"")}};let be;try{be=T}catch(t){be=i}const Ee=f,{stringify:ke,stripBom:Oe}=ge;const xe=Ee.fromPromise((async function(t,e={}){"string"==typeof e&&(e={encoding:e});const n=e.fs||be,r=!("throws"in e)||e.throws;let i,o=await Ee.fromCallback(n.readFile)(t,e);o=Oe(o);try{i=JSON.parse(o,e?e.reviver:null)}catch(e){if(r)throw e.message=`${t}: ${e.message}`,e;return null}return i}));const Fe=Ee.fromPromise((async function(t,e,n={}){const r=n.fs||be,i=ke(e,n);await Ee.fromCallback(r.writeFile)(t,i,n)}));const De={readFile:xe,readFileSync:function(t,e={}){"string"==typeof e&&(e={encoding:e});const n=e.fs||be,r=!("throws"in e)||e.throws;try{let r=n.readFileSync(t,e);return r=Oe(r),JSON.parse(r,e.reviver)}catch(e){if(r)throw e.message=`${t}: ${e.message}`,e;return null}},writeFile:Fe,writeFileSync:function(t,e,n={}){const r=n.fs||be,i=ke(e,n);return r.writeFileSync(t,i,n)}};var Pe={readJson:De.readFile,readJsonSync:De.readFileSync,writeJson:De.writeFile,writeJsonSync:De.writeFileSync};const Ne=f.fromPromise,je=u,Le=t,Te=Z,Ce=q.pathExists;var Ie={outputFile:Ne((async function(t,e,n="utf-8"){const r=Le.dirname(t);return await Ce(r)||await Te.mkdirs(r),je.writeFile(t,e,n)})),outputFileSync:function(t,...e){const n=Le.dirname(t);je.existsSync(n)||Te.mkdirsSync(n),je.writeFileSync(t,...e)}};const{stringify:_e}=ge,{outputFile:Ae}=Ie;var $e=async function(t,e,n={}){const r=_e(e,n);await Ae(t,r,n)};const{stringify:Re}=ge,{outputFileSync:We}=Ie;var Me=function(t,e,n){const r=Re(e,n);We(t,r,n)};const Ue=f.fromPromise,Je=Pe;Je.outputJson=Ue($e),Je.outputJsonSync=Me,Je.outputJSON=Je.outputJson,Je.outputJSONSync=Je.outputJsonSync,Je.writeJSON=Je.writeJson,Je.writeJSONSync=Je.writeJsonSync,Je.readJSON=Je.readJson,Je.readJSONSync=Je.readJsonSync;var Ge=Je;const Ye=u,ze=t,{copy:Be}=Ft,{remove:Ze}=Pt,{mkdirp:Ke}=Z,{pathExists:Ve}=q,qe=ot;var He=async function(t,e,n={}){const r=n.overwrite||n.clobber||!1,{srcStat:i,isChangingCase:o=!1}=await qe.checkPaths(t,e,"move",n);await qe.checkParentPaths(t,i,e,"move");const c=ze.dirname(e);return ze.parse(c).root!==c&&await Ke(c),async function(t,e,n,r){if(!r)if(n)await Ze(e);else if(await Ve(e))throw new Error("dest already exists.");try{await Ye.rename(t,e)}catch(r){if("EXDEV"!==r.code)throw r;await async function(t,e,n){const r={overwrite:n,errorOnExist:!0,preserveTimestamps:!0};return await Be(t,e,r),Ze(t)}(t,e,n)}}(t,e,r,o)};const Xe=T,Qe=t,tn=Ft.copySync,en=Pt.removeSync,nn=Z.mkdirpSync,rn=ot;function on(t,e,n){try{Xe.renameSync(t,e)}catch(r){if("EXDEV"!==r.code)throw r;return function(t,e,n){const r={overwrite:n,errorOnExist:!0,preserveTimestamps:!0};return tn(t,e,r),en(t)}(t,e,n)}}var cn=function(t,e,n){const r=(n=n||{}).overwrite||n.clobber||!1,{srcStat:i,isChangingCase:o=!1}=rn.checkPathsSync(t,e,"move",n);return rn.checkParentPathsSync(t,i,e,"move"),function(t){const e=Qe.dirname(t);return Qe.parse(e).root===e}(e)||nn(Qe.dirname(e)),function(t,e,n,r){if(r)return on(t,e,n);if(n)return en(e),on(t,e,n);if(Xe.existsSync(e))throw new Error("dest already exists.");return on(t,e,n)}(t,e,r,o)};var an={move:(0,f.fromPromise)(He),moveSync:cn},sn={...u,...Ft,...At,...Se,...Ge,...Z,...an,...Ie,...q,...Pt};var un=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)},fn="object"==typeof a&&a&&a.Object===Object&&a,ln="object"==typeof self&&self&&self.Object===Object&&self,yn=fn||ln||Function("return this")(),dn=yn,pn=function(){return dn.Date.now()},hn=/\s/;var mn=function(t){for(var e=t.length;e--&&hn.test(t.charAt(e)););return e},vn=/^\s+/;var wn=function(t){return t?t.slice(0,mn(t)+1).replace(vn,""):t},Sn=yn.Symbol,gn=Sn,bn=Object.prototype,En=bn.hasOwnProperty,kn=bn.toString,On=gn?gn.toStringTag:void 0;var xn=function(t){var e=En.call(t,On),n=t[On];try{t[On]=void 0;var r=!0}catch(t){}var i=kn.call(t);return r&&(e?t[On]=n:delete t[On]),i},Fn=Object.prototype.toString;var Dn=xn,Pn=function(t){return Fn.call(t)},Nn=Sn?Sn.toStringTag:void 0;var jn=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Nn&&Nn in Object(t)?Dn(t):Pn(t)},Ln=function(t){return null!=t&&"object"==typeof t};var Tn=function(t){return"symbol"==typeof t||Ln(t)&&"[object Symbol]"==jn(t)},Cn=wn,In=un,_n=Tn,An=/^[-+]0x[0-9a-f]+$/i,$n=/^0b[01]+$/i,Rn=/^0o[0-7]+$/i,Wn=parseInt;var Mn=un,Un=pn,Jn=function(t){if("number"==typeof t)return t;if(_n(t))return NaN;if(In(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=In(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Cn(t);var n=$n.test(t);return n||Rn.test(t)?Wn(t.slice(2),n?2:8):An.test(t)?NaN:+t},Gn=Math.max,Yn=Math.min;var zn=s((function(t,e,n){var r,i,o,c,a,s,u=0,f=!1,l=!1,y=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function d(e){var n=r,o=i;return r=i=void 0,u=e,c=t.apply(o,n)}function p(t){var n=t-s;return void 0===s||n>=e||n<0||l&&t-u>=o}function h(){var t=Un();if(p(t))return m(t);a=setTimeout(h,function(t){var n=e-(t-s);return l?Yn(n,o-(t-u)):n}(t))}function m(t){return a=void 0,y&&r?d(t):(r=i=void 0,c)}function v(){var t=Un(),n=p(t);if(r=arguments,i=this,s=t,n){if(void 0===a)return function(t){return u=t,a=setTimeout(h,e),f?d(t):c}(s);if(l)return clearTimeout(a),a=setTimeout(h,e),d(s)}return void 0===a&&(a=setTimeout(h,e)),c}return e=Jn(e)||0,Mn(n)&&(f=!!n.leading,o=(l="maxWait"in n)?Gn(Jn(n.maxWait)||0,e):o,y="trailing"in n?!!n.trailing:y),v.cancel=function(){void 0!==a&&clearTimeout(a),u=0,r=s=i=a=void 0},v.flush=function(){return void 0===a?c:m(Un())},v}));var Bn=function(t,e,n,r){var i=-1,o=null==t?0:t.length;for(r&&o&&(n=t[++i]);++i<o;)n=e(n,t[i],i,t);return n};var Zn=function(t){return function(e){return null==t?void 0:t[e]}}({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"});var Kn=function(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i},Vn=Array.isArray,qn=Kn,Hn=Vn,Xn=Tn,Qn=Sn?Sn.prototype:void 0,tr=Qn?Qn.toString:void 0;var er=function t(e){if("string"==typeof e)return e;if(Hn(e))return qn(e,t)+"";if(Xn(e))return tr?tr.call(e):"";var n=e+"";return"0"==n&&1/e==-1/0?"-0":n},nr=er;var rr=function(t){return null==t?"":nr(t)},ir=Zn,or=rr,cr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ar=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");var sr=function(t){return(t=or(t))&&t.replace(cr,ir).replace(ar,"")},ur=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;var fr=function(t){return t.match(ur)||[]},lr=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;var yr=function(t){return lr.test(t)},dr="\\ud800-\\udfff",pr="\\u2700-\\u27bf",hr="a-z\\xdf-\\xf6\\xf8-\\xff",mr="A-Z\\xc0-\\xd6\\xd8-\\xde",vr="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",wr="["+vr+"]",Sr="\\d+",gr="["+pr+"]",br="["+hr+"]",Er="[^"+dr+vr+Sr+pr+hr+mr+"]",kr="(?:\\ud83c[\\udde6-\\uddff]){2}",Or="[\\ud800-\\udbff][\\udc00-\\udfff]",xr="["+mr+"]",Fr="(?:"+br+"|"+Er+")",Dr="(?:"+xr+"|"+Er+")",Pr="(?:['’](?:d|ll|m|re|s|t|ve))?",Nr="(?:['’](?:D|LL|M|RE|S|T|VE))?",jr="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",Lr="[\\ufe0e\\ufe0f]?",Tr=Lr+jr+("(?:\\u200d(?:"+["[^"+dr+"]",kr,Or].join("|")+")"+Lr+jr+")*"),Cr="(?:"+[gr,kr,Or].join("|")+")"+Tr,Ir=RegExp([xr+"?"+br+"+"+Pr+"(?="+[wr,xr,"$"].join("|")+")",Dr+"+"+Nr+"(?="+[wr,xr+Fr,"$"].join("|")+")",xr+"?"+Fr+"+"+Pr,xr+"+"+Nr,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Sr,Cr].join("|"),"g");var _r=fr,Ar=yr,$r=rr,Rr=function(t){return t.match(Ir)||[]};var Wr=Bn,Mr=sr,Ur=function(t,e,n){return t=$r(t),void 0===(e=n?void 0:e)?Ar(t)?Rr(t):_r(t):t.match(e)||[]},Jr=RegExp("['’]","g");var Gr=function(t){return function(e){return Wr(Ur(Mr(e).replace(Jr,"")),t,"")}};var Yr=function(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var o=Array(i);++r<i;)o[r]=t[r+e];return o};var zr=function(t,e,n){var r=t.length;return n=void 0===n?r:n,!e&&n>=r?t:Yr(t,e,n)},Br=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var Zr=function(t){return Br.test(t)};var Kr=function(t){return t.split("")},Vr="\\ud800-\\udfff",qr="["+Vr+"]",Hr="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Xr="\\ud83c[\\udffb-\\udfff]",Qr="[^"+Vr+"]",ti="(?:\\ud83c[\\udde6-\\uddff]){2}",ei="[\\ud800-\\udbff][\\udc00-\\udfff]",ni="(?:"+Hr+"|"+Xr+")"+"?",ri="[\\ufe0e\\ufe0f]?",ii=ri+ni+("(?:\\u200d(?:"+[Qr,ti,ei].join("|")+")"+ri+ni+")*"),oi="(?:"+[Qr+Hr+"?",Hr,ti,ei,qr].join("|")+")",ci=RegExp(Xr+"(?="+Xr+")|"+oi+ii,"g");var ai=Kr,si=Zr,ui=function(t){return t.match(ci)||[]};var fi=zr,li=Zr,yi=function(t){return si(t)?ui(t):ai(t)},di=rr;var pi=function(t){return function(e){e=di(e);var n=li(e)?yi(e):void 0,r=n?n[0]:e.charAt(0),i=n?fi(n,1).join(""):e.slice(1);return r[t]()+i}}("toUpperCase"),hi=s(Gr((function(t,e,n){return t+(n?" ":"")+pi(e)})));const{readdir:mi,writeFile:vi,mkdir:wi}=sn.promises;var Si=class{constructor(e){var n=this;let{svgFileDir:r,outputDir:i,typescript:o=!1,title:a=!1,description:s=!1}=e;this.readSvgFileList=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return c(n,void 0,void 0,(function*(){const n=yield mi(e,{withFileTypes:!0}),i=yield Promise.all(n.map((n=>c(this,void 0,void 0,(function*(){const i="".concat(r?"".concat(r,"/"):"").concat(n.name),o=t.resolve(e,n.name);return n.isDirectory()&&"types"!==n.name?this.readSvgFileList(o,i):i})))));return Array.prototype.concat(...i)}))},this.generate=zn((()=>c(this,void 0,void 0,(function*(){const t=yield this.readSvgFileList(this.svgFileDir),e=this.filterSvgFileNameList(t);yield this.writeSvgTypeFile(e),yield this.writeStaticSvgExportFile(e)}))),1500),this.svgFileDir=r,this.outputDir=null!=i?i:r,this.typescript=o,this.title=a,this.description=s}parseSvgListForType(t){const e=t.map((t=>"".concat(t.replace(".svg","")))),n=e.map((t=>"'".concat(t,"'"))).join(" | ")||"''",r=e.map((t=>"'".concat("Svg".concat(hi(t.replace(/\//gi,"-").replace(".svg","")).replace(/ /gi,""),"'")))).join(" | ")||"''",i=e.filter((t=>t.includes("/"))).reduce(((t,e)=>{const n=e.split("/"),r=n.pop()||"",i=hi(n.join("-")).replace(/ /gi,"");return Object.assign(Object.assign({},t),{[i]:t[i]?"".concat(t[i]," | '").concat(r,"'"):"'".concat(r,"'")})}),{});return{staticSvgIconName:n,particalSvgIconName:Object.entries(i).map((t=>{let[e,n]=t;return"export type ".concat(e,"IconType = ").concat(n,";\n")})).join(""),svgComponentName:r}}parseSvgListForFile(e){return c(this,void 0,void 0,(function*(){const n=e.reduce(((t,e)=>{const n="Svg".concat(hi(e.replace(/\//gi,"-").replace(".svg","")).replace(/ /gi,""));return t=Object.assign(Object.assign({},t),{[n]:e})}),{}),r=Object.entries(n),i=t.relative(this.outputDir,this.svgFileDir).replace(/\\/gi,"/");return{importString:r.reduce(((t,e)=>{let[n,r]=e;return t+="import ".concat(n," from '").concat(i,"/").concat(r,"';\n")}),"").replace(/\n/gi,""),exportString:r.reduce(((t,e,r)=>{let[i,o]=e;return 0===r&&(t="export {\n"),t+="".concat(0!==r?",":"","  ").concat(i,"\n"),r===Object.entries(n).length-1&&(t+=" };"),t}),"").replace(/\n/gi,"")}}))}filterSvgFileNameList(t){return t.filter((t=>t.endsWith(".svg")))}writeSvgTypeFile(t){return c(this,void 0,void 0,(function*(){if(!this.typescript)return;const{staticSvgIconName:e,particalSvgIconName:n,svgComponentName:r}=this.parseSvgListForType(t),i="".concat(this.outputDir,"/types");return yield wi(i,{recursive:!0}),sn.existsSync(i)?vi("".concat(i,"/index.d.ts"),"/* eslint-disable */\nexport type StaticSvgIconName = ".concat(e,";\n").concat(n)+"export type SvgComponentName = ".concat(r),{flag:"w"}).then((()=>{})).catch(console.error):void 0}))}writeStaticSvgExportFile(t){return c(this,void 0,void 0,(function*(){const{importString:e,exportString:n}=yield this.parseSvgListForFile(t),r="".concat(this.outputDir,"/index.").concat(this.typescript?"jsx":"tsx"),i="".concat(this.outputDir,"/index.").concat(this.typescript?"tsx":"jsx");return yield wi(this.outputDir,{recursive:!0}),sn.existsSync(r)&&sn.remove(r),vi(i,'/* eslint-disable */ \nimport React from "react";\n\n'.concat(e,"\n").concat(n),{flag:"w"}).then((()=>{})).catch(console.error)}))}};const gi=t=>{let{svgFileDir:e,outputDir:n,typescript:r,title:i,description:o}=t;return{name:"vite-svg-component-plugin",buildStart(){new Si({svgFileDir:e,outputDir:n,typescript:r,title:i,description:o}).generate()},buildEnd(){}}};process.once("SIGINT",(()=>{process.exit(0)}));var bi=class{constructor(e){let{svgFileDir:n,outputDir:r,typescript:i,title:o,description:c}=e;this.svgFileDir=t.join(process.cwd(),n),this.outputDir=null!=r?r:"",this.svgCompGenerator=new Si({svgFileDir:n,outputDir:r,typescript:i,title:o,description:c}),process.once("SIGINT",(()=>{this.watcher&&this.watcher.close(),process.exit(0)}))}apply(t){return c(this,void 0,void 0,(function*(){t.hooks.compile.tap("WebpackSvgComponentPlugin",(()=>{this.svgCompGenerator.generate()})),t.hooks.done.tap("WebpackSvgComponentPlugin",(()=>{this.watcher&&(this.watcher.close(),this.watcher=null)}))}))}};export{Si as SvgComponentGenerator,gi as ViteSvgComponentPlugin,bi as WebpackSvgComponentPlugin};

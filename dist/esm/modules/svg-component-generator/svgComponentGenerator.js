import{__awaiter as t}from"../_virtual/_tslib.js";import e from"path";import{l as i}from'./../ext/fs-extra/lib/index.js';import r from'./../ext/lodash/debounce.js';import o from'./../ext/lodash/startCase.js';const{readdir:n,writeFile:c,mkdir:s}=i.promises;var a=class{constructor(i){var o=this;let{svgFileDir:c,outputDir:s,typescript:a=!1,title:p=!1,description:l=!1}=i;this.readSvgFileList=function(i){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return t(o,void 0,void 0,(function*(){const o=yield n(i,{withFileTypes:!0}),c=yield Promise.all(o.map((o=>t(this,void 0,void 0,(function*(){const t="".concat(r?"".concat(r,"/"):"").concat(o.name),n=e.resolve(i,o.name);return o.isDirectory()&&"types"!==o.name?this.readSvgFileList(n,t):t})))));return Array.prototype.concat(...c)}))},this.generate=r((()=>t(this,void 0,void 0,(function*(){const t=yield this.readSvgFileList(this.svgFileDir),e=this.filterSvgFileNameList(t);yield this.writeSvgTypeFile(e),yield this.writeStaticSvgExportFile(e)}))),1500),this.svgFileDir=c,this.outputDir=null!=s?s:c,this.typescript=a,this.title=p,this.description=l}parseSvgListForType(t){const e=t.map((t=>"".concat(t.replace(".svg","")))),i=e.map((t=>"'".concat(t,"'"))).join(" | ")||"''",r=e.map((t=>"'".concat("Svg".concat(o(t.replace(/\//gi,"-").replace(".svg","")).replace(/ /gi,""),"'")))).join(" | ")||"''",n=e.filter((t=>t.includes("/"))).reduce(((t,e)=>{const i=e.split("/"),r=i.pop()||"",n=o(i.join("-")).replace(/ /gi,"");return Object.assign(Object.assign({},t),{[n]:t[n]?"".concat(t[n]," | '").concat(r,"'"):"'".concat(r,"'")})}),{});return{staticSvgIconName:i,particalSvgIconName:Object.entries(n).map((t=>{let[e,i]=t;return"export type ".concat(e,"IconType = ").concat(i,";\n")})).join(""),svgComponentName:r}}parseSvgListForFile(i){return t(this,void 0,void 0,(function*(){const t=i.reduce(((t,e)=>{const i="Svg".concat(o(e.replace(/\//gi,"-").replace(".svg","")).replace(/ /gi,""));return t=Object.assign(Object.assign({},t),{[i]:e})}),{}),r=Object.entries(t),n=e.relative(this.outputDir,this.svgFileDir).replace(/\\/gi,"/");return{importString:r.reduce(((t,e)=>{let[i,r]=e;return t+="import ".concat(i," from '").concat(n,"/").concat(r,"';\n")}),"").replace(/\n/gi,""),exportString:r.reduce(((e,i,r)=>{let[o,n]=i;return 0===r&&(e="export {\n"),e+="".concat(0!==r?",":"","  ").concat(o,"\n"),r===Object.entries(t).length-1&&(e+=" };"),e}),"").replace(/\n/gi,"")}}))}filterSvgFileNameList(t){return t.filter((t=>t.endsWith(".svg")))}writeSvgTypeFile(e){return t(this,void 0,void 0,(function*(){if(!this.typescript)return;const{staticSvgIconName:t,particalSvgIconName:r,svgComponentName:o}=this.parseSvgListForType(e),n="".concat(this.outputDir,"/types");return yield s(n,{recursive:!0}),i.existsSync(n)?c("".concat(n,"/index.d.ts"),"/* eslint-disable */\nexport type StaticSvgIconName = ".concat(t,";\n").concat(r)+"export type SvgComponentName = ".concat(o),{flag:"w"}).then((()=>{})).catch(console.error):void 0}))}writeStaticSvgExportFile(e){return t(this,void 0,void 0,(function*(){const{importString:t,exportString:r}=yield this.parseSvgListForFile(e),o="".concat(this.outputDir,"/index.").concat(this.typescript?"jsx":"tsx"),n="".concat(this.outputDir,"/index.").concat(this.typescript?"tsx":"jsx");return yield s(this.outputDir,{recursive:!0}),i.existsSync(o)&&i.remove(o),c(n,'/* eslint-disable */ \nimport React from "react";\n\n'.concat(t,"\n").concat(r),{flag:"w"}).then((()=>{})).catch(console.error)}))}};export{a as default};

import e from"@babel/runtime/helpers/toConsumableArray";import t from"@babel/runtime/helpers/classCallCheck";import n from"@babel/runtime/helpers/createClass";var a=function(){return n((function e(n){var a=n.contentEditableEl;t(this,e),this.commandKey="autoUrlMatch",this.urls=[],this.config={},this.contentEditableEl=a}),[{key:"setConfig",value:function(e){this.config=Object.assign(Object.assign({},this.config),null!=e?e:{})}},{key:"getUrlMatchList",value:function(e){var t,n;return null!==(n=null===(t=(null!=e?e:"").match(/(https?:\/\/[^\s/$.?#].[^\s]*)|(www\.[^\s/$.?#].[^\s]*)|(ftp:\/\/[^\s/$.?#].[^\s]*)/gi))||void 0===t?void 0:t.map((function(e){return e.trim()})))&&void 0!==n?n:[]}},{key:"handleKeyDown",value:function(e){var t,n,a,r,l=e.event,i=window.getSelection(),o=document.createRange(),s=Number(this.contentEditableEl.current.ariaValueMax),c=(null===(t=this.contentEditableEl.current.textContent)||void 0===t?void 0:t.length)||0,d=i.focusNode,h=i.getRangeAt(0).startOffset,u=null!==(n=this.getUrlMatchList(d.textContent).pop())&&void 0!==n?n:"";if("Space"===l.code||"Enter"===l.code||"NumpadEnter"===l.code)if("A"===(null===(a=d.parentElement)||void 0===a?void 0:a.tagName)){var f=i.getRangeAt(0),m=f.startOffset,p=d.textContent,g=p.slice(0,m),v=p.slice(m);if(d.textContent=g,d.parentElement.href=g,"Space"===l.code){if(l.preventDefault(),v)if(!!this.getUrlMatchList(v)[0]){var E=document.createElement("a");E.href=v,E.textContent=v.startsWith("http")?v:"https://".concat(v),d.parentElement.insertAdjacentElement("afterend",E)}else d.parentElement.parentNode.insertBefore(document.createTextNode(v),d.parentElement.nextSibling);var b=document.createTextNode(" ");d.parentElement.parentNode.insertBefore(b,d.parentElement.nextSibling),f.setStartAfter(b),f.setEndAfter(b),i.removeAllRanges(),i.addRange(f)}else{if(l.preventDefault(),v)if(!!this.getUrlMatchList(v)[0]){var x=document.createElement("a");x.href=v,x.textContent=v.startsWith("http")?v:"https://".concat(v),d.parentElement.insertAdjacentElement("afterend",x)}else d.parentElement.parentNode.insertBefore(document.createTextNode(v),d.parentElement.nextSibling);var C=document.createElement("br");d.parentElement.parentNode.insertBefore(C,d.parentElement.nextSibling),f.setStartAfter(C),f.setEndAfter(C),i.removeAllRanges(),i.addRange(f)}g||d.parentElement.remove(),this.contentEditableEl.current.dispatchEvent(new Event("input",{bubbles:!0}))}else if(u&&h>0&&d.nodeType===Node.TEXT_NODE&&s>=c+1){var N=u.startsWith("http")?u:"https://".concat(u);this.config.onMatchUrl&&this.config.onMatchUrl(N);var A=document.createElement("div");A.innerHTML='<a href="'.concat(N,'" target="_blank">').concat(u,"</a>");var S=Array.from(A.childNodes);if(S.length>0){var M=(null!==(r=d.textContent)&&void 0!==r?r:"").indexOf(u),w=M+u.length;o.setStart(d,M),o.setEnd(d,w),o.deleteContents(),S.forEach((function(e){o.insertNode(e),o.setStartAfter(e)}));var R=document.createTextNode("Â ");o.insertNode(R),o.setStartAfter(R),o.setEndAfter(R),i.removeAllRanges(),i.addRange(o),l.preventDefault(),this.contentEditableEl.current.dispatchEvent(new Event("input",{bubbles:!0}))}}}},{key:"handleChange",value:function(t){var n,a,r=this,l=t.event,i=window.getSelection().focusNode;if("A"===(null===(n=i.parentElement)||void 0===n?void 0:n.tagName))if(this.getUrlMatchList(i.textContent).length)i.parentElement.href=i.textContent;else{var o=i.parentElement,s=o.textContent||"",c=document.createTextNode(s),d=o.parentElement;if(d){d.replaceChild(c,o);var h=document.createRange(),u=window.getSelection();h.setStart(c,c.length),h.collapse(!0),null==u||u.removeAllRanges(),null==u||u.addRange(h)}}var f=(null!==(a=(l.target.innerHTML||"").match(/<a[^>]*>(.*?)<\/a>/g))&&void 0!==a?a:[]).map((function(e){var t=e.match(/<a[^>]*>(.*?)<\/a>/)[1];return t.startsWith("http")?t:"https://".concat(t)}));f.length===this.urls.length&&f.every((function(e){return r.urls.includes(e)}))||(this.urls=e(f),this.config.onChangeMatchUrls&&this.config.onChangeMatchUrls(f))}}])}();export{a as default};

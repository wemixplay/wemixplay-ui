'use client';
import e,{forwardRef as t,useRef as n,useState as r,useCallback as c,useImperativeHandle as o,useEffect as l}from"react";import{isDesktop as s}from"react-device-detect";import i from"./HashList.module.scss.js";import{makeCxFunc as a}from"../../../utils/forReactUtils.js";import u from"../../../hooks/useCheckDevice.js";const m=a(i),h=t(((t,i)=>{let{className:a="",contentEditableEl:h,targetHashId:d,list:p,listElement:f,selectHashItem:g,closeHashList:v}=t;const b=n(),y=n(),E=n({x:0,y:0}),[w,L]=r({}),[H,x]=r(0),{isMobile:N}=u(),T=c((()=>{if(!(null!=p?p:[]).length)return;const e=0===H?p.length-1:H-1;x(e);const t=y.current.querySelector("li:nth-child(".concat(e+1,")"));y.current.scrollTop=t.offsetTop-20}),[H,p]),k=c((()=>{if(!(null!=p?p:[]).length)return;const e=H===p.length-1?0:H+1;x(e);const t=y.current.querySelector("li:nth-child(".concat(e+1,")"));y.current.scrollTop=t.offsetTop-20}),[p,H]),j=c((e=>{if((null!=p?p:[]).length)return p[null!=e?e:H]}),[H,p]),S=c((e=>{s&&x(e)}),[]),O=c((e=>{x(e),g(e)}),[g]),Y=c((e=>{var t,n;if(!e)return;const{offsetHeight:r}=e,c=e.getBoundingClientRect(),o="fixed"===document.body.style.position&&!!document.body.style.top&&Number(document.body.style.top.replace("px",""))<0?-1*Number(document.body.style.top.replace("px","")):window.scrollY,l=c.left+b.current.offsetWidth-window.innerWidth,s=c.top+o,i=c.bottom+o,a=l>0?c.left-l-10:c.left,u=o,m=o+window.innerHeight;let h="bottom",d=null!==(t=b.current.clientHeight)&&void 0!==t?t:0;d>m-i&&(h=s-u>m-i?"top":"bottom"),d>s-u&&d>m-i&&(y.current.style.height="".concat("top"===h?s-u-32:m-i-32,"px")),d=null!==(n=b.current.clientHeight)&&void 0!==n?n:0;const p={position:"absolute",zIndex:"9999999",visibility:"visible"};switch(N&&(p.maxWidth="95%"),h){case"top":p.top=s-d,p.left=N?"50%":a;break;case"bottom":p.top=s+r,p.left=N?"50%":a}return N&&(p.transform="translateX(-50%)"),p}),[N]),q=c((e=>{E.current={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}}),[]),z=c((e=>{const t=y.current.scrollTop,n=y.current.scrollHeight;(e.cancelable&&t<=0&&e.changedTouches[0].clientY-E.current.y>0||e.cancelable&&t>=n-y.current.clientHeight&&E.current.y-e.changedTouches[0].clientY>0)&&e.preventDefault()}),[]);return o(i,(()=>(b.current.handleArrowUp=T,b.current.handleArrowDown=k,b.current.handleSubmit=j,b.current))),l((()=>{if(h.current&&d){const e=h.current.querySelector("#".concat(d)),t=Y(e);L(t)}else L({})}),[d,p.length,Y]),l((()=>{x(0)}),[p]),l((()=>{const e=e=>{const t=e.target;!b.current||b.current.contains(t)||t.classList.contains("hash")||v()};return document.addEventListener("click",e),window.addEventListener("resize",v),()=>{document.removeEventListener("click",e),window.removeEventListener("resize",v)}}),[v]),l((()=>{const e=y.current;return e.addEventListener("touchstart",q),e.addEventListener("touchmove",z),()=>{e.removeEventListener("touchstart",q),e.removeEventListener("touchmove",z)}}),[q,z]),e.createElement("div",{ref:b,className:m(a,"hash-list"),contentEditable:!1,style:Object.assign(Object.assign({},w),{display:(null!=p?p:[]).length>0?"block":"none"})},e.createElement("ul",{ref:y,className:m("hash-list-area")},(null!=p?p:[]).map(((t,n)=>e.createElement("li",{ref:e=>{e&&Object.entries(t).map((t=>{let[n,r]=t;e.dataset[n]=String(r)}))},className:m("hash-item",{active:H===n}),key:"".concat(t.name,"-").concat(n),onMouseOver:()=>S(n),onClick:()=>O(n)},f?f(t):e.createElement(e.Fragment,null,e.createElement("div",{className:m("info-area")},e.createElement("strong",{className:m("title")},e.createElement("span",null,"#"),t.name))))))))}));h.displayName="HashList";export{h as default};

import t from"@babel/runtime/helpers/classCallCheck";import e from"@babel/runtime/helpers/createClass";import{sanitize as r}from"isomorphic-dompurify";function n(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return a(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(t,e):void 0}}(t))||e){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,l=!0,c=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return l=t.done,t},e:function(t){c=!0,o=t},f:function(){try{l||null==r.return||r.return()}finally{if(c)throw o}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var i=function(){return e((function e(r){var n=r.contentEditableEl;t(this,e),this.commandKey="pasteToPlainText",this.config={},this.contentEditableEl=n}),[{key:"setConfig",value:function(t){this.config=Object.assign(Object.assign({},this.config),null!=t?t:{})}},{key:"checkHTMLFormat",value:function(t){return/<(div|span|p|img|video|iframe)(\s[^>]*)?>/i.test(t)}},{key:"getMediaMatchUrlList",value:function(t){for(var e,r=/<(img|video|iframe)(?=[^>]*\s+src=["']([^"']+)["'])[^>]*>/g,n=[];null!==(e=r.exec(t));)n.push({tag:e[1],src:e[2].startsWith("http")?e[2]:"https://".concat(e[2])});return n}},{key:"getUrlMatchList",value:function(t){var e,r;return null!==(r=null===(e=(null!=t?t:"").match(/\bhttps?:\/\/[^\s"']+|www\.[^\s"']+|ftp:\/\/[^\s"']+/gi))||void 0===e?void 0:e.map((function(t){var e=t.trim();return e.startsWith("http")?e:"https://".concat(e)})))&&void 0!==r?r:[]}},{key:"handlePaste",value:function(t){var e,a,i,o=t.event,l=window.getSelection(),c=o.nativeEvent.clipboardData.getData("text"),s=o.nativeEvent.clipboardData.getData("text/html"),u=o.nativeEvent.clipboardData.getData("text/plain");u=(u=r(u)).replace(/<img[^>]*src="([^"]*)"[^>]*>|<video[^>]*>.*?<\/video>|<iframe[^>]*>.*?<\/iframe>/gi,"$1");var f=this.contentEditableEl.current.getAttribute("aria-valuemax");if(f){var v=Number(f)-this.contentEditableEl.current.textContent.length-1;u=v>0?u.slice(0,v):""}var d=this.getMediaMatchUrlList(this.checkHTMLFormat(c)?c:s),h=this.getUrlMatchList(u),m=null!==(i=null===(a=(e=this.config).onMatchUrlReplace)||void 0===a?void 0:a.call(e,{textUrls:h,mediaUrls:d}))&&void 0!==i?i:[];h.forEach((function(t,e){m[e]&&(u.includes(t)?u=u.replace(t,m[e]):u.includes(t.replace("https://",""))&&(u=u.replace(t.replace("https://",""),m[e])))}));var p=l.getRangeAt(0);p.deleteContents();var g=document.createElement("div");g.innerHTML="".concat(u.replace(/<script\b[^>]*>([\s\S]*?)<\/script>|<style\b[^>]*>([\s\S]*?)<\/style>/gi,"").trim(),"&nbsp;");var b,y=g.lastChild,E=n(Array.from(g.childNodes).reverse());try{for(E.s();!(b=E.n()).done;){var A=b.value;p.insertNode(A)}}catch(t){E.e(t)}finally{E.f()}g.remove(),p.setStartAfter(y),p.setEndAfter(y),l.removeAllRanges(),l.addRange(p),o.preventDefault(),this.contentEditableEl.current.dispatchEvent(new Event("input",{bubbles:!0}))}}])}();export{i as default};

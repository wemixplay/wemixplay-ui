import e from"@babel/runtime/helpers/slicedToArray";import t,{forwardRef as n,useRef as r,useState as o,useCallback as c,useImperativeHandle as i,useEffect as l}from"react";import{isDesktop as s}from"react-device-detect";import a from"./MentionList.module.scss.js";import{makeCxFunc as u}from"../../../utils/forReactUtils.js";import m from"../../../components/avatars/Person.js";import f from"../../../assets/svgs/ico-certified-v2.svg.js";import d from"../../../hooks/useCheckDevice.js";var h=u(a),v=n((function(n,a){var u=n.targetMentionId,v=n.className,p=void 0===v?"":v,g=n.list,b=n.contentEditableEl,y=n.listElement,E=n.selectMentionItem,w=n.closeMentionList,L=r(),N=r(),T=r({x:0,y:0}),x=o({}),k=e(x,2),j=k[0],M=k[1],H=o(0),z=e(H,2),I=z[0],O=z[1],S=d().isMobile,Y=c((function(){if((null!=g?g:[]).length){var e=0===I?g.length-1:I-1;O(e);var t=N.current.querySelector("li:nth-child(".concat(e+1,")"));N.current.scrollTop=t.offsetTop-20}}),[I,g]),q=c((function(){if((null!=g?g:[]).length){var e=I===g.length-1?0:I+1;O(e);var t=N.current.querySelector("li:nth-child(".concat(e+1,")"));N.current.scrollTop=t.offsetTop-20}}),[g,I]),A=c((function(e){if((null!=g?g:[]).length)return g[null!=e?e:I]}),[I,g]),C=c((function(e){s&&O(e)}),[]),D=c((function(e){O(e),E(e)}),[E]),W=c((function(e){var t,n;if(e){var r=e.offsetHeight,o=e.getBoundingClientRect(),c="fixed"===document.body.style.position&&!!document.body.style.top&&Number(document.body.style.top.replace("px",""))<0?-1*Number(document.body.style.top.replace("px","")):window.scrollY,i=o.left+L.current.offsetWidth-window.innerWidth,l=o.top+c,s=o.bottom+c,a=i>0?o.left-i-10:o.left,u=c,m=c+window.innerHeight,f="bottom",d=null!==(t=L.current.clientHeight)&&void 0!==t?t:0;d>m-s&&(f=l-u>m-s?"top":"bottom"),d>l-u&&d>m-s&&(N.current.style.height="".concat("top"===f?l-u-32:m-s-32,"px")),d=null!==(n=L.current.clientHeight)&&void 0!==n?n:0;var h={position:"absolute",zIndex:"9999999",visibility:"visible"};switch(S&&(h.maxWidth="95%"),f){case"top":h.top=l-d,h.left=S?"50%":a;break;case"bottom":h.top=l+r,h.left=S?"50%":a}return S&&(h.transform="translateX(-50%)"),h}}),[S]),R=c((function(e){T.current={x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}}),[]),U=c((function(e){var t=N.current.scrollTop,n=N.current.scrollHeight;(e.cancelable&&t<=0&&e.changedTouches[0].clientY-T.current.y>0||e.cancelable&&t>=n-N.current.clientHeight&&T.current.y-e.changedTouches[0].clientY>0)&&e.preventDefault()}),[]);return i(a,(function(){return L.current.handleArrowUp=Y,L.current.handleArrowDown=q,L.current.handleSubmit=A,L.current})),l((function(){if(b.current&&u){var e=b.current.querySelector("#".concat(u)),t=W(e);M(t)}else M({})}),[u,g.length,W]),l((function(){O(0)}),[g]),l((function(){var e=function(e){var t=e.target;!L.current||L.current.contains(t)||t.classList.contains("mention")||w()};return document.addEventListener("click",e),window.addEventListener("resize",w),function(){document.removeEventListener("click",e),window.removeEventListener("resize",w)}}),[w]),l((function(){var e=N.current;return e.addEventListener("touchstart",R),e.addEventListener("touchmove",U),function(){e.removeEventListener("touchstart",R),e.removeEventListener("touchmove",U)}}),[R,U]),t.createElement("div",{ref:L,className:h(p,"mention-list"),contentEditable:!1,style:Object.assign(Object.assign({},j),{display:(null!=g?g:[]).length>0?"block":"none"})},t.createElement("ul",{ref:N,className:h("mention-list-area")},(null!=g?g:[]).map((function(e,n){return t.createElement("li",{className:h("mention-item",{active:I===n}),key:"".concat(e.name,"-").concat(n),"data-id":e.id,onMouseOver:function(){return C(n)},onClick:function(){return D(n)}},y?y(e):t.createElement(t.Fragment,null,t.createElement(m,{src:e.profileImg,size:"custom",className:h("thumb")}),t.createElement("p",{className:h("item-info")},t.createElement("strong",{className:h("item-title")},e.name),!!e.isOfficial&&t.createElement(f,{width:12,height:12}))))}))))}));v.displayName="MentionList";export{v as default};
